<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø© - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ¹ V9.0</title>
    
    <!-- Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Ù…ÙƒØªØ¨Ø© html2pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ù…Ø¨Ø³Ø· ÙˆÙ…Ø±ÙƒÙ‘Ø² */
        /* ==================== */
        * { 
            font-family: 'Noto Sans Arabic', sans-serif;
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            background: #f8fafc;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { 
                background: white !important; 
                font-size: 12px !important;
            }
            @page { margin: 0.5cm !important; }
            table { page-break-inside: avoid !important; }
            tr { page-break-inside: avoid !important; }
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        /* ==================== */
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #eef2f7;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        /* ==================== */
        .btn {
            background: #0d9488;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: #0f766e;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.2);
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }
        
        .btn-danger {
            background: #dc2626;
        }
        
        .btn-danger:hover {
            background: #b91c1c;
        }
        
        .btn-success {
            background: #10b981;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø­Ù‚ÙˆÙ„ */
        /* ==================== */
        .input-field {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #0d9488;
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
        }
        
        .select-field {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‡ÙŠØ¯Ø± */
        /* ==================== */
        .header {
            background: linear-gradient(135deg, #0d9488 0%, #0f766e 100%);
            color: white;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 24px;
            color: white;
        }
        
        .logo-text h1 {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
        }
        
        .logo-text p {
            margin: 0;
            font-size: 12px;
            opacity: 0.9;
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        /* ==================== */
        .main-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        /* ==================== */
        .tabs {
            display: flex;
            gap: 5px;
            background: #f1f5f9;
            padding: 5px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #64748b;
        }
        
        .tab.active {
            background: white;
            color: #0d9488;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        /* ==================== */
        .transaction-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .transaction-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-color: #0d9488;
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        /* ==================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        /* ==================== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal.active {
            display: flex;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            background: #0d9488;
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
        /* ==================== */
        .text-primary { color: #0d9488; }
        .bg-primary { background: #0d9488; }
        .text-success { color: #10b981; }
        .bg-success { background: #10b981; }
        .text-danger { color: #dc2626; }
        .bg-danger { background: #dc2626; }
        .text-warning { color: #f59e0b; }
        .bg-warning { background: #f59e0b; }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙÙˆØªØ± */
        /* ==================== */
        .footer {
            background: white;
            border-top: 1px solid #e2e8f0;
            padding: 20px;
            margin-top: 40px;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
            color: #64748b;
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© */
        /* ==================== */
        .sub-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .sub-tab {
            padding: 10px 15px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        
        .sub-tab.active {
            background: #0d9488;
            color: white;
            border-color: #0d9488;
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
        /* ==================== */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ */
        /* ==================== */
        .fund-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .fund-box.active {
            border-color: #0d9488;
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
        }
        
        .fund-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .fund-name {
            font-size: 18px;
            font-weight: 600;
            color: #0d9488;
        }
        
        .fund-balance {
            font-size: 24px;
            font-weight: 700;
        }
        
        .fund-balance.positive { color: #10b981; }
        .fund-balance.negative { color: #dc2626; }
        .fund-balance.neutral { color: #64748b; }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª */
        /* ==================== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #0d9488;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        /* ==================== */
        .print-view {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #0d9488;
            padding-bottom: 20px;
        }
        
        .print-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .print-table th,
        .print-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        
        .print-table th {
            background: #f8fafc;
            font-weight: 600;
        }
        
        /* ==================== */
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ */
        /* ==================== */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .transaction-item {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10px;
            }
        }
        
        /* ==================== */
        /* Ø¥Ø¶Ø§ÙØ§Øª Ø®Ø§ØµØ© */
        /* ==================== */
        .transfer-animation {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 30px;
            background: #f8fafc;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .arrow {
            color: #0d9488;
            font-size: 24px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(10px); }
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc2626;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* ==================== */
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ */
        /* ==================== */
        :focus {
            outline: 2px solid #0d9488;
            outline-offset: 2px;
        }
        
        /* ==================== */
        /* ØªØµÙ…ÙŠÙ… Ø¨Ø³ÙŠØ· Ù„Ù„ØµÙˆØ± */
        /* ==================== */
        .image-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    
    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ø­ÙØ¸ -->
    <div id="saveIndicator" class="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg hidden z-50">
        <i class="fas fa-save mr-2"></i>ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    </div>
    
    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-heartbeat"></i>
                <div class="logo-text">
                    <h1>ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h1>
                    <p>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ V9.0</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <div id="connectionStatus" class="bg-green-500 text-white px-3 py-1 rounded-full text-sm flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-white"></div>
                    <span>Ù…ØªØµÙ„</span>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="main-container">
        <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">
                <i class="fas fa-chart-line mr-2"></i>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </button>
            <button class="tab" onclick="switchTab('transactions')">
                <i class="fas fa-exchange-alt mr-2"></i>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
            </button>
            <button class="tab" onclick="switchTab('funds')">
                <i class="fas fa-wallet mr-2"></i>Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
            </button>
            <button class="tab" onclick="switchTab('reports')">
                <i class="fas fa-file-alt mr-2"></i>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
            </button>
        </div>
        
        <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
        <div id="dashboardTab" class="tab-content active">
            <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                    <div class="stat-value text-success" id="totalSales">0.00</div>
                    <div class="text-sm text-gray-500">Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
                    <div class="stat-value text-danger" id="totalPurchases">0.00</div>
                    <div class="text-sm text-gray-500">Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">ØµØ§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…</div>
                    <div class="stat-value text-primary" id="netBalance">0.00</div>
                    <div class="text-sm text-gray-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
                    <div class="stat-value text-warning" id="totalTransactions">0</div>
                    <div class="text-sm text-gray-500">Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
            </div>
            
            <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                <button class="btn bg-primary" onclick="showNewTransactionModal()">
                    <i class="fas fa-plus mr-2"></i>Ø¹Ù…Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
                
                <button class="btn bg-success" onclick="showTransferModal()">
                    <i class="fas fa-exchange-alt mr-2"></i>ØªØ­ÙˆÙŠÙ„
                </button>
                
                <button class="btn bg-warning" onclick="showReportModal()">
                    <i class="fas fa-file-pdf mr-2"></i>ØªÙ‚Ø±ÙŠØ±
                </button>
                
                <button class="btn bg-danger" onclick="clearTodayData()">
                    <i class="fas fa-trash mr-2"></i>Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…
                </button>
            </div>
            
            <!-- Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ… -->
            <div class="card">
                <h2 class="text-lg font-bold mb-4 text-primary">ğŸ”” Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…</h2>
                <div id="todayTransactions" class="space-y-3 max-h-96 overflow-y-auto">
                    <!-- Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
        <div id="transactionsTab" class="tab-content hidden">
            <!-- ØªØµÙÙŠØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
            <div class="card mb-4">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <div>
                        <label class="block text-sm font-medium mb-1">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="filterDate" class="input-field" value="">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</label>
                        <select id="filterFund" class="select-field">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</option>
                            <option value="ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</option>
                            <option value="ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</option>
                            <option value="Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1">Ø§Ù„Ù†ÙˆØ¹</label>
                        <select id="filterType" class="select-field">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                            <option value="income">Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</option>
                            <option value="expense">Ù…ØµØ±ÙˆÙØ§Øª</option>
                            <option value="transfer">ØªØ­ÙˆÙŠÙ„</option>
                        </select>
                    </div>
                    
                    <div class="flex items-end">
                        <button class="btn bg-primary w-full" onclick="filterTransactions()">
                            <i class="fas fa-filter mr-2"></i>ØªØµÙÙŠØ©
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-primary">ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h2>
                    <span class="text-sm text-gray-500" id="filteredCount">0 Ø¹Ù…Ù„ÙŠØ©</span>
                </div>
                
                <div id="allTransactions" class="space-y-3">
                    <!-- Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ -->
        <div id="fundsTab" class="tab-content hidden">
            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ -->
            <div class="stats-grid mb-6">
                <div class="stat-card">
                    <div class="stat-label">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>
                    <div class="stat-value" id="dailyFundBalance">0.00</div>
                    <div class="text-sm text-gray-500">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</div>
                    <div class="stat-value" id="karimiFundBalance">0.00</div>
                    <div class="text-sm text-gray-500">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</div>
                    <div class="stat-value" id="mainFundBalance">0.00</div>
                    <div class="text-sm text-gray-500">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</div>
                    <div class="stat-value text-primary" id="totalFundsBalance">0.00</div>
                    <div class="text-sm text-gray-500">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</div>
                </div>
            </div>
            
            <!-- ØªÙØ§ØµÙŠÙ„ ÙƒÙ„ ØµÙ†Ø¯ÙˆÙ‚ -->
            <div class="space-y-4">
                <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
                <div class="fund-box">
                    <div class="fund-header">
                        <div class="fund-name">ğŸ’¼ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>
                        <div class="fund-balance positive" id="dailyFundDetails">0.00</div>
                    </div>
                    <div id="dailyFundTransactions" class="space-y-2">
                        <!-- Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>
                
                <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ -->
                <div class="fund-box">
                    <div class="fund-header">
                        <div class="fund-name">ğŸ‘¤ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</div>
                        <div class="fund-balance" id="karimiFundDetails">0.00</div>
                    </div>
                    <div id="karimiFundTransactions" class="space-y-2">
                        <!-- Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>
                
                <!-- Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
                <div class="fund-box">
                    <div class="fund-header">
                        <div class="fund-name">ğŸ¦ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</div>
                        <div class="fund-balance" id="mainFundDetails">0.00</div>
                    </div>
                    <div id="mainFundTransactions" class="space-y-2">
                        <!-- Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
        <div id="reportsTab" class="tab-content hidden">
            <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
            <div class="card mb-6">
                <h2 class="text-lg font-bold mb-4 text-primary">ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                        <select id="reportType" class="select-field">
                            <option value="daily">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</option>
                            <option value="fund">ØªÙ‚Ø±ÙŠØ± ØµÙ†Ø¯ÙˆÙ‚</option>
                            <option value="summary">Ù…Ù„Ø®Øµ Ø´Ø§Ù…Ù„</option>
                            <option value="transactions">ØªÙØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="reportDate" class="input-field" value="">
                    </div>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4">
                    <button class="btn bg-primary" onclick="generateReport('view')">
                        <i class="fas fa-eye mr-2"></i>Ø¹Ø±Ø¶
                    </button>
                    
                    <button class="btn bg-success" onclick="generateReport('print')">
                        <i class="fas fa-print mr-2"></i>Ø·Ø¨Ø§Ø¹Ø©
                    </button>
                    
                    <button class="btn bg-warning" onclick="generateReport('pdf')">
                        <i class="fas fa-file-pdf mr-2"></i>PDF
                    </button>
                    
                    <button class="btn bg-danger" onclick="clearReport()">
                        <i class="fas fa-trash mr-2"></i>Ù…Ø³Ø­
                    </button>
                </div>
            </div>
            
            <!-- Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
            <div id="reportResult" class="card hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-primary" id="reportTitle">Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h2>
                    <button class="btn btn-sm" onclick="printReport()">
                        <i class="fas fa-print mr-1"></i>Ø·Ø¨Ø§Ø¹Ø©
                    </button>
                </div>
                
                <div id="reportContent">
                    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>
    </main>
    
    <!-- Ø§Ù„ÙÙˆØªØ± -->
    <footer class="footer">
        <div class="footer-content">
            <p>Â© 2024 ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø© - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
            <p class="text-sm mt-2">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdate">--:--</span></p>
        </div>
    </footer>
    
    <!-- =========================================== -->
    <!-- Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <!-- =========================================== -->
    
    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© -->
    <div id="newTransactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-bold">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <button class="text-white text-xl" onclick="hideModal('newTransactionModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</label>
                        <select id="transactionFund" class="select-field">
                            <option value="ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</option>
                            <option value="ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</option>
                            <option value="Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</label>
                        <select id="transactionType" class="select-field" onchange="updateTransactionType()">
                            <option value="income">ğŸ’° Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</option>
                            <option value="expense">ğŸ“¤ Ù…ØµØ±ÙˆÙØ§Øª</option>
                            <option value="transfer">ğŸ”„ ØªØ­ÙˆÙŠÙ„</option>
                            <option value="other">ğŸ“ Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                        <input type="number" id="transactionAmount" class="input-field" placeholder="0.00" step="0.01">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Ø§Ù„ÙˆØµÙ</label>
                        <input type="text" id="transactionDescription" class="input-field" placeholder="ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©...">
                    </div>
                    
                    <div id="transferFields" class="hidden">
                        <label class="block text-sm font-medium mb-2">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù‡Ø¯Ù</label>
                        <select id="transferTarget" class="select-field">
                            <option value="ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</option>
                            <option value="Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                            <option value="ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</option>
                        </select>
                    </div>
                    
                    <button class="btn bg-primary w-full" onclick="saveTransaction()">
                        <i class="fas fa-save mr-2"></i>Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ -->
    <div id="transferModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-bold">ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</h3>
                <button class="text-white text-xl" onclick="hideModal('transferModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="space-y-4">
                    <div class="transfer-animation">
                        <div class="text-center">
                            <div class="text-sm font-medium mb-2" id="fromFundLabel">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>
                            <div class="text-xl font-bold" id="fromFundBalance">0.00</div>
                        </div>
                        
                        <div class="arrow">
                            <i class="fas fa-long-arrow-alt-right"></i>
                        </div>
                        
                        <div class="text-center">
                            <div class="text-sm font-medium mb-2" id="toFundLabel">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</div>
                            <div class="text-xl font-bold" id="toFundBalance">0.00</div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­ÙˆÙ„</label>
                        <input type="number" id="transferAmount" class="input-field" placeholder="0.00" step="0.01">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
                        <input type="text" id="transferReason" class="input-field" placeholder="Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„...">
                    </div>
                    
                    <button class="btn bg-success w-full" onclick="executeTransfer()">
                        <i class="fas fa-exchange-alt mr-2"></i>ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ­ÙˆÙŠÙ„
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-bold">ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                <button class="text-white text-xl" onclick="hideModal('notificationsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div id="notificationsList" class="space-y-3">
                    <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
    <div id="printArea" class="print-only print-view" style="display: none;">
        <div id="printContent"></div>
    </div>
    
    <script>
    // ============================================
    // Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ - Ù…Ø­Ø³Ù‘Ù† ÙˆÙ…Ø¨Ø³Ù‘Ø·
    // ============================================
    
    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹
    const TRANSACTION_TYPES = {
        income: { label: 'Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', icon: 'ğŸ’°', color: 'text-success', bg: 'bg-green-50' },
        expense: { label: 'Ù…ØµØ±ÙˆÙØ§Øª', icon: 'ğŸ“¤', color: 'text-danger', bg: 'bg-red-50' },
        transfer: { label: 'ØªØ­ÙˆÙŠÙ„', icon: 'ğŸ”„', color: 'text-primary', bg: 'bg-blue-50' },
        other: { label: 'Ø£Ø®Ø±Ù‰', icon: 'ğŸ“', color: 'text-gray-600', bg: 'bg-gray-50' }
    };
    
    const FUNDS = {
        'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©': { icon: 'ğŸ’¼', color: '#0d9488' },
        'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ': { icon: 'ğŸ‘¤', color: '#10b981' },
        'Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ': { icon: 'ğŸ¦', color: '#6366f1' }
    };
    
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    let systemData = {
        transactions: [],
        settings: {
            notifications: true,
            autoSave: true,
            currentDate: new Date().toISOString().split('T')[0]
        },
        lastUpdate: new Date().toISOString()
    };
    
    // ============================================
    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ø³Ù‘Ù†
    // ============================================
    
    function loadData() {
        try {
            const saved = localStorage.getItem('pharmacySystem_v9');
            if (saved) {
                systemData = JSON.parse(saved);
                console.log('âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
            }
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
        }
    }
    
    function saveData() {
        try {
            systemData.lastUpdate = new Date().toISOString();
            localStorage.setItem('pharmacySystem_v9', JSON.stringify(systemData));
            showSaveIndicator();
            updateLastUpdate();
            console.log('ğŸ’¾ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©');
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
        }
    }
    
    // ============================================
    // Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    // ============================================
    
    function showModal(modalId) {
        document.getElementById(modalId).classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function hideModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
        document.body.style.overflow = 'auto';
    }
    
    function showAlert(message, type = 'success') {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`;
        alertDiv.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            <span>${message}</span>
        `;
        
        const container = document.querySelector('.main-container');
        container.insertBefore(alertDiv, container.firstChild);
        
        setTimeout(() => {
            alertDiv.remove();
        }, 5000);
    }
    
    function showSaveIndicator() {
        const indicator = document.getElementById('saveIndicator');
        indicator.classList.remove('hidden');
        setTimeout(() => {
            indicator.classList.add('hidden');
        }, 2000);
    }
    
    function updateLastUpdate() {
        const now = new Date();
        const time = now.toLocaleTimeString('ar-EG', { 
            hour: '2-digit', 
            minute: '2-digit' 
        });
        document.getElementById('lastUpdate').textContent = time;
    }
    
    // ============================================
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    // ============================================
    
    function switchTab(tabName) {
        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.add('hidden');
        });
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.querySelectorAll('.tab').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
        document.getElementById(tabName + 'Tab').classList.remove('hidden');
        
        // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø·
        document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        switch(tabName) {
            case 'dashboard':
                updateDashboard();
                break;
            case 'transactions':
                loadAllTransactions();
                break;
            case 'funds':
                updateFunds();
                break;
            case 'reports':
                // Ù„Ø§ Ø´ÙŠØ¡
                break;
        }
    }
    
    // ============================================
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
    // ============================================
    
    function showNewTransactionModal() {
        document.getElementById('transactionAmount').value = '';
        document.getElementById('transactionDescription').value = '';
        showModal('newTransactionModal');
    }
    
    function updateTransactionType() {
        const type = document.getElementById('transactionType').value;
        const transferFields = document.getElementById('transferFields');
        
        if (type === 'transfer') {
            transferFields.classList.remove('hidden');
        } else {
            transferFields.classList.add('hidden');
        }
    }
    
    function saveTransaction() {
        const fund = document.getElementById('transactionFund').value;
        const type = document.getElementById('transactionType').value;
        const amount = parseFloat(document.getElementById('transactionAmount').value);
        const description = document.getElementById('transactionDescription').value.trim();
        const targetFund = document.getElementById('transferTarget')?.value;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (!amount || amount <= 0) {
            showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­', 'error');
            return;
        }
        
        if (!description) {
            showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'error');
            return;
        }
        
        const transaction = {
            id: Date.now(),
            date: new Date().toISOString().split('T')[0],
            time: new Date().toLocaleTimeString('ar-EG'),
            fund: fund,
            type: type,
            amount: amount,
            description: description,
            targetFund: type === 'transfer' ? targetFund : null,
            timestamp: Date.now()
        };
        
        systemData.transactions.push(transaction);
        saveData();
        
        if (type === 'transfer') {
            // Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ù…Ù‚Ø§Ø¨Ù„ Ù„Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù‡Ø¯Ù
            const reverseTransaction = {
                ...transaction,
                id: Date.now() + 1,
                fund: targetFund,
                amount: amount,
                type: 'income',
                description: `ØªØ­ÙˆÙŠÙ„ Ù…Ù† ${fund}`
            };
            systemData.transactions.push(reverseTransaction);
            saveData();
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±
            sendNotification('ØªØ­ÙˆÙŠÙ„', `ØªÙ… ØªØ­ÙˆÙŠÙ„ ${amount} Ù…Ù† ${fund} Ø¥Ù„Ù‰ ${targetFund}`);
        }
        
        showAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        hideModal('newTransactionModal');
        updateDashboard();
        updateFunds();
    }
    
    function loadAllTransactions() {
        const container = document.getElementById('allTransactions');
        const filtered = filterTransactionsList();
        
        if (filtered.length === 0) {
            container.innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-exchange-alt text-4xl mb-3"></i>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        filtered.forEach(transaction => {
            const typeInfo = TRANSACTION_TYPES[transaction.type];
            html += `
                <div class="transaction-item">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-lg">${typeInfo.icon}</span>
                            <span class="font-medium ${typeInfo.color}">${typeInfo.label}</span>
                            <span class="text-sm text-gray-500">${transaction.time}</span>
                        </div>
                        <p class="text-gray-800 font-medium mb-1">${transaction.description}</p>
                        <div class="flex gap-2">
                            <span class="text-xs px-2 py-1 bg-gray-100 rounded">${transaction.fund}</span>
                            ${transaction.targetFund ? `<span class="text-xs px-2 py-1 bg-blue-100 rounded">â†’ ${transaction.targetFund}</span>` : ''}
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-xl font-bold ${typeInfo.color}">${transaction.amount.toFixed(2)}</div>
                        <button onclick="deleteTransaction(${transaction.id})" class="text-sm text-gray-400 hover:text-red-500 mt-2">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
        document.getElementById('filteredCount').textContent = `${filtered.length} Ø¹Ù…Ù„ÙŠØ©`;
    }
    
    function filterTransactions() {
        loadAllTransactions();
    }
    
    function filterTransactionsList() {
        const date = document.getElementById('filterDate').value;
        const fund = document.getElementById('filterFund').value;
        const type = document.getElementById('filterType').value;
        
        return systemData.transactions.filter(t => {
            if (date && t.date !== date) return false;
            if (fund && t.fund !== fund) return false;
            if (type) {
                if (type === 'income' && t.type !== 'income') return false;
                if (type === 'expense' && t.type !== 'expense') return false;
                if (type === 'transfer' && t.type !== 'transfer') return false;
            }
            return true;
        }).sort((a, b) => b.timestamp - a.timestamp);
    }
    
    function deleteTransaction(id) {
        if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ')) return;
        
        systemData.transactions = systemData.transactions.filter(t => t.id !== id);
        saveData();
        showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'success');
        updateDashboard();
        updateFunds();
        loadAllTransactions();
    }
    
    // ============================================
    // Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
    // ============================================
    
    function updateDashboard() {
        const today = new Date().toISOString().split('T')[0];
        const todayTransactions = systemData.transactions.filter(t => t.date === today);
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        let totalIncome = 0;
        let totalExpense = 0;
        
        todayTransactions.forEach(t => {
            if (t.type === 'income') totalIncome += t.amount;
            if (t.type === 'expense') totalExpense += t.amount;
        });
        
        const netBalance = totalIncome - totalExpense;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        document.getElementById('totalSales').textContent = totalIncome.toFixed(2);
        document.getElementById('totalPurchases').textContent = totalExpense.toFixed(2);
        document.getElementById('netBalance').textContent = netBalance.toFixed(2);
        document.getElementById('totalTransactions').textContent = todayTransactions.length;
        
        // Ø¹Ø±Ø¶ Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…
        const container = document.getElementById('todayTransactions');
        if (todayTransactions.length === 0) {
            container.innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-calendar-day text-4xl mb-3"></i>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        todayTransactions.slice(0, 10).forEach(transaction => {
            const typeInfo = TRANSACTION_TYPES[transaction.type];
            html += `
                <div class="transaction-item">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-lg">${typeInfo.icon}</span>
                            <span class="font-medium ${typeInfo.color}">${typeInfo.label}</span>
                        </div>
                        <p class="text-gray-800">${transaction.description}</p>
                        <p class="text-sm text-gray-500">${transaction.fund}</p>
                    </div>
                    <div class="text-xl font-bold ${typeInfo.color}">${transaction.amount.toFixed(2)}</div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    // ============================================
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
    // ============================================
    
    function updateFunds() {
        // Ø­Ø³Ø§Ø¨ Ø£Ø±ØµØ¯Ø© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
        const fundBalances = {
            'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©': 0,
            'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ': 0,
            'Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ': 0
        };
        
        systemData.transactions.forEach(t => {
            if (t.type === 'income') {
                fundBalances[t.fund] += t.amount;
            } else if (t.type === 'expense') {
                fundBalances[t.fund] -= t.amount;
            } else if (t.type === 'transfer') {
                fundBalances[t.fund] -= t.amount;
                if (t.targetFund) {
                    fundBalances[t.targetFund] += t.amount;
                }
            }
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        document.getElementById('dailyFundBalance').textContent = fundBalances['ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©'].toFixed(2);
        document.getElementById('karimiFundBalance').textContent = fundBalances['ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ'].toFixed(2);
        document.getElementById('mainFundBalance').textContent = fundBalances['Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ'].toFixed(2);
        
        const total = Object.values(fundBalances).reduce((a, b) => a + b, 0);
        document.getElementById('totalFundsBalance').textContent = total.toFixed(2);
        
        // ØªØ­Ø¯ÙŠØ« ØªÙØ§ØµÙŠÙ„ ÙƒÙ„ ØµÙ†Ø¯ÙˆÙ‚
        updateFundDetails('daily', fundBalances['ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©']);
        updateFundDetails('karimi', fundBalances['ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ']);
        updateFundDetails('main', fundBalances['Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ']);
    }
    
    function updateFundDetails(fundType, balance) {
        const fundName = fundType === 'daily' ? 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©' :
                        fundType === 'karimi' ? 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ' : 'Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ';
        
        const transactions = systemData.transactions
            .filter(t => t.fund === fundName)
            .sort((a, b) => b.timestamp - a.timestamp)
            .slice(0, 5);
        
        const container = document.getElementById(fundType + 'FundTransactions');
        const balanceElement = document.getElementById(fundType + 'FundDetails');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯
        balanceElement.textContent = balance.toFixed(2);
        balanceElement.className = `fund-balance ${balance > 0 ? 'positive' : balance < 0 ? 'negative' : 'neutral'}`;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
        if (transactions.length === 0) {
            container.innerHTML = `
                <div class="text-center py-4 text-gray-500">
                    <i class="fas fa-exchange-alt text-xl mb-2"></i>
                    <p class="text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        transactions.forEach(t => {
            const typeInfo = TRANSACTION_TYPES[t.type];
            html += `
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <div class="flex-1">
                        <div class="flex items-center gap-1 mb-1">
                            <span>${typeInfo.icon}</span>
                            <span class="text-sm font-medium">${t.description}</span>
                        </div>
                        <span class="text-xs text-gray-500">${t.time}</span>
                    </div>
                    <span class="font-medium ${typeInfo.color}">${t.amount.toFixed(2)}</span>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    // ============================================
    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„
    // ============================================
    
    function showTransferModal() {
        // ØªØ­Ø¯ÙŠØ« Ø£Ø±ØµØ¯Ø© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
        updateFundBalancesInTransferModal();
        showModal('transferModal');
    }
    
    function updateFundBalancesInTransferModal() {
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const balances = {
            'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©': 0,
            'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ': 0,
            'Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ': 0
        };
        
        systemData.transactions.forEach(t => {
            if (t.type === 'income') {
                balances[t.fund] += t.amount;
            } else if (t.type === 'expense') {
                balances[t.fund] -= t.amount;
            } else if (t.type === 'transfer') {
                balances[t.fund] -= t.amount;
                if (t.targetFund) {
                    balances[t.targetFund] += t.amount;
                }
            }
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        document.getElementById('fromFundLabel').textContent = 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©';
        document.getElementById('fromFundBalance').textContent = balances['ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©'].toFixed(2);
        
        document.getElementById('toFundLabel').textContent = 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ';
        document.getElementById('toFundBalance').textContent = balances['ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ'].toFixed(2);
    }
    
    function executeTransfer() {
        const amount = parseFloat(document.getElementById('transferAmount').value);
        const reason = document.getElementById('transferReason').value.trim();
        const fromFund = 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©'; // Ø§ÙØªØ±Ø§Ø¶ÙŠ
        const toFund = 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ'; // Ø§ÙØªØ±Ø§Ø¶ÙŠ
        
        if (!amount || amount <= 0) {
            showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­', 'error');
            return;
        }
        
        if (!reason) {
            showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„', 'error');
            return;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„
        const transferTransaction = {
            id: Date.now(),
            date: new Date().toISOString().split('T')[0],
            time: new Date().toLocaleTimeString('ar-EG'),
            fund: fromFund,
            type: 'transfer',
            amount: amount,
            description: reason,
            targetFund: toFund,
            timestamp: Date.now()
        };
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©
        const reverseTransaction = {
            id: Date.now() + 1,
            date: new Date().toISOString().split('T')[0],
            time: new Date().toLocaleTimeString('ar-EG'),
            fund: toFund,
            type: 'income',
            amount: amount,
            description: `ØªØ­ÙˆÙŠÙ„ Ù…Ù† ${fromFund}`,
            timestamp: Date.now() + 1
        };
        
        // Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
        systemData.transactions.push(transferTransaction, reverseTransaction);
        saveData();
        
        showAlert(`ØªÙ… ØªØ­ÙˆÙŠÙ„ ${amount} Ù…Ù† ${fromFund} Ø¥Ù„Ù‰ ${toFund}`, 'success');
        sendNotification('ØªØ­ÙˆÙŠÙ„', `ØªÙ… ØªØ­ÙˆÙŠÙ„ ${amount} Ù…Ù† ${fromFund} Ø¥Ù„Ù‰ ${toFund}`);
        
        hideModal('transferModal');
        updateDashboard();
        updateFunds();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('transferAmount').value = '';
        document.getElementById('transferReason').value = '';
    }
    
    // ============================================
    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
    // ============================================
    
    function showReportModal() {
        switchTab('reports');
    }
    
    function generateReport(action) {
        const type = document.getElementById('reportType').value;
        const date = document.getElementById('reportDate').value || new Date().toISOString().split('T')[0];
        
        let reportData;
        let reportTitle;
        
        switch(type) {
            case 'daily':
                reportData = generateDailyReport(date);
                reportTitle = `ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ - ${formatDate(date)}`;
                break;
            case 'fund':
                reportData = generateFundReport(date);
                reportTitle = `ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ - ${formatDate(date)}`;
                break;
            case 'summary':
                reportData = generateSummaryReport(date);
                reportTitle = `Ù…Ù„Ø®Øµ Ø´Ø§Ù…Ù„ - ${formatDate(date)}`;
                break;
            case 'transactions':
                reportData = generateTransactionsReport(date);
                reportTitle = `ØªÙØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª - ${formatDate(date)}`;
                break;
        }
        
        if (action === 'view') {
            displayReport(reportTitle, reportData);
        } else if (action === 'print') {
            printReportContent(reportTitle, reportData);
        } else if (action === 'pdf') {
            generatePDF(reportTitle, reportData);
        }
    }
    
    function displayReport(title, content) {
        document.getElementById('reportTitle').textContent = title;
        document.getElementById('reportContent').innerHTML = content;
        document.getElementById('reportResult').classList.remove('hidden');
    }
    
    function printReport() {
        const title = document.getElementById('reportTitle').textContent;
        const content = document.getElementById('reportContent').innerHTML;
        printReportContent(title, content);
    }
    
    function printReportContent(title, content) {
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html dir="rtl">
            <head>
                <title>${title}</title>
                <style>
                    body { font-family: 'Noto Sans Arabic', sans-serif; padding: 20px; }
                    h1 { color: #0d9488; text-align: center; }
                    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                    th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
                    th { background: #f8fafc; }
                    .total { font-weight: bold; color: #0d9488; }
                </style>
            </head>
            <body>
                <h1>${title}</h1>
                ${content}
                <div style="margin-top: 30px; text-align: center; color: #666; font-size: 12px;">
                    ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø© - ${new Date().toLocaleDateString('ar-EG')}
                </div>
            </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.print();
    }
    
    function clearReport() {
        document.getElementById('reportResult').classList.add('hidden');
    }
    
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('ar-EG');
    }
    
    // ============================================
    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
    // ============================================
    
    function generateDailyReport(date) {
        const transactions = systemData.transactions.filter(t => t.date === date);
        let totalIncome = 0;
        let totalExpense = 0;
        
        let html = `
            <h3>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
            <table class="print-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„ÙˆÙ‚Øª</th>
                        <th>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</th>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„ÙˆØµÙ</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        transactions.forEach(t => {
            if (t.type === 'income') totalIncome += t.amount;
            if (t.type === 'expense') totalExpense += t.amount;
            
            html += `
                <tr>
                    <td>${t.time}</td>
                    <td>${t.fund}</td>
                    <td>${TRANSACTION_TYPES[t.type]?.label || t.type}</td>
                    <td>${t.description}</td>
                    <td>${t.amount.toFixed(2)}</td>
                </tr>
            `;
        });
        
        html += `
                </tbody>
            </table>
            <div style="margin-top: 20px;">
                <p><strong>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª:</strong> ${totalIncome.toFixed(2)}</p>
                <p><strong>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:</strong> ${totalExpense.toFixed(2)}</p>
                <p class="total"><strong>Ø§Ù„ØµØ§ÙÙŠ:</strong> ${(totalIncome - totalExpense).toFixed(2)}</p>
            </div>
        `;
        
        return html;
    }
    
    function generateFundReport(date) {
        const transactions = systemData.transactions.filter(t => t.date === date);
        const fundSummary = {};
        
        transactions.forEach(t => {
            if (!fundSummary[t.fund]) {
                fundSummary[t.fund] = { income: 0, expense: 0, transfer: 0 };
            }
            
            if (t.type === 'income') fundSummary[t.fund].income += t.amount;
            if (t.type === 'expense') fundSummary[t.fund].expense += t.amount;
            if (t.type === 'transfer') fundSummary[t.fund].transfer += t.amount;
        });
        
        let html = `<h3>Ø­Ø±ÙƒØ© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</h3>`;
        
        Object.entries(fundSummary).forEach(([fund, data]) => {
            const net = data.income - data.expense;
            html += `
                <div style="margin: 15px 0; padding: 15px; background: #f8fafc; border-radius: 8px;">
                    <h4>${fund}</h4>
                    <p>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: <span style="color: green;">${data.income.toFixed(2)}</span></p>
                    <p>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: <span style="color: red;">${data.expense.toFixed(2)}</span></p>
                    <p>Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª: ${data.transfer.toFixed(2)}</p>
                    <p><strong>Ø§Ù„Ø±ØµÙŠØ¯: ${net.toFixed(2)}</strong></p>
                </div>
            `;
        });
        
        return html;
    }
    
    function generateSummaryReport(date) {
        const transactions = systemData.transactions.filter(t => t.date === date);
        let total = 0;
        
        let html = `
            <h3>Ù…Ù„Ø®Øµ Ø§Ù„ÙŠÙˆÙ…</h3>
            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª: ${transactions.length}</p>
        `;
        
        const byType = {};
        transactions.forEach(t => {
            if (!byType[t.type]) byType[t.type] = 0;
            byType[t.type] += t.amount;
            
            if (t.type === 'income') total += t.amount;
            if (t.type === 'expense') total -= t.amount;
        });
        
        html += '<ul>';
        Object.entries(byType).forEach(([type, amount]) => {
            html += `<li>${TRANSACTION_TYPES[type]?.label || type}: ${amount.toFixed(2)}</li>`;
        });
        html += '</ul>';
        
        html += `<p class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toFixed(2)}</p>`;
        
        return html;
    }
    
    function generateTransactionsReport(date) {
        const transactions = systemData.transactions.filter(t => t.date === date);
        
        if (transactions.length === 0) {
            return '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®</p>';
        }
        
        let html = `
            <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
            <table class="print-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„ÙˆÙ‚Øª</th>
                        <th>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</th>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„ÙˆØµÙ</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        transactions.forEach(t => {
            html += `
                <tr>
                    <td>${t.time}</td>
                    <td>${t.fund}</td>
                    <td>${TRANSACTION_TYPES[t.type]?.label || t.type}</td>
                    <td>${t.description}</td>
                    <td>${t.amount.toFixed(2)}</td>
                </tr>
            `;
        });
        
        html += `</tbody></table>`;
        return html;
    }
    
    // ============================================
    // Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    // ============================================
    
    function sendNotification(title, message) {
        if (!systemData.settings.notifications) return;
        
        // Ø­ÙØ¸ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        const notification = {
            id: Date.now(),
            title: title,
            message: message,
            time: new Date().toLocaleTimeString('ar-EG'),
            read: false
        };
        
        if (!systemData.notifications) systemData.notifications = [];
        systemData.notifications.push(notification);
        saveData();
        
        // Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØµÙØ­
        if ("Notification" in window && Notification.permission === "granted") {
            new Notification(title, {
                body: message,
                icon: '/icon.png'
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¨Ø§Ø¯Ø¬ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        updateNotificationBadge();
    }
    
    function updateNotificationBadge() {
        const unread = systemData.notifications?.filter(n => !n.read).length || 0;
        let badge = document.getElementById('notificationBadge');
        
        if (!badge && unread > 0) {
            badge = document.createElement('div');
            badge.id = 'notificationBadge';
            badge.className = 'notification-badge';
            const bell = document.querySelector('[onclick="showNotifications()"]');
            if (bell) bell.appendChild(badge);
        }
        
        if (badge) {
            badge.textContent = unread > 9 ? '9+' : unread.toString();
            badge.style.display = unread > 0 ? 'flex' : 'none';
        }
    }
    
    function showNotifications() {
        if (!systemData.notifications || systemData.notifications.length === 0) {
            document.getElementById('notificationsList').innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-bell-slash text-3xl mb-3"></i>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</p>
                </div>
            `;
        } else {
            let html = '';
            systemData.notifications.slice().reverse().forEach(notification => {
                html += `
                    <div class="p-3 border rounded ${notification.read ? 'bg-gray-50' : 'bg-blue-50'}">
                        <div class="flex justify-between items-start mb-2">
                            <strong>${notification.title}</strong>
                            <span class="text-sm text-gray-500">${notification.time}</span>
                        </div>
                        <p class="text-gray-700">${notification.message}</p>
                    </div>
                `;
                
                // ØªØ¹Ù„ÙŠÙ… ÙƒÙ…Ù‚Ø±ÙˆØ¡
                notification.read = true;
            });
            
            document.getElementById('notificationsList').innerHTML = html;
            saveData();
            updateNotificationBadge();
        }
        
        showModal('notificationsModal');
    }
    
    // ============================================
    // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
    // ============================================
    
    function clearTodayData() {
        if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ… ÙˆØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
        
        const today = new Date().toISOString().split('T')[0];
        const archive = {
            date: today,
            transactions: systemData.transactions.filter(t => t.date === today),
            summary: generateSummaryReport(today)
        };
        
        // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
        if (!systemData.archives) systemData.archives = [];
        systemData.archives.push(archive);
        
        // Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…
        systemData.transactions = systemData.transactions.filter(t => t.date !== today);
        saveData();
        
        showAlert('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ… Ø¨Ù†Ø¬Ø§Ø­', 'success');
        updateDashboard();
        updateFunds();
    }
    
    function requestNotificationPermission() {
        if ("Notification" in window) {
            Notification.requestPermission();
        }
    }
    
    // ============================================
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    // ============================================
    
    function initSystem() {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        loadData();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        updateDashboard();
        updateFunds();
        updateLastUpdate();
        
        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        setTimeout(requestNotificationPermission, 1000);
        
        // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
        setInterval(saveData, 60000);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
        setInterval(updateLastUpdate, 60000);
        
        console.log('ğŸš€ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„');
    }
    
    // Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…
    window.addEventListener('DOMContentLoaded', initSystem);
    
    // Ø­ÙØ¸ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬
    window.addEventListener('beforeunload', () => {
        saveData();
    });
    
    </script>
</body>
</html>