<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø© - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ¹ V7.2</title>
    
    <!-- ØªØ­Ø³ÙŠÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js" defer></script>
    
    <style>
        * { 
            font-family: 'Noto Sans Arabic', sans-serif;
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            background: #f5f7fa;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white !important; font-size: 12px; }
            @page { margin: 0.5cm; }
            .print-table { border-collapse: collapse; width: 100%; font-size: 11px; }
            .print-table th, .print-table td { border: 1px solid #ddd; padding: 5px; text-align: right; }
            .print-section { break-inside: avoid; margin-bottom: 15px; }
        }
        
        .print-only { display: none; }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid #eef2f7;
        }
        
        .transaction-item {
            background: white;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            border: 1px solid #eef2f7;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .transaction-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-color: #cbd5e1;
        }
        
        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© - Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ø£Ø¯Ø§Ø¡ */
        .modal {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 9999;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .mobile-stack { flex-direction: column; }
            .mobile-full { width: 100%; }
            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .transaction-amount {
                align-self: flex-end;
                margin-top: 8px;
            }
            body { font-size: 13px; }
        }
        
        /* ØªØ®ØµÙŠØµ Ø£Ù„ÙˆØ§Ù† Ù„Ù€ Tailwind */
        .bg-primary { background-color: #0d9488; }
        .bg-primary-dark { background-color: #0f766e; }
        .text-primary { color: #0d9488; }
        .border-primary { border-color: #0d9488; }
        
        /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        .list-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ - Ø¨Ø­Ø¬Ù… Ø·Ø¨ÙŠØ¹ÙŠ */
        .input-field {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
            width: 100%;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #0d9488;
            box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.1);
        }
        
        .select-field {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
            width: 100%;
            cursor: pointer;
        }
        
        .select-field:focus {
            outline: none;
            border-color: #0d9488;
            box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.1);
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            transition: all 0.2s ease;
            border-radius: 6px;
            font-weight: 500;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }
        
        /* Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© */
        .sale-bg { background-color: #f0fdf4; border-color: #dcfce7; }
        .sale-text { color: #166534; }
        .purchase-bg { background-color: #fef2f2; border-color: #fee2e2; }
        .purchase-text { color: #991b1b; }
        .advance-bg { background-color: #fff7ed; border-color: #ffedd5; }
        .advance-text { color: #9a3412; }
        .return-bg { background-color: #f0f9ff; border-color: #e0f2fe; }
        .return-text { color: #0369a1; }
        .shortage-bg { background-color: #fef2f2; border-color: #fee2e2; }
        .shortage-text { color: #dc2626; }
        
        /* ØªØ­Ø³ÙŠÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù†ØµÙˆØµ */
        .text-small { font-size: 12px; }
        .text-medium { font-size: 14px; }
        .text-large { font-size: 16px; }
        .text-xlarge { font-size: 18px; }
        
        /* ÙØ§ØµÙ„ Ø¨ØµØ±ÙŠ */
        .divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #e2e8f0, transparent);
            margin: 15px 0;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tab-container {
            display: flex;
            background: #f1f5f9;
            border-radius: 6px;
            padding: 4px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            flex: 1;
            text-align: center;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            min-width: 80px;
            margin: 1px;
        }
        
        .tab-btn.active {
            background: white;
            color: #0d9488;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #0d9488;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ‚Ø±ÙŠØ± */
        .report-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
        }
        
        .report-section-title {
            font-size: 15px;
            font-weight: 600;
            color: #334155;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header {
            font-size: 14px;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙÙˆØªØ± */
        .footer {
            font-size: 13px;
        }
    </style>
</head>
<body class="min-h-screen text-gray-800">

    <!-- Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div id="transferModal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md">
            <div class="bg-primary p-4 flex justify-between items-center text-white rounded-t-lg">
                <h3 class="font-semibold text-medium">ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</h3>
                <button onclick="hideModal('transferModal')" class="hover:bg-primary-dark p-2 rounded transition">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label class="text-gray-600 mb-1 block font-medium">Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚</label>
                    <select id="tFrom" class="select-field">
                        <option>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</option>
                        <option>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</option>
                        <option>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                    </select>
                </div>
                <div>
                    <label class="text-gray-600 mb-1 block font-medium">Ø¥Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚</label>
                    <select id="tTo" class="select-field">
                        <option>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</option>
                        <option>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</option>
                        <option>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                    </select>
                </div>
                <div>
                    <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                    <input id="tAmount" type="number" step="0.01" class="input-field w-full font-semibold" placeholder="0.00" autofocus>
                </div>
                <button onclick="executeTransfer()" class="w-full p-3 bg-primary text-white rounded font-medium btn text-medium">
                    ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„
                </button>
            </div>
        </div>
    </div>

    <div id="calculatorModal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-sm">
            <div class="bg-gray-800 p-4 flex justify-between items-center text-white rounded-t-lg">
                <h3 class="font-semibold text-medium">Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©</h3>
                <button onclick="hideModal('calculatorModal')" class="hover:bg-gray-700 p-2 rounded transition">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
            <div class="p-4 bg-gray-100 text-right text-xl font-mono font-semibold border-b" dir="ltr" id="calcDisplay">0</div>
            <div class="grid grid-cols-4 gap-2 p-4">
                <button onclick="calcInput('7')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn text-medium">7</button>
                <button onclick="calcInput('8')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn text-medium">8</button>
                <button onclick="calcInput('9')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn text-medium">9</button>
                <button onclick="calcInput('/')" class="p-3 bg-orange-100 rounded font-medium hover:bg-orange-200 btn text-medium">Ã·</button>
                <button onclick="calcInput('4')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn text-medium">4</button>
                <button onclick="calcInput('5')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn text-medium">5</button>
                <button onclick="calcInput('6')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn text-medium">6</button>
                <button onclick="calcInput('*')" class="p-3 bg-orange-100 rounded font-medium hover:bg-orange-200 btn text-medium">Ã—</button>
                <button onclick="calcInput('1')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn text-medium">1</button>
                <button onclick="calcInput('2')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn text-medium">2</button>
                <button onclick="calcInput('3')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn text-medium">3</button>
                <button onclick="calcInput('-')" class="p-3 bg-orange-100 rounded font-medium hover:bg-orange-200 btn text-medium">-</button>
                <button onclick="calcClear()" class="p-3 bg-red-100 rounded font-medium hover:bg-red-200 btn text-medium">C</button>
                <button onclick="calcInput('0')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn text-medium">0</button>
                <button onclick="calcInput('.')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn text-medium">.</button>
                <button onclick="calcInput('+')" class="p-3 bg-orange-100 rounded font-medium hover:bg-orange-200 btn text-medium">+</button>
                <button onclick="calcCalculate()" class="p-3 col-span-4 bg-primary text-white rounded font-medium btn text-medium">=</button>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="no-print">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header class="bg-primary text-white shadow-md sticky top-0 z-40">
            <div class="container mx-auto px-3 py-2">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex items-center gap-2">
                        <div class="bg-white/20 p-2 rounded-lg">
                            <i data-lucide="activity" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h1 class="font-semibold text-large">ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h1>
                            <p class="text-small opacity-90">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-1 bg-white/10 px-2 py-1 rounded">
                        <div class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
                        <span class="text-small">Ù…ØªØµÙ„</span>
                    </div>
                </div>
                
                <div class="flex justify-between items-center">
                    <div class="flex gap-1">
                        <button onclick="showModal('transferModal')" class="bg-primary-dark hover:bg-teal-900 p-2 rounded btn" title="ØªØ­ÙˆÙŠÙ„">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        </button>
                        <button onclick="showArchive()" class="bg-primary-dark hover:bg-teal-900 p-2 rounded btn" title="Ø§Ù„Ø£Ø±Ø´ÙŠÙ">
                            <i data-lucide="archive" class="w-4 h-4"></i>
                        </button>
                        <button onclick="showModal('calculatorModal')" class="bg-primary-dark hover:bg-teal-900 p-2 rounded btn" title="Ø­Ø§Ø³Ø¨Ø©">
                            <i data-lucide="calculator" class="w-4 h-4"></i>
                        </button>
                    </div>
                    
                    <div class="tab-container">
                        <button class="tab-btn active" onclick="switchTab('daily')">
                            Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                        </button>
                        <button class="tab-btn" onclick="switchTab('deferred')">
                            Ø§Ù„Ø¢Ø¬Ù„Ø©
                        </button>
                        <button class="tab-btn" onclick="switchTab('reports')">
                            Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
        <main id="dailyTab" class="tab-content active container mx-auto px-3 py-3">
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© -->
            <div class="card">
                <h2 class="section-title">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <form id="txForm" onsubmit="return addTransaction(event)" class="space-y-3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</label>
                            <select id="fundSelect" class="select-field">
                                <option selected>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</option>
                                <option>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</option>
                                <option>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</label>
                            <select id="typeSelect" class="select-field" onchange="toggleAmountField()">
                                <option value="sales">ğŸ’° Ù…Ø¨ÙŠØ¹Ø§Øª Ù†Ù‚Ø¯ÙŠØ©</option>
                                <option value="income">ğŸ’µ Ø§Ù„ÙˆØ§ØµÙ„ / Ø³Ù†Ø¯Ø§Øª Ù‚Ø¨Ø¶</option>
                                <option value="expense">ğŸ“¤ Ø³Ù†Ø¯Ø§Øª ØµØ±Ù Ù…ÙˆØ±Ø¯ÙŠÙ†</option>
                                <option value="petty">ğŸ›’ Ù†Ø«Ø±ÙŠØ§Øª ØµÙŠØ¯Ù„ÙŠØ©</option>
                                <option value="purchase">ğŸ“¦ Ù…Ø´ØªØ±ÙŠØ§Øª Ù†Ù‚Ø¯ÙŠØ©</option>
                                <option value="adv_cash">ğŸ‘¥ Ø³Ù„Ù Ù†Ù‚Ø¯ÙŠØ©</option>
                                <option value="salary_deduction">ğŸ‘¤ Ø®ØµÙ… Ù…ÙˆØ¸ÙÙŠÙ†</option>
                                <option value="shortage">âš ï¸ Ù†ÙˆØ§Ù‚Øµ Ø£Ø¯ÙˆÙŠØ©</option>
                                <option value="alert">ğŸ”” ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</option>
                                <option value="note">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙŠÙˆÙ…ÙŠØ©</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex flex-col md:flex-row gap-3">
                        <div id="amountField" class="w-full md:w-1/3">
                            <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                            <input id="amountInput" type="number" step="0.01" class="input-field font-semibold" placeholder="0.00">
                        </div>
                        
                        <div class="flex-1">
                            <label id="descLabel" class="text-gray-600 mb-1 block font-medium">Ø§Ù„Ø¨ÙŠØ§Ù† / Ø§Ù„ØªÙØ§ØµÙŠÙ„</label>
                            <input id="descInput" type="text" class="input-field" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†..." autocomplete="off">
                        </div>
                    </div>
                    
                    <div id="reportAuthorField" class="hidden">
                        <label class="text-gray-600 mb-1 block font-medium">ÙƒØ§ØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                        <input id="reportAuthor" type="text" class="input-field" placeholder="Ø§Ø³Ù… ÙƒØ§ØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ±">
                    </div>
                    
                    <button type="submit" id="submitBtn" class="w-full p-3 bg-primary text-white rounded font-medium btn text-medium">
                        + Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                    </button>
                </form>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
            <div class="card">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="section-title">Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h2>
                    <div class="flex items-center gap-2">
                        <span class="text-gray-600 text-small" id="txCount">0 Ø¹Ù…Ù„ÙŠØ©</span>
                        <button onclick="clearAllTransactions()" class="px-2 py-1 bg-red-100 text-red-600 rounded text-small font-medium hover:bg-red-200">
                            Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                        </button>
                    </div>
                </div>
                
                <div class="divider"></div>
                
                <div id="txList" class="space-y-2 list-container"></div>
                
                <div id="emptyState" class="text-center py-6 hidden">
                    <div class="text-4xl mb-3">ğŸ“‹</div>
                    <h3 class="text-gray-600 text-medium mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                    <p class="text-gray-500 text-small">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡</p>
                </div>
            </div>
        </main>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¢Ø¬Ù„Ø© -->
        <main id="deferredTab" class="tab-content container mx-auto px-3 py-3">
            <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ø¢Ø¬Ù„Ø© -->
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchDeferredTab('sales')">
                    Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©
                </button>
                <button class="tab-btn" onclick="switchDeferredTab('purchases')">
                    Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©
                </button>
                <button class="tab-btn" onclick="switchDeferredTab('returns')">
                    Ù…Ø±Ø¯ÙˆØ¯Ø§Øª Ø¢Ø¬Ù„Ø©
                </button>
            </div>

            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¢Ø¬Ù„Ø© -->
            <div class="card">
                <h3 class="section-title" id="deferredTitle">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</h3>
                <div class="space-y-3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„Ø§Ø³Ù…</label>
                            <input id="defName" type="text" class="input-field" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…ÙˆØ¸Ù">
                        </div>
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                            <input id="defAmount" type="number" step="0.01" class="input-field font-semibold" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div>
                        <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„ÙˆØµÙ</label>
                        <input id="defDesc" type="text" class="input-field" placeholder="ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 hidden" id="returnFields">
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹</label>
                            <input id="defReference" type="text" class="input-field" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ©">
                        </div>
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯ %</label>
                            <input id="defPercentage" type="number" min="1" max="100" class="input-field" placeholder="100" value="100">
                        </div>
                    </div>
                    
                    <button onclick="addDeferred()" class="w-full p-3 bg-orange-500 text-white rounded font-medium btn text-medium">
                        + Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¢Ø¬Ù„Ø©
                    </button>
                </div>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© -->
            <div class="card">
                <h3 class="section-title" id="deferredListTitle">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h3>
                <div id="deferredList" class="space-y-2 list-container"></div>
                
                <div id="emptyDeferred" class="text-center py-6 hidden">
                    <div class="text-4xl mb-3">ğŸ“…</div>
                    <h3 class="text-gray-600 text-medium mb-2" id="emptyDeferredTitle">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</h3>
                    <p class="text-gray-500 text-small">Ø£Ø¶Ù Ø¹Ù…Ù„ÙŠØ§Øª Ø¢Ø¬Ù„Ø© Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡</p>
                </div>
            </div>
        </main>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
        <main id="reportsTab" class="tab-content container mx-auto px-3 py-3">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                <button onclick="generateReport('daily_summary')" class="card hover:shadow transition-all duration-200 text-right cursor-pointer border border-transparent hover:border-primary">
                    <div class="text-primary font-medium text-medium mb-2">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„</div>
                    <div class="text-gray-600 text-small mb-2">Ù…Ù„Ù PDF Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
                    <div class="mt-2 text-primary">
                        <i data-lucide="file-text" class="w-5 h-5"></i>
                    </div>
                </button>
                
                <button onclick="generateReport('funds')" class="card hover:shadow transition-all duration-200 text-right cursor-pointer border border-transparent hover:border-teal-300">
                    <div class="text-teal-600 font-medium text-medium mb-2">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</div>
                    <div class="text-gray-600 text-small mb-2">ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ù†ÙØµÙ„Ø© Ù„Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø«Ù„Ø§Ø«Ø©</div>
                    <div class="mt-2 text-teal-500">
                        <i data-lucide="credit-card" class="w-5 h-5"></i>
                    </div>
                </button>
                
                <button onclick="generateReport('deferred_detailed')" class="card hover:shadow transition-all duration-200 text-right cursor-pointer border border-transparent hover:border-orange-300">
                    <div class="text-orange-600 font-medium text-medium mb-2">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¢Ø¬Ù„Ø©</div>
                    <div class="text-gray-600 text-small mb-2">Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆÙ…Ø´ØªØ±ÙŠØ§Øª ÙˆÙ…Ø±Ø¯ÙˆØ¯Ø§Øª Ø¢Ø¬Ù„Ø©</div>
                    <div class="mt-2 text-orange-500">
                        <i data-lucide="calendar-clock" class="w-5 h-5"></i>
                    </div>
                </button>
            </div>
            
            <div id="reportsContainer" class="card hidden">
                <div class="flex justify-between items-center mb-3">
                    <h3 id="reportTitle" class="font-medium text-large text-primary"></h3>
                    <div class="flex gap-2">
                        <button onclick="printReport()" class="px-3 py-2 bg-gray-800 text-white text-small rounded font-medium hover:bg-gray-900">
                            <i data-lucide="printer" class="w-3 h-3 inline ml-1"></i>
                            Ø·Ø¨Ø§Ø¹Ø©
                        </button>
                    </div>
                </div>
                <div class="divider"></div>
                <div id="reportContent"></div>
            </div>
        </main>

        <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
        <div class="fixed bottom-0 w-full bg-white border-t p-3 shadow-md z-30 footer">
            <div class="container mx-auto">
                <div class="flex flex-col md:flex-row gap-3 mb-3">
                    <div class="flex-1">
                        <label class="text-gray-600 mb-1 block text-small font-medium">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="currentDate" class="input-field">
                    </div>
                    <div class="flex-1">
                        <label class="text-gray-600 mb-1 block text-small font-medium">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©</label>
                        <input type="text" id="generalNotes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©..." class="input-field">
                    </div>
                </div>
                
                <div class="bg-teal-50 p-3 rounded-lg mb-3 border border-teal-100">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                        <div>
                            <span class="text-gray-600 text-small font-medium">ØµØ§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…:</span>
                            <span id="dailyBalance" class="font-medium text-large text-primary mr-2">0.00</span>
                        </div>
                        <div class="w-full md:w-auto">
                            <label class="text-gray-600 mb-1 block text-small font-medium">Ø§Ø³Ù… Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                            <input type="text" id="preparerName" placeholder="Ø§Ø³Ù… Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±" class="input-field">
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                    <button onclick="printDailyReport()" class="p-3 bg-gray-800 text-white rounded font-medium btn text-medium">
                        <i data-lucide="printer" class="w-4 h-4 inline ml-2"></i>
                        Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„
                    </button>
                    <button onclick="saveAndClose()" class="p-3 bg-red-600 text-white rounded font-medium btn text-medium">
                        <i data-lucide="lock" class="w-4 h-4 inline ml-2"></i>
                        Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
    <div class="print-only p-4">
        <div class="text-center border-b pb-3 mb-4">
            <h1 class="text-xl font-semibold mb-2">ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h1>
            <h2 class="text-large text-gray-700 mb-3">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„</h2>
            <div class="flex justify-between mt-3 text-small">
                <span id="printDate"></span>
                <span id="printPreparer"></span>
            </div>
        </div>
        <div id="printContent"></div>
        <div class="mt-4 p-3 border rounded-lg print-section">
            <strong class="block mb-2 text-medium">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong>
            <p id="printNotes" class="text-small"></p>
        </div>
    </div>

    <script>
        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        // ============================================
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
        
        // ØªØ¹Ø±ÙŠÙ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª - ØªÙ… ØªØºÙŠÙŠØ± "Ø³Ù„Ù Ù†Ù‚Ø¯ÙŠØ© Ù…ÙˆØ¸ÙÙŠÙ†" Ø¥Ù„Ù‰ "Ø³Ù„Ù Ù†Ù‚Ø¯ÙŠØ©"
        const TX_TYPES = {
            'sales': { label: 'Ù…Ø¨ÙŠØ¹Ø§Øª Ù†Ù‚Ø¯ÙŠØ©', type: 'in', color: 'text-green-600', bg: 'sale-bg', icon: 'ğŸ’°' },
            'income': { label: 'Ø§Ù„ÙˆØ§ØµÙ„ / Ø³Ù†Ø¯Ø§Øª Ù‚Ø¨Ø¶', type: 'in', color: 'text-green-600', bg: 'sale-bg', icon: 'ğŸ’µ' },
            'expense': { label: 'Ø³Ù†Ø¯Ø§Øª ØµØ±Ù Ù…ÙˆØ±Ø¯ÙŠÙ†', type: 'out', color: 'text-red-600', bg: 'purchase-bg', icon: 'ğŸ“¤' },
            'petty': { label: 'Ù†Ø«Ø±ÙŠØ§Øª ØµÙŠØ¯Ù„ÙŠØ©', type: 'out', color: 'text-red-600', bg: 'purchase-bg', icon: 'ğŸ›’' },
            'purchase': { label: 'Ù…Ø´ØªØ±ÙŠØ§Øª Ù†Ù‚Ø¯ÙŠØ©', type: 'out', color: 'text-red-600', bg: 'purchase-bg', icon: 'ğŸ“¦' },
            'adv_cash': { label: 'Ø³Ù„Ù Ù†Ù‚Ø¯ÙŠØ©', type: 'out', color: 'text-orange-600', bg: 'advance-bg', icon: 'ğŸ‘¥' }, // ØªØºÙŠÙŠØ± Ù‡Ù†Ø§
            'salary_deduction': { label: 'Ø®ØµÙ… Ù…ÙˆØ¸ÙÙŠÙ†', type: 'out', color: 'text-orange-600', bg: 'advance-bg', icon: 'ğŸ‘¤' },
            'shortage': { label: 'Ù†ÙˆØ§Ù‚Øµ Ø£Ø¯ÙˆÙŠØ©', type: 'none', color: 'text-red-700', bg: 'shortage-bg', icon: 'âš ï¸' },
            'alert': { label: 'ØªÙ†Ø¨ÙŠÙ‡Ø§Øª', type: 'none', color: 'text-yellow-700', bg: 'bg-yellow-50', icon: 'ğŸ””' },
            'note': { label: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙŠÙˆÙ…ÙŠØ©', type: 'none', color: 'text-blue-600', bg: 'bg-blue-50', icon: 'ğŸ“' }
        };
        
        // ØªØ¹Ø±ÙŠÙ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
        const DEFERRED_TYPES = {
            'def_sale': { label: 'Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©', type: 'sale', color: 'sale-text', bg: 'sale-bg', icon: 'ğŸ’°' },
            'def_purchase': { label: 'Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©', type: 'purchase', color: 'purchase-text', bg: 'purchase-bg', icon: 'ğŸ“¦' },
            'def_return_sale': { label: 'Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©', type: 'return', color: 'return-text', bg: 'return-bg', icon: 'ğŸ”„' },
            'def_return_purchase': { label: 'Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©', type: 'return', color: 'return-text', bg: 'return-bg', icon: 'ğŸ”„' },
            'def_emp': { label: 'Ø³Ù„Ù Ø¢Ø¬Ù„Ø©', type: 'advance', color: 'advance-text', bg: 'advance-bg', icon: 'ğŸ‘¥' } // ØªØºÙŠÙŠØ± Ù‡Ù†Ø§
        };
        
        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ø¢Ø¬Ù„Ø©
        let currentDeferredTab = 'sales';
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        let systemData = {
            transactions: JSON.parse(localStorage.getItem('sadara_tx') || '[]'),
            deferred: JSON.parse(localStorage.getItem('sadara_def') || '[]'),
            archives: JSON.parse(localStorage.getItem('sadara_arch') || '[]'),
            settings: JSON.parse(localStorage.getItem('sadara_settings') || '{}')
        };
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        // ============================================
        
        function showModal(modalId) {
            document.getElementById(modalId)?.classList.add('active');
            if (modalId === 'calculatorModal') {
                document.getElementById('calcDisplay').textContent = calcVal;
            }
        }
        
        function hideModal(modalId) {
            document.getElementById(modalId)?.classList.remove('active');
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        // ============================================
        
        function switchTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            document.getElementById(tabName + 'Tab')?.classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø·
            event.target.classList.add('active');
            
            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            if (tabName === 'daily') {
                loadDailyTransactions();
            } else if (tabName === 'deferred') {
                loadDeferredTransactions();
            }
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
        // ============================================
        
        function switchDeferredTab(tabName) {
            currentDeferredTab = tabName;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('#deferredTab .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
            const titles = {
                'sales': 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©',
                'purchases': 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©',
                'returns': 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ù…Ø±Ø¯ÙˆØ¯ Ø¢Ø¬Ù„'
            };
            
            const listTitles = {
                'sales': 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©',
                'purchases': 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©',
                'returns': 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©'
            };
            
            const emptyTitles = {
                'sales': 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©',
                'purchases': 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©',
                'returns': 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø¯ÙˆØ¯Ø§Øª Ø¢Ø¬Ù„Ø©'
            };
            
            document.getElementById('deferredTitle').textContent = titles[tabName];
            document.getElementById('deferredListTitle').textContent = listTitles[tabName];
            document.getElementById('emptyDeferredTitle').textContent = emptyTitles[tabName];
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯
            const returnFields = document.getElementById('returnFields');
            if (tabName === 'returns') {
                returnFields.classList.remove('hidden');
            } else {
                returnFields.classList.add('hidden');
            }
            
            loadDeferredTransactions();
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
        // ============================================
        
        function toggleAmountField() {
            const type = document.getElementById('typeSelect').value;
            const amountField = document.getElementById('amountField');
            const descLabel = document.getElementById('descLabel');
            const authorField = document.getElementById('reportAuthorField');
            const submitBtn = document.getElementById('submitBtn');
            
            // Ø£Ù†ÙˆØ§Ø¹ Ø¨Ø¯ÙˆÙ† Ù…Ø¨Ù„Øº (Ø§Ù„Ù†ÙˆØ§Ù‚ØµØŒ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§ØªØŒ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª)
            const noAmountTypes = ['shortage', 'alert', 'note'];
            
            if (noAmountTypes.includes(type)) {
                amountField.style.display = 'none';
                document.getElementById('amountInput').value = '';
                
                // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„ØªØ³Ù…ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                if (type === 'shortage') {
                    descLabel.textContent = 'Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ø§Ù„Ù†Ø§Ù‚Øµ (Ø§Ù„Ø¯ÙˆØ§Ø¡)';
                } else if (type === 'alert') {
                    descLabel.textContent = 'Ù†Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡';
                } else if (type === 'note') {
                    descLabel.textContent = 'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©';
                    authorField.style.display = 'block';
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                if (type === 'shortage') {
                    submitBtn.innerHTML = 'âš ï¸ ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ù†ÙˆØ§Ù‚Øµ';
                    submitBtn.className = 'w-full p-3 bg-red-600 text-white rounded font-medium btn text-medium';
                } else if (type === 'alert') {
                    submitBtn.innerHTML = 'ğŸ”” Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡';
                    submitBtn.className = 'w-full p-3 bg-yellow-600 text-white rounded font-medium btn text-medium';
                } else if (type === 'note') {
                    submitBtn.innerHTML = 'ğŸ“ Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©';
                    submitBtn.className = 'w-full p-3 bg-blue-600 text-white rounded font-medium btn text-medium';
                }
            } else {
                amountField.style.display = 'block';
                descLabel.textContent = 'Ø§Ù„Ø¨ÙŠØ§Ù† / Ø§Ù„ØªÙØ§ØµÙŠÙ„';
                authorField.style.display = 'none';
                submitBtn.innerHTML = '+ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©';
                submitBtn.className = 'w-full p-3 bg-primary text-white rounded font-medium btn text-medium';
            }
        }
        
        function addTransaction(e) {
            e.preventDefault();
            
            const type = document.getElementById('typeSelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value) || 0;
            const description = document.getElementById('descInput').value;
            const fund = document.getElementById('fundSelect').value;
            const author = document.getElementById('reportAuthor')?.value || '';
            const noAmountTypes = ['shortage', 'alert', 'note'];
            
            if (!description) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†');
                return false;
            }
            
            if (!noAmountTypes.includes(type) && amount <= 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­');
                return false;
            }
            
            const newTransaction = {
                id: Date.now(),
                type: type,
                amount: amount,
                description: description,
                fund: fund,
                author: author,
                date: new Date().toLocaleDateString('ar-EG'),
                time: new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })
            };
            
            systemData.transactions.push(newTransaction);
            saveData();
            loadDailyTransactions();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('descInput').value = '';
            if (!noAmountTypes.includes(type)) {
                document.getElementById('amountInput').value = '';
            }
            if (type === 'note') {
                document.getElementById('reportAuthor').value = '';
            }
            document.getElementById('descInput').focus();
            
            return false;
        }
        
        function loadDailyTransactions() {
            const list = document.getElementById('txList');
            const empty = document.getElementById('emptyState');
            let total = 0;
            
            if (systemData.transactions.length === 0) {
                list.innerHTML = '';
                empty.classList.remove('hidden');
                document.getElementById('txCount').textContent = '0 Ø¹Ù…Ù„ÙŠØ©';
                updateBalance(total);
                return;
            }
            
            empty.classList.add('hidden');
            
            let html = '';
            // Ø¹Ø±Ø¶ Ø¢Ø®Ø± 50 Ø¹Ù…Ù„ÙŠØ© ÙÙ‚Ø· Ù„Ù„Ø£Ø¯Ø§Ø¡
            const recentTxs = systemData.transactions.slice(-50).reverse();
            
            recentTxs.forEach(tx => {
                const typeInfo = TX_TYPES[tx.type];
                
                if (typeInfo.type === 'in') {
                    total += tx.amount;
                } else if (typeInfo.type === 'out') {
                    total -= tx.amount;
                }
                
                html += `
                    <div class="transaction-item ${typeInfo.bg}">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-large">${typeInfo.icon}</span>
                                <span class="text-medium font-medium ${typeInfo.color}">${typeInfo.label}</span>
                                <span class="text-small text-gray-500">${tx.time}</span>
                            </div>
                            <p class="text-gray-800 text-medium mb-1">${tx.description}</p>
                            <p class="text-small text-gray-600">${tx.fund} ${tx.author ? `| ${tx.author}` : ''}</p>
                        </div>
                        <div class="transaction-amount text-right">
                            ${tx.amount > 0 ? `<span class="font-medium text-large ${typeInfo.color}">${tx.amount.toFixed(2)}</span>` : ''}
                            <button onclick="deleteTransaction(${tx.id})" class="block mt-2 text-gray-400 hover:text-red-500 text-small">
                                <i data-lucide="trash-2" class="w-3 h-3 inline ml-1"></i>
                                Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                `;
            });
            
            list.innerHTML = html;
            document.getElementById('txCount').textContent = `${systemData.transactions.length} Ø¹Ù…Ù„ÙŠØ©`;
            updateBalance(total);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
        
        function deleteTransaction(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ')) return;
            
            systemData.transactions = systemData.transactions.filter(tx => tx.id !== id);
            saveData();
            loadDailyTransactions();
        }
        
        function clearAllTransactions() {
            if (systemData.transactions.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ù„Ø­Ø°ÙÙ‡Ø§');
                return;
            }
            
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) return;
            
            systemData.transactions = [];
            saveData();
            loadDailyTransactions();
        }
        
        function updateBalance(total) {
            document.getElementById('dailyBalance').textContent = total.toFixed(2);
            const totalEl = document.getElementById('dailyBalance');
            
            if (total > 0) {
                totalEl.className = 'font-medium text-large text-green-600 mr-2';
            } else if (total < 0) {
                totalEl.className = 'font-medium text-large text-red-600 mr-2';
            } else {
                totalEl.className = 'font-medium text-large text-gray-600 mr-2';
            }
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¢Ø¬Ù„Ø©
        // ============================================
        
        function addDeferred() {
            let type, label;
            
            if (currentDeferredTab === 'sales') {
                type = 'def_sale';
                label = 'Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©';
            } else if (currentDeferredTab === 'purchases') {
                type = 'def_purchase';
                label = 'Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©';
            } else if (currentDeferredTab === 'returns') {
                // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯
                const reference = document.getElementById('defReference').value;
                if (reference && reference.toLowerCase().includes('Ø¨ÙŠØ¹')) {
                    type = 'def_return_sale';
                    label = 'Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©';
                } else {
                    type = 'def_return_purchase';
                    label = 'Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©';
                }
            }
            
            const name = document.getElementById('defName').value;
            let amount = parseFloat(document.getElementById('defAmount').value);
            const desc = document.getElementById('defDesc').value;
            const reference = document.getElementById('defReference').value;
            const percentage = parseFloat(document.getElementById('defPercentage').value) || 100;
            
            if (currentDeferredTab === 'returns') {
                amount = amount * (percentage / 100);
            }
            
            if (!name || !amount) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø¨Ù„Øº');
                return;
            }
            
            const newDeferred = {
                id: Date.now(),
                type: type,
                label: label,
                name: name,
                amount: amount,
                description: desc,
                reference: reference,
                percentage: percentage,
                tab: currentDeferredTab,
                date: new Date().toLocaleDateString('ar-EG')
            };
            
            systemData.deferred.push(newDeferred);
            saveData();
            loadDeferredTransactions();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('defName').value = '';
            document.getElementById('defAmount').value = '';
            document.getElementById('defDesc').value = '';
            document.getElementById('defReference').value = '';
            document.getElementById('defPercentage').value = '100';
        }
        
        function loadDeferredTransactions() {
            const list = document.getElementById('deferredList');
            const empty = document.getElementById('emptyDeferred');
            
            // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
            const filtered = systemData.deferred.filter(item => item.tab === currentDeferredTab);
            
            if (filtered.length === 0) {
                list.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }
            
            empty.classList.add('hidden');
            
            let html = '';
            filtered.forEach(item => {
                const typeInfo = DEFERRED_TYPES[item.type] || { 
                    color: 'text-gray-600', 
                    bg: 'bg-gray-50', 
                    icon: 'ğŸ“‹' 
                };
                
                html += `
                    <div class="transaction-item ${typeInfo.bg}">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-large">${typeInfo.icon}</span>
                                <h4 class="font-medium text-large text-gray-800">${item.name}</h4>
                            </div>
                            <p class="text-gray-700 text-medium mb-1">${item.description || '-'}</p>
                            <div class="flex gap-2 mt-2">
                                <span class="text-small px-2 py-1 bg-white rounded border font-medium ${typeInfo.color}">${item.label}</span>
                                ${item.reference ? `<span class="text-small px-2 py-1 bg-gray-100 rounded">Ù…Ø±Ø¬Ø¹: ${item.reference}</span>` : ''}
                                <span class="text-small text-gray-600">${item.date}</span>
                            </div>
                        </div>
                        <div class="transaction-amount text-right">
                            <span class="font-medium text-large text-gray-800">${item.amount.toFixed(2)}</span>
                            ${item.percentage && item.percentage !== 100 ? `<div class="text-small text-blue-600 mt-1">${item.percentage}%</div>` : ''}
                            <button onclick="deleteDeferred(${item.id})" class="block mt-2 text-gray-400 hover:text-red-500 text-small">
                                <i data-lucide="check-circle" class="w-3 h-3 inline ml-1"></i>
                                ØªØ³ÙˆÙŠØ© ÙˆØ­Ø°Ù
                            </button>
                        </div>
                    </div>
                `;
            });
            
            list.innerHTML = html;
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
        
        function deleteDeferred(id) {
            if (!confirm('Ù‡Ù„ ØªÙ… ØªØ³ÙˆÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ Ø³ÙŠØªÙ… Ø­Ø°ÙÙ‡.')) return;
            
            systemData.deferred = systemData.deferred.filter(item => item.id !== id);
            saveData();
            loadDeferredTransactions();
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        // ============================================
        
        function generateReport(type) {
            const container = document.getElementById('reportsContainer');
            const content = document.getElementById('reportContent');
            const title = document.getElementById('reportTitle');
            
            container.classList.remove('hidden');
            container.scrollIntoView({ behavior: 'smooth' });
            
            switch(type) {
                case 'daily_summary':
                    generateDailySummaryReport(content, title);
                    break;
                    
                case 'funds':
                    generateFundsReport(content, title);
                    break;
                    
                case 'deferred_detailed':
                    generateDeferredDetailedReport(content, title);
                    break;
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
        
        function generateDailySummaryReport(content, title) {
            title.textContent = 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„';
            
            let html = '<div class="space-y-4">';
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©
            const dailyTotal = systemData.transactions.reduce((sum, tx) => {
                const typeInfo = TX_TYPES[tx.type];
                if (typeInfo.type === 'in') return sum + tx.amount;
                if (typeInfo.type === 'out') return sum - tx.amount;
                return sum;
            }, 0);
            
            const shortagesCount = systemData.transactions.filter(tx => tx.type === 'shortage').length;
            const alertsCount = systemData.transactions.filter(tx => tx.type === 'alert').length;
            const notesCount = systemData.transactions.filter(tx => tx.type === 'note').length;
            
            html += `
                <div class="report-section bg-gradient-to-r from-teal-50 to-blue-50">
                    <div class="report-section-title">
                        <i data-lucide="bar-chart" class="w-4 h-4"></i>
                        Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        <div class="bg-white p-3 rounded text-center shadow">
                            <div class="text-large font-medium text-primary">${systemData.transactions.length}</div>
                            <div class="text-small text-gray-600">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
                        </div>
                        <div class="bg-white p-3 rounded text-center shadow">
                            <div class="text-large font-medium text-orange-600">${systemData.deferred.length}</div>
                            <div class="text-small text-gray-600">Ø§Ù„Ø¢Ø¬Ù„Ø©</div>
                        </div>
                        <div class="bg-white p-3 rounded text-center shadow">
                            <div class="text-large font-medium text-red-600">${shortagesCount}</div>
                            <div class="text-small text-gray-600">Ø§Ù„Ù†ÙˆØ§Ù‚Øµ</div>
                        </div>
                        <div class="bg-white p-3 rounded text-center shadow">
                            <div class="text-large font-medium ${dailyTotal >= 0 ? 'text-green-600' : 'text-red-600'}">${dailyTotal.toFixed(2)}</div>
                            <div class="text-small text-gray-600">Ø§Ù„ØµØ§ÙÙŠ</div>
                        </div>
                    </div>
                </div>
            `;
            
            // ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø«Ù„Ø§Ø«Ø©
            html += `
                <div class="report-section">
                    <div class="report-section-title">
                        <i data-lucide="credit-card" class="w-4 h-4"></i>
                        ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
                    </div>
                    <div class="space-y-3">
            `;
            
            const funds = ['ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©', 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ', 'Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ'];
            
            funds.forEach(fund => {
                const fundTransactions = systemData.transactions.filter(tx => tx.fund === fund);
                let fundTotal = 0;
                
                fundTransactions.forEach(tx => {
                    const typeInfo = TX_TYPES[tx.type];
                    if (typeInfo.type === 'in') fundTotal += tx.amount;
                    if (typeInfo.type === 'out') fundTotal -= tx.amount;
                });
                
                html += `
                    <div class="border rounded p-3 ${fundTotal >= 0 ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-medium text-medium">${fund}</h4>
                            <span class="font-medium text-large ${fundTotal >= 0 ? 'text-green-600' : 'text-red-600'}">${fundTotal.toFixed(2)}</span>
                        </div>
                        <div class="text-small text-gray-600 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª: ${fundTransactions.length}</div>
                        ${fundTransactions.slice(0, 3).map(tx => `
                            <div class="flex justify-between py-1 border-b border-gray-200">
                                <span class="text-small">${tx.description.substring(0, 25)}${tx.description.length > 25 ? '...' : ''}</span>
                                <span class="font-medium text-small ${TX_TYPES[tx.type].type === 'in' ? 'text-green-600' : 'text-red-600'}">${tx.amount.toFixed(2)}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            });
            
            html += '</div></div>';
            
            // ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¢Ø¬Ù„Ø©
            html += `
                <div class="report-section">
                    <div class="report-section-title">
                        <i data-lucide="calendar-clock" class="w-4 h-4"></i>
                        ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
                    </div>
            `;
            
            if (systemData.deferred.length === 0) {
                html += '<p class="text-gray-500 text-center py-4 text-medium">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø¢Ø¬Ù„Ø©</p>';
            } else {
                // ØªØµÙ†ÙŠÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
                const sales = systemData.deferred.filter(d => d.type === 'def_sale');
                const purchases = systemData.deferred.filter(d => d.type === 'def_purchase');
                const returnSales = systemData.deferred.filter(d => d.type === 'def_return_sale');
                const returnPurchases = systemData.deferred.filter(d => d.type === 'def_return_purchase');
                
                html += `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div class="bg-green-50 border border-green-200 rounded p-3">
                            <h5 class="font-medium text-medium text-green-700 mb-2">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h5>
                            <div class="text-large font-medium text-green-700 mb-1">${sales.reduce((sum, s) => sum + s.amount, 0).toFixed(2)}</div>
                            <div class="text-small text-gray-600">Ø¹Ø¯Ø¯: ${sales.length}</div>
                        </div>
                        
                        <div class="bg-red-50 border border-red-200 rounded p-3">
                            <h5 class="font-medium text-medium text-red-700 mb-2">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h5>
                            <div class="text-large font-medium text-red-700 mb-1">${purchases.reduce((sum, p) => sum + p.amount, 0).toFixed(2)}</div>
                            <div class="text-small text-gray-600">Ø¹Ø¯Ø¯: ${purchases.length}</div>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded p-3">
                            <h5 class="font-medium text-medium text-blue-700 mb-2">Ù…Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h5>
                            <div class="text-large font-medium text-blue-700 mb-1">${returnSales.reduce((sum, rs) => sum + rs.amount, 0).toFixed(2)}</div>
                            <div class="text-small text-gray-600">Ø¹Ø¯Ø¯: ${returnSales.length}</div>
                        </div>
                        
                        <div class="bg-indigo-50 border border-indigo-200 rounded p-3">
                            <h5 class="font-medium text-medium text-indigo-700 mb-2">Ù…Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h5>
                            <div class="text-large font-medium text-indigo-700 mb-1">${returnPurchases.reduce((sum, rp) => sum + rp.amount, 0).toFixed(2)}</div>
                            <div class="text-small text-gray-600">Ø¹Ø¯Ø¯: ${returnPurchases.length}</div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            html += '</div>'; // Ù†Ù‡Ø§ÙŠØ© space-y-4
            
            content.innerHTML = html;
        }
        
        function generateFundsReport(content, title) {
            title.textContent = 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ù†ÙØµÙ„Ø©';
            
            let html = '<div class="space-y-4">';
            
            const funds = [
                { name: 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©', color: 'primary', icon: 'wallet' },
                { name: 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ', color: 'teal', icon: 'credit-card' },
                { name: 'Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', color: 'blue', icon: 'banknote' }
            ];
            
            funds.forEach(fund => {
                const fundTransactions = systemData.transactions.filter(tx => tx.fund === fund.name);
                let fundIn = 0;
                let fundOut = 0;
                let fundTotal = 0;
                
                fundTransactions.forEach(tx => {
                    const typeInfo = TX_TYPES[tx.type];
                    if (typeInfo.type === 'in') {
                        fundIn += tx.amount;
                        fundTotal += tx.amount;
                    }
                    if (typeInfo.type === 'out') {
                        fundOut += tx.amount;
                        fundTotal -= tx.amount;
                    }
                });
                
                html += `
                    <div class="report-section border border-${fund.color}-200 bg-${fund.color}-50">
                        <div class="report-section-title text-${fund.color}-700">
                            <i data-lucide="${fund.icon}" class="w-4 h-4"></i>
                            ${fund.name}
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-3">
                            <div class="bg-white p-3 rounded text-center">
                                <div class="text-large font-medium text-green-600">${fundIn.toFixed(2)}</div>
                                <div class="text-small text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ§Ø±Ø¯</div>
                            </div>
                            <div class="bg-white p-3 rounded text-center">
                                <div class="text-large font-medium text-red-600">${fundOut.toFixed(2)}</div>
                                <div class="text-small text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØµØ±Ù</div>
                            </div>
                            <div class="bg-white p-3 rounded text-center">
                                <div class="text-large font-medium ${fundTotal >= 0 ? 'text-green-600' : 'text-red-600'}">${fundTotal.toFixed(2)}</div>
                                <div class="text-small text-gray-600">ØµØ§ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</div>
                            </div>
                        </div>
                        
                        <h5 class="font-medium text-medium mb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (${fundTransactions.length})</h5>
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse text-small">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="p-2 border text-right">Ø§Ù„Ù†ÙˆØ¹</th>
                                        <th class="p-2 border text-right">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                        <th class="p-2 border text-right">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                        <th class="p-2 border text-right">Ø§Ù„ÙˆÙ‚Øª</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                fundTransactions.slice(0, 15).forEach(tx => {
                    const typeInfo = TX_TYPES[tx.type];
                    html += `
                        <tr class="hover:bg-gray-50">
                            <td class="p-2 border text-small ${typeInfo.color}">${typeInfo.label}</td>
                            <td class="p-2 border text-small">${tx.description}</td>
                            <td class="p-2 border font-medium ${typeInfo.type === 'in' ? 'text-green-600' : 'text-red-600'}">${tx.amount.toFixed(2)}</td>
                            <td class="p-2 border text-gray-600">${tx.time}</td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                        ${fundTransactions.length > 15 ? `<div class="mt-2 text-center text-small text-gray-600">Ùˆ ${fundTransactions.length - 15} Ø¹Ù…Ù„ÙŠØ© Ø£Ø®Ø±Ù‰</div>` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }
        
        function generateDeferredDetailedReport(content, title) {
            title.textContent = 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© Ø§Ù„ØªÙØµÙŠÙ„ÙŠ';
            
            let html = '<div class="space-y-4">';
            
            // ØªØµÙ†ÙŠÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
            const sales = systemData.deferred.filter(d => d.type === 'def_sale');
            const purchases = systemData.deferred.filter(d => d.type === 'def_purchase');
            const returnSales = systemData.deferred.filter(d => d.type === 'def_return_sale');
            const returnPurchases = systemData.deferred.filter(d => d.type === 'def_return_purchase');
            const advances = systemData.deferred.filter(d => d.type === 'def_emp');
            
            const sections = [
                { 
                    title: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©', 
                    data: sales, 
                    color: 'green', 
                    icon: 'shopping-bag',
                    total: sales.reduce((sum, s) => sum + s.amount, 0)
                },
                { 
                    title: 'Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©', 
                    data: purchases, 
                    color: 'red', 
                    icon: 'package',
                    total: purchases.reduce((sum, p) => sum + p.amount, 0)
                },
                { 
                    title: 'Ù…Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©', 
                    data: returnSales, 
                    color: 'blue', 
                    icon: 'rotate-ccw',
                    total: returnSales.reduce((sum, rs) => sum + rs.amount, 0)
                },
                { 
                    title: 'Ù…Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©', 
                    data: returnPurchases, 
                    color: 'indigo', 
                    icon: 'rotate-cw',
                    total: returnPurchases.reduce((sum, rp) => sum + rp.amount, 0)
                },
                { 
                    title: 'Ø³Ù„Ù Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø¢Ø¬Ù„Ø©', 
                    data: advances, 
                    color: 'orange', 
                    icon: 'users',
                    total: advances.reduce((sum, a) => sum + a.amount, 0)
                }
            ];
            
            sections.forEach(section => {
                if (section.data.length === 0) return;
                
                html += `
                    <div class="report-section border border-${section.color}-200 bg-${section.color}-50">
                        <div class="report-section-title text-${section.color}-700">
                            <i data-lucide="${section.icon}" class="w-4 h-4"></i>
                            ${section.title}
                            <span class="mr-auto text-large font-medium">${section.total.toFixed(2)}</span>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse text-small">
                                <thead>
                                    <tr class="bg-white">
                                        <th class="p-2 border text-right">Ø§Ù„Ø§Ø³Ù…</th>
                                        <th class="p-2 border text-right">Ø§Ù„ÙˆØµÙ</th>
                                        <th class="p-2 border text-right">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                        <th class="p-2 border text-right">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                        <th class="p-2 border text-right">Ø®ÙŠØ§Ø±Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                section.data.forEach(item => {
                    html += `
                        <tr class="hover:bg-white/80">
                            <td class="p-2 border font-medium">${item.name}</td>
                            <td class="p-2 border">${item.description || '-'}</td>
                            <td class="p-2 border font-medium text-${section.color}-600">${item.amount.toFixed(2)}</td>
                            <td class="p-2 border text-gray-600">${item.date}</td>
                            <td class="p-2 border">
                                <button onclick="deleteDeferred(${item.id})" class="px-2 py-1 bg-red-100 text-red-600 rounded text-small hover:bg-red-200">
                                    ØªØ³ÙˆÙŠØ©
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-2 text-center text-small text-gray-600">
                            Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${section.title.toLowerCase()}: <span class="font-medium text-${section.color}-700">${section.total.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            });
            
            if (systemData.deferred.length === 0) {
                html += '<p class="text-gray-500 text-center py-6 text-medium">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø¢Ø¬Ù„Ø© Ù…Ø³Ø¬Ù„Ø©</p>';
            }
            
            html += '</div>';
            content.innerHTML = html;
        }
        
        function printReport() {
            const content = document.getElementById('reportContent').innerHTML;
            const title = document.getElementById('reportTitle').textContent;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>${title}</title>
                    <style>
                        body { font-family: 'Noto Sans Arabic', sans-serif; padding: 15px; background: white; font-size: 12px; }
                        h1 { text-align: center; color: #0d9488; font-size: 18px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0; }
                        .date { text-align: left; color: #666; font-size: 11px; margin-bottom: 15px; }
                        .print-section { break-inside: avoid; margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
                        .section-title { font-size: 14px; font-weight: 600; color: #0d9488; margin-bottom: 8px; padding-bottom: 5px; border-bottom: 1px solid #e2e8f0; }
                        table { width: 100%; border-collapse: collapse; margin: 8px 0; font-size: 11px; }
                        th { background: #f8fafc; padding: 6px; border: 1px solid #ddd; text-align: right; font-weight: 600; }
                        td { padding: 5px; border: 1px solid #ddd; text-align: right; }
                        .total-box { background: #f0f9ff; padding: 8px; border-radius: 4px; margin: 10px 0; border: 1px solid #bae6fd; }
                        @media print {
                            body { padding: 10px; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    <div class="date">${new Date().toLocaleDateString('ar-EG')} - ${new Date().toLocaleTimeString('ar-EG')}</div>
                    ${content}
                    <div class="no-print" style="text-align:center; margin-top:20px; padding-top:10px; border-top:1px solid #ddd; color:#666; font-size:11px;">
                        ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…Ù† Ù†Ø¸Ø§Ù… ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø© - ${new Date().toLocaleDateString('ar-EG')}
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        function printDailyReport() {
            const printContent = document.getElementById('printContent');
            const printDate = document.getElementById('printDate');
            const printPreparer = document.getElementById('printPreparer');
            const printNotes = document.getElementById('printNotes');
            
            const preparer = document.getElementById('preparerName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const notes = document.getElementById('generalNotes').value || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª';
            const date = document.getElementById('currentDate').value || new Date().toLocaleDateString('ar-EG');
            
            printDate.textContent = `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}`;
            printPreparer.textContent = `Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${preparer}`;
            printNotes.textContent = notes;
            
            let html = '<div class="print-section">';
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©
            const dailyTotal = systemData.transactions.reduce((sum, tx) => {
                const typeInfo = TX_TYPES[tx.type];
                if (typeInfo.type === 'in') return sum + tx.amount;
                if (typeInfo.type === 'out') return sum - tx.amount;
                return sum;
            }, 0);
            
            html += `
                <h3 class="section-title">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                <table class="print-table">
                    <tr>
                        <td>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</td>
                        <td><strong>${systemData.transactions.length}</strong></td>
                        <td>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</td>
                        <td><strong>${systemData.deferred.length}</strong></td>
                    </tr>
                    <tr>
                        <td>ØµØ§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…</td>
                        <td colspan="3"><strong class="${dailyTotal >= 0 ? 'text-green-600' : 'text-red-600'}">${dailyTotal.toFixed(2)}</strong></td>
                    </tr>
                </table>
            `;
            
            html += '</div>';
            
            // ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
            html += '<div class="print-section">';
            html += '<h3 class="section-title">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</h3>';
            
            const funds = ['ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©', 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ', 'Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ'];
            funds.forEach(fund => {
                const fundTransactions = systemData.transactions.filter(tx => tx.fund === fund);
                let fundTotal = 0;
                
                fundTransactions.forEach(tx => {
                    const typeInfo = TX_TYPES[tx.type];
                    if (typeInfo.type === 'in') fundTotal += tx.amount;
                    if (typeInfo.type === 'out') fundTotal -= tx.amount;
                });
                
                html += `
                    <div style="margin-bottom: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 3px;">
                        <h4 style="font-weight:600; margin-bottom:5px; font-size:13px;">${fund}</h4>
                        <div style="display:flex; justify-content:space-between; font-size:12px;">
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª: ${fundTransactions.length}</span>
                            <span style="font-weight:600; ${fundTotal >= 0 ? 'color:green' : 'color:red'}">${fundTotal.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¢Ø¬Ù„Ø©
            if (systemData.deferred.length > 0) {
                html += '<div class="print-section">';
                html += '<h3 class="section-title">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h3>';
                
                const sales = systemData.deferred.filter(d => d.type === 'def_sale');
                const purchases = systemData.deferred.filter(d => d.type === 'def_purchase');
                const returnSales = systemData.deferred.filter(d => d.type === 'def_return_sale');
                const returnPurchases = systemData.deferred.filter(d => d.type === 'def_return_purchase');
                
                html += `
                    <table class="print-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„Ø¹Ø¯Ø¯</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sales.length > 0 ? `<tr><td>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</td><td>${sales.length}</td><td>${sales.reduce((s, a) => s + a.amount, 0).toFixed(2)}</td></tr>` : ''}
                            ${purchases.length > 0 ? `<tr><td>Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</td><td>${purchases.length}</td><td>${purchases.reduce((s, a) => s + a.amount, 0).toFixed(2)}</td></tr>` : ''}
                            ${returnSales.length > 0 ? `<tr><td>Ù…Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</td><td>${returnSales.length}</td><td>${returnSales.reduce((s, a) => s + a.amount, 0).toFixed(2)}</td></tr>` : ''}
                            ${returnPurchases.length > 0 ? `<tr><td>Ù…Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</td><td>${returnPurchases.length}</td><td>${returnPurchases.reduce((s, a) => s + a.amount, 0).toFixed(2)}</td></tr>` : ''}
                        </tbody>
                    </table>
                `;
                
                html += '</div>';
            }
            
            printContent.innerHTML = html;
            window.print();
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        // ============================================
        
        function saveData() {
            try {
                localStorage.setItem('sadara_tx', JSON.stringify(systemData.transactions));
                localStorage.setItem('sadara_def', JSON.stringify(systemData.deferred));
                localStorage.setItem('sadara_arch', JSON.stringify(systemData.archives));
                localStorage.setItem('sadara_settings', JSON.stringify(systemData.settings));
            } catch (e) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', e);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            }
        }
        
        function executeTransfer() {
            const from = document.getElementById('tFrom').value;
            const to = document.getElementById('tTo').value;
            const amount = parseFloat(document.getElementById('tAmount').value);
            
            if (from === to) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù†ÙØ³ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚');
                return;
            }
            
            if (!amount || amount <= 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­');
                return;
            }
            
            const time = new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
            
            // Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØªÙŠÙ† Ù„Ù„ØªØ­ÙˆÙŠÙ„
            const tx1 = {
                id: Date.now(),
                type: 'expense',
                amount: amount,
                description: `ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ${to}`,
                fund: from,
                date: new Date().toLocaleDateString('ar-EG'),
                time: time
            };
            
            const tx2 = {
                id: Date.now() + 1,
                type: 'income',
                amount: amount,
                description: `ØªØ­ÙˆÙŠÙ„ Ù…Ù† ${from}`,
                fund: to,
                date: new Date().toLocaleDateString('ar-EG'),
                time: time
            };
            
            systemData.transactions.push(tx1, tx2);
            saveData();
            loadDailyTransactions();
            hideModal('transferModal');
            
            document.getElementById('tAmount').value = '';
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
        
        function showArchive() {
            if (systemData.archives.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø¤Ø±Ø´ÙØ©');
                return;
            }
            
            let archiveContent = '<h1 style="text-align:center; color:#0d9488; font-size:18px; margin-bottom:20px;">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¤Ø±Ø´ÙØ©</h1>';
            
            systemData.archives.slice(0, 15).forEach((archive, index) => {
                archiveContent += `
                    <div style="border:1px solid #e2e8f0; padding:15px; margin-bottom:15px; border-radius:8px; background:#f8fafc;">
                        <div style="font-weight:600; color:#0d9488; font-size:14px;">${archive.date}</div>
                        <div style="font-size:12px; color:#666; margin:5px 0;">
                            Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${archive.preparer || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} | Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª: ${archive.transactions?.length || 0}
                        </div>
                        <div style="font-size:12px; color:#666; margin:5px 0;">${archive.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª'}</div>
                        <button onclick="printArchive(${index})" style="background:#0d9488; color:white; border:none; padding:8px 15px; border-radius:5px; margin-top:10px; cursor:pointer; font-size:12px; font-weight:600;">
                            Ø¹Ø±Ø¶ ÙˆØ·Ø¨Ø§Ø¹Ø©
                        </button>
                    </div>
                `;
            });
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>Ø§Ù„Ø£Ø±Ø´ÙŠÙ</title>
                    <style>
                        body { font-family: 'Noto Sans Arabic', sans-serif; padding: 20px; background:#f5f7fa; font-size: 12px; }
                        h1 { text-align: center; color: #0d9488; }
                        .container { max-width: 800px; margin: 0 auto; }
                        button:hover { background: #0f766e !important; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        ${archiveContent}
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
        }
        
        function saveAndClose() {
            if (systemData.transactions.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
                return;
            }
            
            if (!confirm('Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ØŸ Ø³ØªØ­ÙØ¸ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ.')) return;
            
            const preparer = document.getElementById('preparerName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const notes = document.getElementById('generalNotes').value || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª';
            const date = document.getElementById('currentDate').value || new Date().toLocaleDateString('ar-EG');
            
            const archive = {
                date: date,
                preparer: preparer,
                notes: notes,
                transactions: [...systemData.transactions],
                deferred: [...systemData.deferred],
                timestamp: new Date().toISOString()
            };
            
            systemData.archives.push(archive);
            
            // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            systemData.transactions = [];
            systemData.deferred = [];
            document.getElementById('generalNotes').value = '';
            document.getElementById('preparerName').value = '';
            
            saveData();
            loadDailyTransactions();
            loadDeferredTransactions();
            
            alert('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ');
        }
        
        // ============================================
        // Ø§Ù„Ø¢Ù„Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
        // ============================================
        
        let calcVal = "0";
        
        function calcInput(v) {
            if (calcVal === "0") calcVal = v;
            else calcVal += v;
            document.getElementById('calcDisplay').textContent = calcVal;
        }
        
        function calcClear() {
            calcVal = "0";
            document.getElementById('calcDisplay').textContent = calcVal;
        }
        
        function calcCalculate() {
            try {
                calcVal = eval(calcVal.replace(/Ã—/g, '*').replace(/Ã·/g, '/')).toString();
            } catch {
                calcVal = "Error";
            }
            document.getElementById('calcDisplay').textContent = calcVal;
        }
        
        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        // ============================================
        
        function initPage() {
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('currentDate').value = today;
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            loadDailyTransactions();
            
            // ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…
            updateBalance(0);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ ÙƒØ§ØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            document.getElementById('reportAuthorField').style.display = 'none';
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.3s ease';
                document.body.style.opacity = '1';
            }, 100);
            
            console.log('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø³Ù‘Ù† Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>