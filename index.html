<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø© - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ¹ V8.0</title>
    
    <!-- Ø§Ø³ØªØ®Ø¯Ø§Ù… CDN Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø³Ø±Ø¹Ø© -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Ù…ÙƒØªØ¨Ø© html2pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        * { 
            font-family: 'Noto Sans Arabic', sans-serif;
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            background: #f5f7fa;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white !important; font-size: 12px; }
            @page { margin: 0.5cm; }
            .print-table { border-collapse: collapse; width: 100%; font-size: 11px; }
            .print-table th, .print-table td { border: 1px solid #ddd; padding: 5px; text-align: right; }
            .print-section { break-inside: avoid; margin-bottom: 15px; }
            .print-images { page-break-inside: avoid; margin-top: 20px; }
            .print-image { max-width: 100%; height: auto; margin-bottom: 10px; border: 1px solid #ddd; }
            .page-break { page-break-before: always; }
        }
        
        .print-only { display: none; }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid #eef2f7;
        }
        
        .transaction-item {
            background: white;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            border: 1px solid #eef2f7;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .transaction-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-color: #cbd5e1;
        }
        
        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .mobile-stack { flex-direction: column; }
            .mobile-full { width: 100%; }
            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .transaction-amount {
                align-self: flex-end;
                margin-top: 8px;
            }
            body { font-size: 13px; }
            .image-preview { max-width: 100px; max-height: 100px; }
        }
        
        /* ØªØ®ØµÙŠØµ Ø£Ù„ÙˆØ§Ù† */
        .bg-primary { background-color: #0d9488; }
        .bg-primary-dark { background-color: #0f766e; }
        .text-primary { color: #0d9488; }
        .border-primary { border-color: #0d9488; }
        
        /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        .list-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ */
        .input-field {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
            width: 100%;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #0d9488;
            box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.1);
        }
        
        .select-field {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
            width: 100%;
            cursor: pointer;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            transition: all 0.2s ease;
            border-radius: 6px;
            font-weight: 500;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© */
        .sale-bg { background-color: #f0fdf4; border-color: #dcfce7; }
        .sale-text { color: #166534; }
        .purchase-bg { background-color: #fef2f2; border-color: #fee2e2; }
        .purchase-text { color: #991b1b; }
        .advance-bg { background-color: #fff7ed; border-color: #ffedd5; }
        .advance-text { color: #9a3412; }
        .return-sale-bg { background-color: #ecfdf5; border-color: #d1fae5; }
        .return-sale-text { color: #065f46; }
        .return-purchase-bg { background-color: #fef2f2; border-color: #fee2e2; }
        .return-purchase-text { color: #b91c1c; }
        .shortage-bg { background-color: #fef2f2; border-color: #fee2e2; }
        .shortage-text { color: #dc2626; }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù†ØµÙˆØµ */
        .text-small { font-size: 12px; }
        .text-medium { font-size: 14px; }
        .text-large { font-size: 16px; }
        .text-xlarge { font-size: 18px; }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tab-container {
            display: flex;
            background: #f1f5f9;
            border-radius: 6px;
            padding: 4px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            flex: 1;
            text-align: center;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            min-width: 80px;
            margin: 1px;
        }
        
        .tab-btn.active {
            background: white;
            color: #0d9488;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #0d9488;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ */
        .icon-fallback {
            font-size: 20px;
            display: inline-block;
            margin-right: 5px;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ØµÙˆØ± */
        .image-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f9fafb;
        }
        
        .image-upload-area:hover {
            border-color: #0d9488;
            background: #f0f9ff;
        }
        
        .image-upload-area.dragover {
            border-color: #0d9488;
            background: #e0f2fe;
        }
        
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .image-preview {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid #e5e7eb;
            transition: transform 0.2s ease;
        }
        
        .image-preview:hover {
            transform: scale(1.05);
            border-color: #0d9488;
        }
        
        .image-item {
            position: relative;
            display: inline-block;
        }
        
        .image-remove {
            position: absolute;
            top: -8px;
            left: -8px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .image-remove:hover {
            background: #dc2626;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© */
        .image-manager-section {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
        .report-section {
            margin-bottom: 20px;
        }
        
        .report-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #0d9488;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
        }
        
        .transaction-date {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 8px 12px;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        /* Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® */
        .date-picker-modal {
            z-index: 10000;
        }
        
        .date-picker-header {
            background: #0d9488;
            color: white;
            padding: 15px;
            border-radius: 8px 8px 0 0;
        }
        
        .date-picker-body {
            background: white;
            padding: 20px;
            border-radius: 0 0 8px 8px;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª PDF */
        .pdf-options {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loader.active {
            display: flex;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0d9488;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
        .report-card {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .ring-2 {
            box-shadow: 0 0 0 2px #0d9488;
        }
    </style>
</head>
<body class="min-h-screen text-gray-800">

    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loader" class="loader">
        <div class="spinner"></div>
        <div class="mt-4 text-primary font-medium" id="loaderText">Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF...</div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± -->
    <div id="uploadModal" class="modal">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-2xl m-4 max-h-[90vh] overflow-auto">
            <div class="bg-primary p-4 flex justify-between items-center text-white rounded-t-lg sticky top-0 z-10">
                <h3 class="font-semibold text-medium">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h3>
                <button onclick="hideModal('uploadModal')" class="hover:bg-primary-dark p-2 rounded transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-5">
                <!-- Ù…Ù†Ø·Ù‚Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± -->
                <div class="mb-6">
                    <h4 class="font-medium text-medium mb-3 text-gray-700">Ø±ÙØ¹ ØµÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©</h4>
                    <div id="imageUploadArea" class="image-upload-area" onclick="document.getElementById('imageInput').click()">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                        <p class="text-gray-600 mb-2">Ø§Ù†Ù‚Ø± Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± Ù‡Ù†Ø§</p>
                        <p class="text-gray-500 text-small">ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ ØµÙˆØ± JPG, PNG, GIF (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB Ù„ÙƒÙ„ ØµÙˆØ±Ø©)</p>
                        <input type="file" id="imageInput" accept="image/*" multiple style="display: none;" onchange="handleImageUpload(event)">
                    </div>
                    
                    <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© Ø­Ø¯ÙŠØ«Ù‹Ø§ -->
                    <div id="imagePreviews" class="image-preview-container mt-4"></div>
                </div>
                
                <!-- Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© -->
                <div class="image-manager-section">
                    <h4 class="font-medium text-medium mb-3 text-gray-700">Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h4>
                    <div id="savedImages" class="image-preview-container">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                    </div>
                    <div id="noImagesMessage" class="text-center py-8 text-gray-500 hidden">
                        <i class="fas fa-images text-4xl mb-3"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù…Ø±ÙÙˆØ¹Ø© Ø¨Ø¹Ø¯</p>
                    </div>
                </div>
                
                <!-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ -->
                <button onclick="hideModal('uploadModal')" class="w-full mt-6 p-3 bg-gray-800 text-white rounded font-medium btn text-medium">
                    <i class="fas fa-check mr-2"></i>ØªÙ…
                </button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ -->
    <div id="transferModal" class="modal">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md m-4">
            <div class="bg-primary p-4 flex justify-between items-center text-white rounded-t-lg">
                <h3 class="font-semibold text-medium">ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</h3>
                <button onclick="hideModal('transferModal')" class="hover:bg-primary-dark p-2 rounded transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label class="text-gray-600 mb-1 block font-medium">Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚</label>
                    <select id="tFrom" class="select-field">
                        <option>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</option>
                        <option>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</option>
                        <option>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                    </select>
                </div>
                <div>
                    <label class="text-gray-600 mb-1 block font-medium">Ø¥Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚</label>
                    <select id="tTo" class="select-field">
                        <option>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</option>
                        <option>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</option>
                        <option>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                    </select>
                </div>
                <div>
                    <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                    <input id="tAmount" type="number" step="0.01" class="input-field w-full font-semibold" placeholder="0.00">
                </div>
                <button onclick="executeTransfer()" class="w-full p-3 bg-primary text-white rounded font-medium btn text-medium">
                    ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„
                </button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
    <div id="reportDateModal" class="modal date-picker-modal">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md m-4">
            <div class="date-picker-header flex justify-between items-center">
                <h3 class="font-semibold text-medium">Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
                <button onclick="hideModal('reportDateModal')" class="hover:bg-teal-800 p-2 rounded transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="date-picker-body space-y-4">
                <div>
                    <label class="text-gray-600 mb-1 block font-medium">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                    <input type="date" id="reportDateSelect" class="input-field w-full text-center text-large font-semibold">
                </div>
                
                <div class="bg-blue-50 p-3 rounded">
                    <p class="text-small text-gray-600 mb-2">
                        <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                        Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯
                    </p>
                    <div class="flex gap-2">
                        <button onclick="generateReportForSelectedDate()" class="flex-1 p-3 bg-primary text-white rounded font-medium btn">
                            <i class="fas fa-eye mr-2"></i>Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button onclick="printReportForSelectedDate()" class="flex-1 p-3 bg-gray-800 text-white rounded font-medium btn">
                            <i class="fas fa-print mr-2"></i>Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
                        </button>
                    </div>
                </div>
                
                <div>
                    <label class="text-gray-600 mb-2 block font-medium">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <div id="savedReportDates" class="space-y-2 max-h-40 overflow-y-auto">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
    <div id="quickReportModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg m-4">
            <div class="bg-primary p-4 flex justify-between items-center text-white rounded-t-lg">
                <h3 class="font-semibold text-large">ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø³Ø±ÙŠØ¹Ø©</h3>
                <button onclick="hideModal('quickReportModal')" class="hover:bg-primary-dark p-2 rounded transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <!-- Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ -->
                <div class="mb-4">
                    <input type="text" id="reportSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† ØªÙ‚Ø±ÙŠØ±..." 
                           class="w-full p-3 border rounded-lg text-medium"
                           onkeyup="filterReports()">
                </div>

                <!-- Ø´Ø¨ÙƒØ© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
                <div class="grid grid-cols-2 gap-3" id="reportsGrid">
                    <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>

                <!-- Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© -->
                <div class="mt-6 border-t pt-4">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-medium text-medium text-gray-700">âš™ï¸ Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</h4>
                        <button onclick="toggleAdvancedOptions()" class="text-primary text-small">
                            <i class="fas fa-cog mr-1"></i>Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡
                        </button>
                    </div>
                    <div id="advancedOptions" class="hidden space-y-3">
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">ğŸ“… Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ</label>
                            <select id="timeRange" class="select-field">
                                <option value="today">Ø§Ù„ÙŠÙˆÙ…</option>
                                <option value="yesterday">Ø£Ù…Ø³</option>
                                <option value="week">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</option>
                                <option value="month">Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</option>
                                <option value="custom">Ù…Ø®ØµØµ</option>
                            </select>
                        </div>
                        <div id="customDateRange" class="hidden grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-gray-600 mb-1 block text-small">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                                <input type="date" id="dateFrom" class="input-field">
                            </div>
                            <div>
                                <label class="text-gray-600 mb-1 block text-small">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                                <input type="date" id="dateTo" class="input-field">
                            </div>
                        </div>
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">ğŸ“ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù</label>
                            <select id="exportFormat" class="select-field">
                                <option value="print">Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</option>
                                <option value="pdf">PDF Ù…Ø¹ ØµÙˆØ±</option>
                                <option value="pdf_nopic">PDF Ø¨Ø¯ÙˆÙ† ØµÙˆØ±</option>
                                <option value="excel">Excel (CSV)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-between">
                <button onclick="hideModal('quickReportModal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
                <button onclick="generateQuickReport()" class="px-4 py-2 bg-primary text-white rounded font-medium btn">
                    <i class="fas fa-play mr-2"></i>ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="no-print">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header class="bg-primary text-white shadow-md sticky top-0 z-40">
            <div class="container mx-auto px-3 py-2">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex items-center gap-2">
                        <div class="bg-white/20 p-2 rounded-lg">
                            <i class="fas fa-heartbeat icon-fallback"></i>
                        </div>
                        <div>
                            <h1 class="font-semibold text-large">ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h1>
                            <p class="text-small opacity-90">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© V8.0</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-1 bg-white/10 px-2 py-1 rounded">
                        <div class="w-2 h-2 rounded-full bg-green-400"></div>
                        <span class="text-small">Ù…ØªØµÙ„</span>
                    </div>
                </div>
                
                <div class="flex justify-between items-center">
                    <div class="flex gap-1">
                        <button onclick="showModal('transferModal')" class="bg-primary-dark hover:bg-teal-900 p-2 rounded btn" title="ØªØ­ÙˆÙŠÙ„">
                            <i class="fas fa-exchange-alt"></i>
                        </button>
                        <button onclick="showModal('uploadModal')" class="bg-primary-dark hover:bg-teal-900 p-2 rounded btn" title="Ø±ÙØ¹ ØµÙˆØ±">
                            <i class="fas fa-images"></i>
                        </button>
                        <button onclick="showModal('reportDateModal')" class="bg-primary-dark hover:bg-teal-900 p-2 rounded btn" title="ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®">
                            <i class="fas fa-calendar-day"></i>
                        </button>
                        <button onclick="showModal('quickReportModal')" class="bg-primary-dark hover:bg-teal-900 p-2 rounded btn" title="ØªÙ‚Ø§Ø±ÙŠØ± Ø³Ø±ÙŠØ¹Ø©">
                            <i class="fas fa-rocket"></i>
                        </button>
                        <button onclick="showArchive()" class="bg-primary-dark hover:bg-teal-900 p-2 rounded btn" title="Ø§Ù„Ø£Ø±Ø´ÙŠÙ">
                            <i class="fas fa-archive"></i>
                        </button>
                        <button onclick="showCalculator()" class="bg-primary-dark hover:bg-teal-900 p-2 rounded btn" title="Ø­Ø§Ø³Ø¨Ø©">
                            <i class="fas fa-calculator"></i>
                        </button>
                    </div>
                    
                    <div class="tab-container">
                        <button class="tab-btn active" onclick="switchTab('daily')" id="dailyTabBtn">
                            Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                        </button>
                        <button class="tab-btn" onclick="switchTab('deferred')" id="deferredTabBtn">
                            Ø§Ù„Ø¢Ø¬Ù„Ø©
                        </button>
                        <button class="tab-btn" onclick="switchTab('reports')" id="reportsTabBtn">
                            Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
        <main id="dailyTab" class="tab-content active container mx-auto px-3 py-3">
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© -->
            <div class="card">
                <h2 class="section-title">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <form id="txForm" onsubmit="return addTransaction(event)" class="space-y-3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</label>
                            <select id="fundSelect" class="select-field">
                                <option selected>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</option>
                                <option>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</option>
                                <option>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</label>
                            <select id="typeSelect" class="select-field" onchange="toggleAmountField()">
                                <option value="sales">ğŸ’° Ù…Ø¨ÙŠØ¹Ø§Øª Ù†Ù‚Ø¯ÙŠØ©</option>
                                <option value="income">ğŸ’µ Ø§Ù„ÙˆØ§ØµÙ„ / Ø³Ù†Ø¯Ø§Øª Ù‚Ø¨Ø¶</option>
                                <option value="expense">ğŸ“¤ Ø³Ù†Ø¯Ø§Øª ØµØ±Ù Ù…ÙˆØ±Ø¯ÙŠÙ†</option>
                                <option value="petty">ğŸ›’ Ù†Ø«Ø±ÙŠØ§Øª ØµÙŠØ¯Ù„ÙŠØ©</option>
                                <option value="purchase">ğŸ“¦ Ù…Ø´ØªØ±ÙŠØ§Øª Ù†Ù‚Ø¯ÙŠØ©</option>
                                <option value="adv_cash">ğŸ‘¥ Ø³Ù„Ù Ù†Ù‚Ø¯ÙŠØ©</option>
                                <option value="salary_deduction">ğŸ‘¤ Ø®ØµÙ… Ù…ÙˆØ¸ÙÙŠÙ†</option>
                                <option value="shortage">âš ï¸ Ù†ÙˆØ§Ù‚Øµ Ø£Ø¯ÙˆÙŠØ©</option>
                                <option value="alert">ğŸ”” ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</option>
                                <option value="note">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙŠÙˆÙ…ÙŠØ©</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex flex-col md:flex-row gap-3">
                        <div id="amountField" class="w-full md:w-1/3">
                            <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                            <input id="amountInput" type="number" step="0.01" class="input-field font-semibold" placeholder="0.00">
                        </div>
                        
                        <div class="flex-1">
                            <label id="descLabel" class="text-gray-600 mb-1 block font-medium">Ø§Ù„Ø¨ÙŠØ§Ù† / Ø§Ù„ØªÙØ§ØµÙŠÙ„</label>
                            <input id="descInput" type="text" class="input-field" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†..." autocomplete="off">
                        </div>
                    </div>
                    
                    <div id="reportAuthorField" class="hidden">
                        <label class="text-gray-600 mb-1 block font-medium">ÙƒØ§ØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                        <input id="reportAuthor" type="text" class="input-field" placeholder="Ø§Ø³Ù… ÙƒØ§ØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ±">
                    </div>
                    
                    <button type="submit" id="submitBtn" class="w-full p-3 bg-primary text-white rounded font-medium btn text-medium">
                        <i class="fas fa-plus mr-2"></i>Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                    </button>
                </form>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
            <div class="card">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="section-title">Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h2>
                    <div class="flex items-center gap-2">
                        <span class="text-gray-600 text-small" id="txCount">0 Ø¹Ù…Ù„ÙŠØ©</span>
                        <button onclick="clearAllTransactions()" class="px-2 py-1 bg-red-100 text-red-600 rounded text-small font-medium hover:bg-red-200">
                            <i class="fas fa-trash mr-1"></i>Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                        </button>
                    </div>
                </div>
                
                <div class="border-b my-3"></div>
                
                <div id="txList" class="space-y-2 list-container"></div>
                
                <div id="emptyState" class="text-center py-6 hidden">
                    <div class="text-4xl mb-3">ğŸ“‹</div>
                    <h3 class="text-gray-600 text-medium mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                    <p class="text-gray-500 text-small">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡</p>
                </div>
            </div>
        </main>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¢Ø¬Ù„Ø© -->
        <main id="deferredTab" class="tab-content container mx-auto px-3 py-3">
            <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ø¢Ø¬Ù„Ø© -->
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchDeferredTab('sales')" id="salesTabBtn">
                    Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©
                </button>
                <button class="tab-btn" onclick="switchDeferredTab('purchases')" id="purchasesTabBtn">
                    Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©
                </button>
                <button class="tab-btn" onclick="switchDeferredTab('return_sales')" id="returnSalesTabBtn">
                    Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©
                </button>
                <button class="tab-btn" onclick="switchDeferredTab('return_purchases')" id="returnPurchasesTabBtn">
                    Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©
                </button>
            </div>

            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¢Ø¬Ù„Ø© -->
            <div class="card">
                <h3 class="section-title" id="deferredTitle">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</h3>
                <div class="space-y-3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„Ø§Ø³Ù…</label>
                            <input id="defName" type="text" class="input-field" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…ÙˆØ¸Ù">
                        </div>
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                            <input id="defAmount" type="number" step="0.01" class="input-field font-semibold" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div>
                        <label class="text-gray-600 mb-1 block font-medium">Ø§Ù„ÙˆØµÙ</label>
                        <input id="defDesc" type="text" class="input-field" placeholder="ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 hidden" id="returnFields">
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹</label>
                            <input id="defReference" type="text" class="input-field" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ©">
                        </div>
                        <div>
                            <label class="text-gray-600 mb-1 block font-medium">Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯ %</label>
                            <input id="defPercentage" type="number" min="1" max="100" class="input-field" placeholder="100" value="100">
                        </div>
                    </div>
                    
                    <button onclick="addDeferred()" class="w-full p-3 bg-orange-500 text-white rounded font-medium btn text-medium">
                        <i class="fas fa-plus mr-2"></i>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¢Ø¬Ù„Ø©
                    </button>
                </div>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© -->
            <div class="card">
                <h3 class="section-title" id="deferredListTitle">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h3>
                <div id="deferredList" class="space-y-2 list-container"></div>
                
                <div id="emptyDeferred" class="text-center py-6 hidden">
                    <div class="text-4xl mb-3">ğŸ“…</div>
                    <h3 class="text-gray-600 text-medium mb-2" id="emptyDeferredTitle">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</h3>
                    <p class="text-gray-500 text-small">Ø£Ø¶Ù Ø¹Ù…Ù„ÙŠØ§Øª Ø¢Ø¬Ù„Ø© Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡</p>
                </div>
            </div>
        </main>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
        <main id="reportsTab" class="tab-content container mx-auto px-3 py-3">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                <button onclick="showModal('quickReportModal')" class="card hover:shadow transition-all duration-200 text-right cursor-pointer border border-transparent hover:border-primary">
                    <div class="text-primary font-medium text-medium mb-2">ğŸš€ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</div>
                    <div class="text-gray-600 text-small mb-2">8 Ø£Ù†ÙˆØ§Ø¹ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø¹ Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</div>
                    <div class="mt-2 text-primary">
                        <i class="fas fa-rocket text-xl"></i>
                    </div>
                </button>
                
                <button onclick="showModal('reportDateModal')" class="card hover:shadow transition-all duration-200 text-right cursor-pointer border border-transparent hover:border-primary">
                    <div class="text-primary font-medium text-medium mb-2">ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
                    <div class="text-gray-600 text-small mb-2">Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</div>
                    <div class="mt-2 text-primary">
                        <i class="fas fa-calendar-day text-xl"></i>
                    </div>
                </button>
                
                <button onclick="generateReport('daily_summary')" class="card hover:shadow transition-all duration-200 text-right cursor-pointer border border-transparent hover:border-primary">
                    <div class="text-primary font-medium text-medium mb-2">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„</div>
                    <div class="text-gray-600 text-small mb-2">Ù…Ù„Ù PDF Ø´Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØµÙˆØ±</div>
                    <div class="mt-2 text-primary">
                        <i class="fas fa-file-alt text-xl"></i>
                    </div>
                </button>
            </div>
            
            <div id="reportsContainer" class="card hidden">
                <div class="flex justify-between items-center mb-3">
                    <div>
                        <h3 id="reportTitle" class="font-medium text-large text-primary"></h3>
                        <p id="reportDateInfo" class="text-small text-gray-600 mt-1"></p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="printCurrentReport()" class="px-3 py-2 bg-gray-800 text-white text-small rounded font-medium hover:bg-gray-900">
                            <i class="fas fa-print mr-1"></i>Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¹ Ø§Ù„ØµÙˆØ±
                        </button>
                        <button onclick="generatePDF()" class="px-3 py-2 bg-green-600 text-white text-small rounded font-medium hover:bg-green-700">
                            <i class="fas fa-file-pdf mr-1"></i>ØªØ­Ù…ÙŠÙ„ PDF
                        </button>
                        <button onclick="generatePDFWithoutImages()" class="px-3 py-2 bg-gray-400 text-white text-small rounded font-medium hover:bg-gray-500">
                            <i class="fas fa-file-alt mr-1"></i>PDF Ø¨Ø¯ÙˆÙ† ØµÙˆØ±
                        </button>
                    </div>
                </div>
                <div class="border-b my-3"></div>
                <div id="reportContent"></div>
                
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© -->
                <div id="deferredTotals" class="mt-6 hidden">
                    <h4 class="font-medium text-medium mb-3 text-gray-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <div class="bg-green-50 p-3 rounded border border-green-200">
                            <div class="text-small text-green-700">Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</div>
                            <div class="font-bold text-large text-green-800" id="totalDefSales">0.00</div>
                        </div>
                        <div class="bg-red-50 p-3 rounded border border-red-200">
                            <div class="text-small text-red-700">Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©</div>
                            <div class="font-bold text-large text-red-800" id="totalDefPurchases">0.00</div>
                        </div>
                        <div class="bg-emerald-50 p-3 rounded border border-emerald-200">
                            <div class="text-small text-emerald-700">Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                            <div class="font-bold text-large text-emerald-800" id="totalDefReturnSales">0.00</div>
                        </div>
                        <div class="bg-rose-50 p-3 rounded border border-rose-200">
                            <div class="text-small text-rose-700">Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª</div>
                            <div class="font-bold text-large text-rose-800" id="totalDefReturnPurchases">0.00</div>
                        </div>
                    </div>
                </div>
                
                <!-- Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
                <div id="reportImages" class="mt-6 hidden">
                    <h4 class="font-medium text-medium mb-3 text-gray-700">Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h4>
                    <div id="reportImagesContainer" class="image-preview-container"></div>
                </div>
            </div>
        </main>

        <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
        <div class="bg-white border-t p-3 shadow-md">
            <div class="container mx-auto">
                <div class="flex flex-col md:flex-row gap-3 mb-3">
                    <div class="flex-1">
                        <label class="text-gray-600 mb-1 block text-small font-medium">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="currentDate" class="input-field">
                    </div>
                    <div class="flex-1">
                        <label class="text-gray-600 mb-1 block text-small font-medium">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©</label>
                        <input type="text" id="generalNotes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©..." class="input-field">
                    </div>
                </div>
                
                <div class="bg-teal-50 p-3 rounded-lg mb-3 border border-teal-100">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                        <div>
                            <span class="text-gray-600 text-small font-medium">ØµØ§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…:</span>
                            <span id="dailyBalance" class="font-medium text-large text-primary mr-2">0.00</span>
                        </div>
                        <div class="w-full md:w-auto">
                            <label class="text-gray-600 mb-1 block text-small font-medium">Ø§Ø³Ù… Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                            <input type="text" id="preparerName" placeholder="Ø§Ø³Ù… Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±" class="input-field">
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                    <button onclick="printDailyReport()" class="p-3 bg-gray-800 text-white rounded font-medium btn text-medium">
                        <i class="fas fa-print mr-2"></i>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„
                    </button>
                    <button onclick="saveAndClose()" class="p-3 bg-red-600 text-white rounded font-medium btn text-medium">
                        <i class="fas fa-lock mr-2"></i>Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
    <div class="print-only p-4">
        <div class="text-center border-b pb-3 mb-4">
            <h1 class="text-xl font-semibold mb-2">ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h1>
            <h2 class="text-large text-gray-700 mb-3">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„</h2>
            <div class="flex justify-between mt-3 text-small">
                <span id="printDate"></span>
                <span id="printPreparer"></span>
            </div>
            <div id="printReportDate" class="text-small text-gray-600 mt-2"></div>
        </div>
        <div id="printContent"></div>
        
        <!-- Ù…Ù†Ø·Ù‚Ø© ØµÙˆØ± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
        <div id="printImages" class="print-images mt-6 hidden">
            <h3 class="font-semibold text-medium mb-3 border-b pb-2">Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h3>
            <div id="printImagesContainer" class="grid grid-cols-2 gap-3"></div>
        </div>
        
        <div class="mt-6 p-3 border rounded-lg print-section">
            <strong class="block mb-2 text-medium">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong>
            <p id="printNotes" class="text-small"></p>
        </div>
    </div>

    <!-- Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© Ù…Ø¨Ø³Ø·Ø© -->
    <div id="calculatorModal" class="modal">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-sm m-4">
            <div class="bg-gray-800 p-4 flex justify-between items-center text-white rounded-t-lg">
                <h3 class="font-semibold text-medium">Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©</h3>
                <button onclick="hideModal('calculatorModal')" class="hover:bg-gray-700 p-2 rounded transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4 bg-gray-100 text-right text-xl font-mono font-semibold border-b" dir="ltr" id="calcDisplay">0</div>
            <div class="grid grid-cols-4 gap-2 p-4">
                <button onclick="calcInput('7')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn">7</button>
                <button onclick="calcInput('8')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn">8</button>
                <button onclick="calcInput('9')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn">9</button>
                <button onclick="calcInput('/')" class="p-3 bg-orange-100 rounded font-medium hover:bg-orange-200 btn">Ã·</button>
                <button onclick="calcInput('4')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn">4</button>
                <button onclick="calcInput('5')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn">5</button>
                <button onclick="calcInput('6')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn">6</button>
                <button onclick="calcInput('*')" class="p-3 bg-orange-100 rounded font-medium hover:bg-orange-200 btn">Ã—</button>
                <button onclick="calcInput('1')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn">1</button>
                <button onclick="calcInput('2')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn">2</button>
                <button onclick="calcInput('3')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn">3</button>
                <button onclick="calcInput('-')" class="p-3 bg-orange-100 rounded font-medium hover:bg-orange-200 btn">-</button>
                <button onclick="calcClear()" class="p-3 bg-red-100 rounded font-medium hover:bg-red-200 btn">C</button>
                <button onclick="calcInput('0')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn">0</button>
                <button onclick="calcInput('.')" class="p-3 bg-gray-50 rounded font-medium hover:bg-gray-100 btn">.</button>
                <button onclick="calcInput('+')" class="p-3 bg-orange-100 rounded font-medium hover:bg-orange-200 btn">+</button>
                <button onclick="calcCalculate()" class="p-3 col-span-4 bg-primary text-white rounded font-medium btn">=</button>
            </div>
        </div>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
    <div id="printAdvancedArea" class="print-only p-4" style="display: none;">
        <div id="advancedPrintContent"></div>
    </div>

    <script>
        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        // ============================================
        
        // ØªØ¹Ø±ÙŠÙ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
        const TX_TYPES = {
            'sales': { label: 'Ù…Ø¨ÙŠØ¹Ø§Øª Ù†Ù‚Ø¯ÙŠØ©', type: 'in', color: 'text-green-600', bg: 'sale-bg', icon: 'ğŸ’°' },
            'income': { label: 'Ø§Ù„ÙˆØ§ØµÙ„ / Ø³Ù†Ø¯Ø§Øª Ù‚Ø¨Ø¶', type: 'in', color: 'text-green-600', bg: 'sale-bg', icon: 'ğŸ’µ' },
            'expense': { label: 'Ø³Ù†Ø¯Ø§Øª ØµØ±Ù Ù…ÙˆØ±Ø¯ÙŠÙ†', type: 'out', color: 'text-red-600', bg: 'purchase-bg', icon: 'ğŸ“¤' },
            'petty': { label: 'Ù†Ø«Ø±ÙŠØ§Øª ØµÙŠØ¯Ù„ÙŠØ©', type: 'out', color: 'text-red-600', bg: 'purchase-bg', icon: 'ğŸ›’' },
            'purchase': { label: 'Ù…Ø´ØªØ±ÙŠØ§Øª Ù†Ù‚Ø¯ÙŠØ©', type: 'out', color: 'text-red-600', bg: 'purchase-bg', icon: 'ğŸ“¦' },
            'adv_cash': { label: 'Ø³Ù„Ù Ù†Ù‚Ø¯ÙŠØ©', type: 'out', color: 'text-orange-600', bg: 'advance-bg', icon: 'ğŸ‘¥' },
            'salary_deduction': { label: 'Ø®ØµÙ… Ù…ÙˆØ¸ÙÙŠÙ†', type: 'out', color: 'text-orange-600', bg: 'advance-bg', icon: 'ğŸ‘¤' },
            'shortage': { label: 'Ù†ÙˆØ§Ù‚Øµ Ø£Ø¯ÙˆÙŠØ©', type: 'none', color: 'text-red-700', bg: 'shortage-bg', icon: 'âš ï¸' },
            'alert': { label: 'ØªÙ†Ø¨ÙŠÙ‡Ø§Øª', type: 'none', color: 'text-yellow-700', bg: 'bg-yellow-50', icon: 'ğŸ””' },
            'note': { label: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙŠÙˆÙ…ÙŠØ©', type: 'none', color: 'text-blue-600', bg: 'bg-blue-50', icon: 'ğŸ“' }
        };
        
        // ØªØ¹Ø±ÙŠÙ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
        const DEFERRED_TYPES = {
            'def_sale': { 
                label: 'Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©', 
                type: 'sale', 
                color: 'sale-text', 
                bg: 'sale-bg', 
                icon: 'ğŸ’°',
                tab: 'sales'
            },
            'def_purchase': { 
                label: 'Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©', 
                type: 'purchase', 
                color: 'purchase-text', 
                bg: 'purchase-bg', 
                icon: 'ğŸ“¦',
                tab: 'purchases'
            },
            'def_return_sale': { 
                label: 'Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©', 
                type: 'return_sale', 
                color: 'return-sale-text', 
                bg: 'return-sale-bg', 
                icon: 'ğŸ”„',
                tab: 'return_sales'
            },
            'def_return_purchase': { 
                label: 'Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©', 
                type: 'return_purchase', 
                color: 'return-purchase-text', 
                bg: 'return-purchase-bg', 
                icon: 'â†©ï¸',
                tab: 'return_purchases'
            }
        };

        // ØªØ¹Ø±ÙŠÙ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©
        const REPORT_TYPES = [
            {
                id: 'daily_cash',
                name: 'ğŸ’° ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠ',
                icon: 'ğŸ’°',
                color: 'bg-green-100 border-green-300',
                textColor: 'text-green-800',
                description: 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ù…Ø¹ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª'
            },
            {
                id: 'deferred_full',
                name: 'ğŸ“… ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¢Ø¬Ù„Ø© Ø§Ù„Ø´Ø§Ù…Ù„',
                icon: 'ğŸ“…',
                color: 'bg-orange-100 border-orange-300',
                textColor: 'text-orange-800',
                description: 'ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© Ù…Ø¹ Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯Ø§Øª'
            },
            {
                id: 'combined',
                name: 'ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ­Ø¯',
                icon: 'ğŸ“Š',
                color: 'bg-blue-100 border-blue-300',
                textColor: 'text-blue-800',
                description: 'Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© ÙˆØ§Ù„Ø¢Ø¬Ù„Ø© ÙÙŠ ØªÙ‚Ø±ÙŠØ± ÙˆØ§Ø­Ø¯'
            },
            {
                id: 'funds_summary',
                name: 'ğŸ’¼ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚',
                icon: 'ğŸ’¼',
                color: 'bg-purple-100 border-purple-300',
                textColor: 'text-purple-800',
                description: 'Ø­Ø±ÙƒØ© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø«Ù„Ø§Ø«Ø©'
            },
            {
                id: 'shortages',
                name: 'âš ï¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†ÙˆØ§Ù‚Øµ',
                icon: 'âš ï¸',
                color: 'bg-red-100 border-red-300',
                textColor: 'text-red-800',
                description: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù†Ø§Ù‚ØµØ©'
            },
            {
                id: 'alerts_notes',
                name: 'ğŸ“ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª',
                icon: 'ğŸ“',
                color: 'bg-yellow-100 border-yellow-300',
                textColor: 'text-yellow-800',
                description: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©'
            },
            {
                id: 'cash_flow',
                name: 'ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠ',
                icon: 'ğŸ“ˆ',
                color: 'bg-teal-100 border-teal-300',
                textColor: 'text-teal-800',
                description: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ù„Ù„ØµÙ†Ø¯ÙˆÙ‚'
            },
            {
                id: 'deferred_summary',
                name: 'ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ø¢Ø¬Ù„Ø©',
                icon: 'ğŸ“‹',
                color: 'bg-indigo-100 border-indigo-300',
                textColor: 'text-indigo-800',
                description: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© ÙÙ‚Ø·'
            }
        ];
        
        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ø¢Ø¬Ù„Ø©
        let currentDeferredTab = 'sales';
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
        let currentReport = {
            type: null,
            date: null,
            data: null
        };

        // Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
        let selectedReportId = null;
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        let systemData = {
            transactions: JSON.parse(localStorage.getItem('sadara_tx') || '[]'),
            deferred: JSON.parse(localStorage.getItem('sadara_def') || '[]'),
            archives: JSON.parse(localStorage.getItem('sadara_arch') || '[]'),
            settings: JSON.parse(localStorage.getItem('sadara_settings') || '{}'),
            images: JSON.parse(localStorage.getItem('sadara_images') || '[]')
        };
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ±
        // ============================================
        
        function initializeImageUpload() {
            const uploadArea = document.getElementById('imageUploadArea');
            
            // ØªÙØ¹ÙŠÙ„ Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                handleImageUpload({ target: { files } });
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            loadSavedImages();
        }
        
        function handleImageUpload(event) {
            const files = event.target.files;
            const previewsContainer = document.getElementById('imagePreviews');
            previewsContainer.innerHTML = '';
            
            Array.from(files).forEach(file => {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (5MB ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)
                if (file.size > 5 * 1024 * 1024) {
                    alert(`Ø§Ù„Ù…Ù„Ù ${file.name} ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ (5MB)`);
                    return;
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
                if (!file.type.startsWith('image/')) {
                    alert(`Ø§Ù„Ù…Ù„Ù ${file.name} Ù„ÙŠØ³ ØµÙˆØ±Ø©`);
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù„ØµÙˆØ±Ø©
                    const imageItem = document.createElement('div');
                    imageItem.className = 'image-item';
                    
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'image-preview';
                    img.alt = file.name;
                    
                    const removeBtn = document.createElement('div');
                    removeBtn.className = 'image-remove';
                    removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                    removeBtn.onclick = function() {
                        imageItem.remove();
                    };
                    
                    imageItem.appendChild(img);
                    imageItem.appendChild(removeBtn);
                    previewsContainer.appendChild(imageItem);
                    
                    // Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ localStorage
                    saveImageToStorage(e.target.result, file.name);
                };
                
                reader.readAsDataURL(file);
            });
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            event.target.value = '';
        }
        
        function saveImageToStorage(imageData, fileName) {
            const image = {
                id: Date.now(),
                data: imageData,
                name: fileName,
                date: new Date().toLocaleDateString('ar-EG'),
                time: new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })
            };
            
            systemData.images.push(image);
            saveData();
            loadSavedImages();
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
            showMessage(`ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© "${fileName}" Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        }
        
        function loadSavedImages() {
            const container = document.getElementById('savedImages');
            const noImagesMsg = document.getElementById('noImagesMessage');
            
            container.innerHTML = '';
            
            if (systemData.images.length === 0) {
                noImagesMsg.classList.remove('hidden');
                return;
            }
            
            noImagesMsg.classList.add('hidden');
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            systemData.images.forEach(image => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                
                const img = document.createElement('img');
                img.src = image.data;
                img.className = 'image-preview';
                img.alt = image.name;
                img.title = `${image.name}\n${image.date} ${image.time}`;
                
                const removeBtn = document.createElement('div');
                removeBtn.className = 'image-remove';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.onclick = function() {
                    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©ØŸ')) {
                        deleteImage(image.id);
                    }
                };
                
                imageItem.appendChild(img);
                imageItem.appendChild(removeBtn);
                container.appendChild(imageItem);
            });
        }
        
        function deleteImage(imageId) {
            systemData.images = systemData.images.filter(img => img.id !== imageId);
            saveData();
            loadSavedImages();
            showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
        function loadReportImages() {
            const container = document.getElementById('reportImagesContainer');
            const reportImagesSection = document.getElementById('reportImages');
            
            container.innerHTML = '';
            
            if (systemData.images.length === 0) {
                reportImagesSection.classList.add('hidden');
                return;
            }
            
            reportImagesSection.classList.remove('hidden');
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            systemData.images.forEach(image => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                
                const img = document.createElement('img');
                img.src = image.data;
                img.className = 'image-preview';
                img.alt = image.name;
                img.title = `${image.name}\n${image.date} ${image.time}`;
                
                imageItem.appendChild(img);
                container.appendChild(imageItem);
            });
        }
        
        function loadPrintImages() {
            const container = document.getElementById('printImagesContainer');
            const printImagesSection = document.getElementById('printImages');
            
            container.innerHTML = '';
            
            if (systemData.images.length === 0) {
                printImagesSection.classList.add('hidden');
                return;
            }
            
            printImagesSection.classList.remove('hidden');
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
            systemData.images.forEach((image, index) => {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'text-center';
                
                const img = document.createElement('img');
                img.src = image.data;
                img.className = 'print-image';
                img.alt = image.name;
                img.style.maxWidth = '100%';
                img.style.height = 'auto';
                
                const caption = document.createElement('div');
                caption.className = 'text-small text-gray-600 mt-1';
                caption.textContent = `ØµÙˆØ±Ø© ${index + 1}: ${image.name}`;
                
                imageDiv.appendChild(img);
                imageDiv.appendChild(caption);
                container.appendChild(imageDiv);
            });
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        // ============================================
        
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            
            if (modalId === 'uploadModal') {
                loadSavedImages();
            } else if (modalId === 'reportDateModal') {
                loadSavedReportDates();
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('reportDateSelect').value = today;
            } else if (modalId === 'quickReportModal') {
                initQuickReports();
            }
        }
        
        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function showLoader(text = 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF...') {
            document.getElementById('loaderText').textContent = text;
            document.getElementById('loader').classList.add('active');
        }
        
        function hideLoader() {
            document.getElementById('loader').classList.remove('active');
        }
        
        function showCalculator() {
            showModal('calculatorModal');
        }
        
        function switchTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø·
            document.getElementById(tabName + 'TabBtn').classList.add('active');
            
            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            if (tabName === 'daily') {
                loadDailyTransactions();
            } else if (tabName === 'deferred') {
                loadDeferredTransactions();
            }
        }
        
        function switchDeferredTab(tabName) {
            currentDeferredTab = tabName;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('#deferredTab .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName + 'TabBtn').classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
            const titles = {
                'sales': 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©',
                'purchases': 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©',
                'return_sales': 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©',
                'return_purchases': 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©'
            };
            
            const listTitles = {
                'sales': 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©',
                'purchases': 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©',
                'return_sales': 'Ù‚Ø§Ø¦Ù…Ø© Ù…Ø±Ø¯ÙˆØ¯Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©',
                'return_purchases': 'Ù‚Ø§Ø¦Ù…Ø© Ù…Ø±Ø¯ÙˆØ¯Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©'
            };
            
            const emptyTitles = {
                'sales': 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©',
                'purchases': 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©',
                'return_sales': 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø¯ÙˆØ¯Ø§Øª Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©',
                'return_purchases': 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø¯ÙˆØ¯Ø§Øª Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©'
            };
            
            document.getElementById('deferredTitle').textContent = titles[tabName];
            document.getElementById('deferredListTitle').textContent = listTitles[tabName];
            document.getElementById('emptyDeferredTitle').textContent = emptyTitles[tabName];
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯
            const returnFields = document.getElementById('returnFields');
            if (tabName === 'return_sales' || tabName === 'return_purchases') {
                returnFields.classList.remove('hidden');
            } else {
                returnFields.classList.add('hidden');
            }
            
            loadDeferredTransactions();
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
        // ============================================
        
        function toggleAmountField() {
            const type = document.getElementById('typeSelect').value;
            const amountField = document.getElementById('amountField');
            const descLabel = document.getElementById('descLabel');
            const authorField = document.getElementById('reportAuthorField');
            const submitBtn = document.getElementById('submitBtn');
            
            const noAmountTypes = ['shortage', 'alert', 'note'];
            
            if (noAmountTypes.includes(type)) {
                amountField.style.display = 'none';
                document.getElementById('amountInput').value = '';
                
                if (type === 'shortage') {
                    descLabel.textContent = 'Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ø§Ù„Ù†Ø§Ù‚Øµ (Ø§Ù„Ø¯ÙˆØ§Ø¡)';
                } else if (type === 'alert') {
                    descLabel.textContent = 'Ù†Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡';
                } else if (type === 'note') {
                    descLabel.textContent = 'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©';
                    authorField.style.display = 'block';
                }
                
                if (type === 'shortage') {
                    submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ù†ÙˆØ§Ù‚Øµ';
                    submitBtn.className = 'w-full p-3 bg-red-600 text-white rounded font-medium btn text-medium';
                } else if (type === 'alert') {
                    submitBtn.innerHTML = '<i class="fas fa-bell mr-2"></i>Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡';
                    submitBtn.className = 'w-full p-3 bg-yellow-600 text-white rounded font-medium btn text-medium';
                } else if (type === 'note') {
                    submitBtn.innerHTML = '<i class="fas fa-sticky-note mr-2"></i>Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©';
                    submitBtn.className = 'w-full p-3 bg-blue-600 text-white rounded font-medium btn text-medium';
                }
            } else {
                amountField.style.display = 'block';
                descLabel.textContent = 'Ø§Ù„Ø¨ÙŠØ§Ù† / Ø§Ù„ØªÙØ§ØµÙŠÙ„';
                authorField.style.display = 'none';
                submitBtn.innerHTML = '<i class="fas fa-plus mr-2"></i>Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©';
                submitBtn.className = 'w-full p-3 bg-primary text-white rounded font-medium btn text-medium';
            }
        }
        
        function addTransaction(e) {
            e.preventDefault();
            
            const type = document.getElementById('typeSelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value) || 0;
            const description = document.getElementById('descInput').value;
            const fund = document.getElementById('fundSelect').value;
            const author = document.getElementById('reportAuthor')?.value || '';
            const noAmountTypes = ['shortage', 'alert', 'note'];
            
            if (!description) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†');
                return false;
            }
            
            if (!noAmountTypes.includes(type) && amount <= 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­');
                return false;
            }
            
            const currentDate = document.getElementById('currentDate').value || new Date().toISOString().split('T')[0];
            
            const newTransaction = {
                id: Date.now(),
                type: type,
                amount: amount,
                description: description,
                fund: fund,
                author: author,
                date: currentDate,
                time: new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })
            };
            
            systemData.transactions.push(newTransaction);
            saveData();
            loadDailyTransactions();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('descInput').value = '';
            if (!noAmountTypes.includes(type)) {
                document.getElementById('amountInput').value = '';
            }
            if (type === 'note') {
                document.getElementById('reportAuthor').value = '';
            }
            document.getElementById('descInput').focus();
            
            return false;
        }
        
        function loadDailyTransactions() {
            const list = document.getElementById('txList');
            const empty = document.getElementById('emptyState');
            let total = 0;
            
            if (systemData.transactions.length === 0) {
                list.innerHTML = '';
                empty.classList.remove('hidden');
                document.getElementById('txCount').textContent = '0 Ø¹Ù…Ù„ÙŠØ©';
                updateBalance(total);
                return;
            }
            
            empty.classList.add('hidden');
            
            let html = '';
            const recentTxs = systemData.transactions.slice(-50).reverse();
            
            recentTxs.forEach(tx => {
                const typeInfo = TX_TYPES[tx.type];
                
                if (typeInfo.type === 'in') {
                    total += tx.amount;
                } else if (typeInfo.type === 'out') {
                    total -= tx.amount;
                }
                
                html += `
                    <div class="transaction-item ${typeInfo.bg}">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-large">${typeInfo.icon}</span>
                                <span class="text-medium font-medium ${typeInfo.color}">${typeInfo.label}</span>
                                <span class="text-small text-gray-500">${tx.time}</span>
                            </div>
                            <p class="text-gray-800 text-medium mb-1">${tx.description}</p>
                            <p class="text-small text-gray-600">${tx.fund} ${tx.author ? `| ${tx.author}` : ''} | ${tx.date}</p>
                        </div>
                        <div class="transaction-amount text-right">
                            ${tx.amount > 0 ? `<span class="font-medium text-large ${typeInfo.color}">${tx.amount.toFixed(2)}</span>` : ''}
                            <button onclick="deleteTransaction(${tx.id})" class="block mt-2 text-gray-400 hover:text-red-500 text-small">
                                <i class="fas fa-trash mr-1"></i>Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                `;
            });
            
            list.innerHTML = html;
            document.getElementById('txCount').textContent = `${systemData.transactions.length} Ø¹Ù…Ù„ÙŠØ©`;
            updateBalance(total);
        }
        
        function deleteTransaction(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ')) return;
            
            systemData.transactions = systemData.transactions.filter(tx => tx.id !== id);
            saveData();
            loadDailyTransactions();
        }
        
        function clearAllTransactions() {
            if (systemData.transactions.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ù„Ø­Ø°ÙÙ‡Ø§');
                return;
            }
            
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) return;
            
            systemData.transactions = [];
            saveData();
            loadDailyTransactions();
        }
        
        function updateBalance(total) {
            document.getElementById('dailyBalance').textContent = total.toFixed(2);
            const totalEl = document.getElementById('dailyBalance');
            
            if (total > 0) {
                totalEl.className = 'font-medium text-large text-green-600 mr-2';
            } else if (total < 0) {
                totalEl.className = 'font-medium text-large text-red-600 mr-2';
            } else {
                totalEl.className = 'font-medium text-large text-gray-600 mr-2';
            }
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¢Ø¬Ù„Ø©
        // ============================================
        
        function addDeferred() {
            let type, label, deferredType;
            
            if (currentDeferredTab === 'sales') {
                type = 'def_sale';
                label = 'Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©';
                deferredType = 'sale';
            } else if (currentDeferredTab === 'purchases') {
                type = 'def_purchase';
                label = 'Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©';
                deferredType = 'purchase';
            } else if (currentDeferredTab === 'return_sales') {
                type = 'def_return_sale';
                label = 'Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©';
                deferredType = 'return_sale';
            } else if (currentDeferredTab === 'return_purchases') {
                type = 'def_return_purchase';
                label = 'Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©';
                deferredType = 'return_purchase';
            }
            
            const name = document.getElementById('defName').value;
            let amount = parseFloat(document.getElementById('defAmount').value);
            const desc = document.getElementById('defDesc').value;
            const reference = document.getElementById('defReference').value;
            const percentage = parseFloat(document.getElementById('defPercentage').value) || 100;
            
            if (currentDeferredTab === 'return_sales' || currentDeferredTab === 'return_purchases') {
                amount = amount * (percentage / 100);
            }
            
            if (!name || !amount) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø¨Ù„Øº');
                return;
            }
            
            const currentDate = document.getElementById('currentDate').value || new Date().toLocaleDateString('ar-EG');
            
            const newDeferred = {
                id: Date.now(),
                type: type,
                label: label,
                name: name,
                amount: amount,
                description: desc,
                reference: reference,
                percentage: percentage,
                deferredType: deferredType,
                tab: currentDeferredTab,
                date: currentDate
            };
            
            systemData.deferred.push(newDeferred);
            saveData();
            loadDeferredTransactions();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('defName').value = '';
            document.getElementById('defAmount').value = '';
            document.getElementById('defDesc').value = '';
            document.getElementById('defReference').value = '';
            document.getElementById('defPercentage').value = '100';
        }
        
        function loadDeferredTransactions() {
            const list = document.getElementById('deferredList');
            const empty = document.getElementById('emptyDeferred');
            
            const filtered = systemData.deferred.filter(item => item.tab === currentDeferredTab);
            
            if (filtered.length === 0) {
                list.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }
            
            empty.classList.add('hidden');
            
            let html = '';
            filtered.forEach(item => {
                const typeInfo = DEFERRED_TYPES[item.type] || { 
                    color: 'text-gray-600', 
                    bg: 'bg-gray-50', 
                    icon: 'ğŸ“‹' 
                };
                
                html += `
                    <div class="transaction-item ${typeInfo.bg}">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-large">${typeInfo.icon}</span>
                                <h4 class="font-medium text-large text-gray-800">${item.name}</h4>
                            </div>
                            <p class="text-gray-700 text-medium mb-1">${item.description || '-'}</p>
                            <div class="flex gap-2 mt-2">
                                <span class="text-small px-2 py-1 bg-white rounded border font-medium ${typeInfo.color}">${item.label}</span>
                                ${item.reference ? `<span class="text-small px-2 py-1 bg-gray-100 rounded">Ù…Ø±Ø¬Ø¹: ${item.reference}</span>` : ''}
                                <span class="text-small text-gray-600">${item.date}</span>
                            </div>
                        </div>
                        <div class="transaction-amount text-right">
                            <span class="font-medium text-large text-gray-800">${item.amount.toFixed(2)}</span>
                            ${item.percentage && item.percentage !== 100 ? `<div class="text-small text-blue-600 mt-1">${item.percentage}%</div>` : ''}
                            <button onclick="deleteDeferred(${item.id})" class="block mt-2 text-gray-400 hover:text-red-500 text-small">
                                <i class="fas fa-check-circle mr-1"></i>ØªØ³ÙˆÙŠØ© ÙˆØ­Ø°Ù
                            </button>
                        </div>
                    </div>
                `;
            });
            
            list.innerHTML = html;
        }
        
        function deleteDeferred(id) {
            if (!confirm('Ù‡Ù„ ØªÙ… ØªØ³ÙˆÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ Ø³ÙŠØªÙ… Ø­Ø°ÙÙ‡.')) return;
            
            systemData.deferred = systemData.deferred.filter(item => item.id !== id);
            saveData();
            loadDeferredTransactions();
        }
        
        function calculateDeferredTotals(date = null) {
            const totals = {
                sales: 0,
                purchases: 0,
                return_sales: 0,
                return_purchases: 0
            };
            
            let filteredDeferred = systemData.deferred;
            
            if (date) {
                filteredDeferred = systemData.deferred.filter(item => item.date === date);
            }
            
            filteredDeferred.forEach(item => {
                if (item.type === 'def_sale') {
                    totals.sales += item.amount;
                } else if (item.type === 'def_purchase') {
                    totals.purchases += item.amount;
                } else if (item.type === 'def_return_sale') {
                    totals.return_sales += item.amount;
                } else if (item.type === 'def_return_purchase') {
                    totals.return_purchases += item.amount;
                }
            });
            
            return totals;
        }
        
        // ============================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªØ·ÙˆØ±
        // ============================================
        
        function initQuickReports() {
            const reportsGrid = document.getElementById('reportsGrid');
            reportsGrid.innerHTML = '';
            
            REPORT_TYPES.forEach(report => {
                const reportCard = document.createElement('div');
                reportCard.className = `report-card ${report.color} border rounded-lg p-3 cursor-pointer hover:shadow-md transition-all duration-200`;
                reportCard.setAttribute('data-id', report.id);
                reportCard.setAttribute('data-name', report.name);
                reportCard.onclick = () => selectReport(report.id);
                
                reportCard.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="text-xl">${report.icon}</div>
                        <div class="flex-1">
                            <h4 class="font-medium ${report.textColor} mb-1">${report.name}</h4>
                            <p class="text-small text-gray-600">${report.description}</p>
                        </div>
                    </div>
                    <div class="mt-2 text-right">
                        <i class="fas fa-chevron-left text-gray-400 text-small"></i>
                    </div>
                `;
                
                reportsGrid.appendChild(reportCard);
            });
            
            // ØªØ­Ø¯ÙŠØ¯ Ø£ÙˆÙ„ ØªÙ‚Ø±ÙŠØ± Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§
            if (!selectedReportId && REPORT_TYPES.length > 0) {
                selectReport(REPORT_TYPES[0].id);
            }
        }
        
        function selectReport(reportId) {
            selectedReportId = reportId;
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
            document.querySelectorAll('.report-card').forEach(card => {
                card.classList.remove('ring-2', 'ring-primary');
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            const selectedCard = document.querySelector(`[data-id="${reportId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('ring-2', 'ring-primary');
            }
        }
        
        function filterReports() {
            const searchTerm = document.getElementById('reportSearch').value.toLowerCase();
            const reportCards = document.querySelectorAll('.report-card');
            
            reportCards.forEach(card => {
                const name = card.getAttribute('data-name').toLowerCase();
                if (name.includes(searchTerm) || searchTerm === '') {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        function toggleAdvancedOptions() {
            const options = document.getElementById('advancedOptions');
            const timeRange = document.getElementById('timeRange');
            
            options.classList.toggle('hidden');
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØµØµ
            timeRange.addEventListener('change', function() {
                const customRange = document.getElementById('customDateRange');
                if (this.value === 'custom') {
                    customRange.classList.remove('hidden');
                } else {
                    customRange.classList.add('hidden');
                }
            });
        }
        
        async function generateQuickReport() {
            if (!selectedReportId) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
                return;
            }
            
            const format = document.getElementById('exportFormat').value;
            const timeRange = document.getElementById('timeRange').value;
            
            showLoader('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...');
            
            try {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ
                let dateRange = calculateDateRange(timeRange);
                
                // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ
                const reportData = await gatherReportData(selectedReportId, dateRange);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                const reportHtml = createReportHTML(selectedReportId, reportData, dateRange);
                
                // Ø§Ù„ØªØµØ¯ÙŠØ± Ø­Ø³Ø¨ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø®ØªØ§Ø±
                switch(format) {
                    case 'print':
                        await printAdvancedReport(reportHtml, reportData);
                        break;
                    case 'pdf':
                        await exportToPDF(reportHtml, reportData, true);
                        break;
                    case 'pdf_nopic':
                        await exportToPDF(reportHtml, reportData, false);
                        break;
                    case 'excel':
                        exportToExcel(reportData);
                        break;
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±', 'error');
            } finally {
                hideLoader();
                hideModal('quickReportModal');
            }
        }
        
        function calculateDateRange(rangeType) {
            const today = new Date();
            let startDate, endDate;
            
            switch(rangeType) {
                case 'today':
                    startDate = endDate = today.toISOString().split('T')[0];
                    break;
                case 'yesterday':
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    startDate = endDate = yesterday.toISOString().split('T')[0];
                    break;
                case 'week':
                    const firstDayOfWeek = new Date(today);
                    firstDayOfWeek.setDate(today.getDate() - today.getDay() + (today.getDay() === 0 ? -6 : 1));
                    startDate = firstDayOfWeek.toISOString().split('T')[0];
                    endDate = today.toISOString().split('T')[0];
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1)
                        .toISOString().split('T')[0];
                    endDate = today.toISOString().split('T')[0];
                    break;
                case 'custom':
                    startDate = document.getElementById('dateFrom').value;
                    endDate = document.getElementById('dateTo').value;
                    break;
                default:
                    startDate = endDate = today.toISOString().split('T')[0];
            }
            
            return { startDate, endDate };
        }
        
        async function gatherReportData(reportId, dateRange) {
            const { startDate, endDate } = dateRange;
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
            const filteredTransactions = systemData.transactions.filter(tx => {
                const txDate = tx.date;
                return txDate >= startDate && txDate <= endDate;
            });
            
            const filteredDeferred = systemData.deferred.filter(def => {
                const defDate = def.date;
                return defDate >= startDate && defDate <= endDate;
            });
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            let data = {
                transactions: filteredTransactions,
                deferred: filteredDeferred,
                images: systemData.images.filter(img => {
                    const imgDate = new Date(img.date).toISOString().split('T')[0];
                    return imgDate >= startDate && imgDate <= endDate;
                }),
                totals: {},
                summaries: {}
            };
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
            data.totals = calculateTotals(filteredTransactions, filteredDeferred);
            data.summaries = generateSummaries(filteredTransactions, filteredDeferred);
            
            return data;
        }
        
        function calculateTotals(transactions, deferred) {
            const totals = {
                cashIn: 0,
                cashOut: 0,
                netCash: 0,
                deferredSales: 0,
                deferredPurchases: 0,
                returnSales: 0,
                returnPurchases: 0,
                shortages: 0,
                alerts: 0,
                notes: 0
            };
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
            transactions.forEach(tx => {
                const typeInfo = TX_TYPES[tx.type];
                if (typeInfo?.type === 'in') {
                    totals.cashIn += tx.amount;
                } else if (typeInfo?.type === 'out') {
                    totals.cashOut += tx.amount;
                } else if (tx.type === 'shortage') {
                    totals.shortages++;
                } else if (tx.type === 'alert') {
                    totals.alerts++;
                } else if (tx.type === 'note') {
                    totals.notes++;
                }
            });
            
            totals.netCash = totals.cashIn - totals.cashOut;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¢Ø¬Ù„Ø©
            deferred.forEach(def => {
                switch(def.type) {
                    case 'def_sale':
                        totals.deferredSales += def.amount;
                        break;
                    case 'def_purchase':
                        totals.deferredPurchases += def.amount;
                        break;
                    case 'def_return_sale':
                        totals.returnSales += def.amount;
                        break;
                    case 'def_return_purchase':
                        totals.returnPurchases += def.amount;
                        break;
                }
            });
            
            return totals;
        }
        
        function generateSummaries(transactions, deferred) {
            const summaries = {
                byFund: {},
                byType: {},
                byDeferredType: {},
                dailyBreakdown: {}
            };
            
            // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
            transactions.forEach(tx => {
                if (!summaries.byFund[tx.fund]) {
                    summaries.byFund[tx.fund] = { in: 0, out: 0 };
                }
                
                const typeInfo = TX_TYPES[tx.type];
                if (typeInfo?.type === 'in') {
                    summaries.byFund[tx.fund].in += tx.amount;
                } else if (typeInfo?.type === 'out') {
                    summaries.byFund[tx.fund].out += tx.amount;
                }
            });
            
            // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            transactions.forEach(tx => {
                const typeName = TX_TYPES[tx.type]?.label || tx.type;
                if (!summaries.byType[typeName]) {
                    summaries.byType[typeName] = { count: 0, total: 0 };
                }
                summaries.byType[typeName].count++;
                summaries.byType[typeName].total += tx.amount;
            });
            
            // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø¢Ø¬Ù„
            deferred.forEach(def => {
                const typeName = DEFERRED_TYPES[def.type]?.label || def.label;
                if (!summaries.byDeferredType[typeName]) {
                    summaries.byDeferredType[typeName] = { count: 0, total: 0 };
                }
                summaries.byDeferredType[typeName].count++;
                summaries.byDeferredType[typeName].total += def.amount;
            });
            
            // ØªØ¬Ù…ÙŠØ¹ ÙŠÙˆÙ…ÙŠ
            transactions.forEach(tx => {
                if (!summaries.dailyBreakdown[tx.date]) {
                    summaries.dailyBreakdown[tx.date] = { transactions: [], total: 0 };
                }
                summaries.dailyBreakdown[tx.date].transactions.push(tx);
                
                const typeInfo = TX_TYPES[tx.type];
                if (typeInfo?.type === 'in') {
                    summaries.dailyBreakdown[tx.date].total += tx.amount;
                } else if (typeInfo?.type === 'out') {
                    summaries.dailyBreakdown[tx.date].total -= tx.amount;
                }
            });
            
            return summaries;
        }
        
        function createReportHTML(reportId, data, dateRange) {
            const { startDate, endDate } = dateRange;
            const dateRangeStr = startDate === endDate 
                ? `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${formatDateArabic(startDate)}`
                : `Ø§Ù„ÙØªØ±Ø©: ${formatDateArabic(startDate)} Ø¥Ù„Ù‰ ${formatDateArabic(endDate)}`;
            
            let html = `
                <div style="font-family: 'Noto Sans Arabic', sans-serif; max-width: 800px; margin: 0 auto;">
                    <!-- ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
                    <div style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #0d9488;">
                        <h1 style="color: #0d9488; font-size: 24px; margin: 0; font-weight: bold;">
                            ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø©
                        </h1>
                        <h2 style="color: #333; font-size: 18px; margin: 10px 0;">
                            ${REPORT_TYPES.find(r => r.id === reportId)?.name || 'ØªÙ‚Ø±ÙŠØ±'}
                        </h2>
                        <div style="color: #666; font-size: 14px; margin-top: 10px;">
                            <div>${dateRangeStr}</div>
                            <div>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}</div>
                        </div>
                    </div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            switch(reportId) {
                case 'daily_cash':
                    html += createDailyCashReport(data);
                    break;
                case 'deferred_full':
                    html += createDeferredFullReport(data);
                    break;
                case 'combined':
                    html += createCombinedReport(data);
                    break;
                case 'funds_summary':
                    html += createFundsReport(data);
                    break;
                case 'shortages':
                    html += createShortagesReport(data);
                    break;
                case 'alerts_notes':
                    html += createAlertsNotesReport(data);
                    break;
                case 'cash_flow':
                    html += createCashFlowReport(data);
                    break;
                case 'deferred_summary':
                    html += createDeferredSummaryReport(data);
                    break;
                default:
                    html += createDailyCashReport(data);
            }
            
            html += `
                    <!-- ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; font-size: 12px; color: #666;">
                        <p style="margin: 5px 0;">ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø© - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© V8.0</p>
                        <p style="margin: 5px 0;">Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${document.getElementById('preparerName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        <p style="margin: 5px 0;">ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })}</p>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        function createDailyCashReport(data) {
            const { totals, summaries, transactions } = data;
            
            return `
                <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© -->
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #0d9488; font-size: 16px; border-bottom: 1px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                        ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;">
                        <div style="background: #f0fdf4; border: 1px solid #dcfce7; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #166534; margin-bottom: 5px;">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
                            <div style="font-size: 20px; font-weight: bold; color: #166534;">${totals.cashIn.toFixed(2)}</div>
                        </div>
                        <div style="background: #fef2f2; border: 1px solid #fee2e2; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #991b1b; margin-bottom: 5px;">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
                            <div style="font-size: 20px; font-weight: bold; color: #991b1b;">${totals.cashOut.toFixed(2)}</div>
                        </div>
                        <div style="background: ${totals.netCash >= 0 ? '#f0fdf4' : '#fef2f2'}; border: 1px solid ${totals.netCash >= 0 ? '#dcfce7' : '#fee2e2'}; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: ${totals.netCash >= 0 ? '#166534' : '#991b1b'}; margin-bottom: 5px;">ØµØ§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…</div>
                            <div style="font-size: 20px; font-weight: bold; color: ${totals.netCash >= 0 ? '#166534' : '#991b1b'};">${totals.netCash.toFixed(2)}</div>
                        </div>
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #475569; margin-bottom: 5px;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
                            <div style="font-size: 20px; font-weight: bold; color: #475569;">${transactions.length}</div>
                        </div>
                    </div>
                </div>

                <!-- ØªÙØ§ØµÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ -->
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #0d9488; font-size: 16px; border-bottom: 1px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                        ğŸ’¼ Ø­Ø±ÙƒØ© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
                    </h3>
                    <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <thead>
                            <tr style="background: #f1f5f9;">
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">Ø§Ù„ØµØ§ÙÙŠ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(summaries.byFund).map(([fund, amounts]) => `
                                <tr>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${fund}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; color: #166534; font-weight: bold;">${amounts.in.toFixed(2)}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; color: #991b1b; font-weight: bold;">${amounts.out.toFixed(2)}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; color: ${(amounts.in - amounts.out) >= 0 ? '#166534' : '#991b1b'}; font-weight: bold;">
                                        ${(amounts.in - amounts.out).toFixed(2)}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© -->
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #0d9488; font-size: 16px; border-bottom: 1px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                        ğŸ“‹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
                    </h3>
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <thead>
                            <tr style="background: #f1f5f9;">
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">Ø§Ù„ÙˆÙ‚Øª</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">Ø§Ù„Ù†ÙˆØ¹</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${transactions.map(tx => {
                                const typeInfo = TX_TYPES[tx.type];
                                const amountColor = typeInfo?.type === 'in' ? '#166534' : 
                                                   typeInfo?.type === 'out' ? '#991b1b' : '#666';
                                return `
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 6px;">${tx.time || ''}</td>
                                        <td style="border: 1px solid #ddd; padding: 6px;">${typeInfo?.label || tx.type}</td>
                                        <td style="border: 1px solid #ddd; padding: 6px;">${tx.fund || ''}</td>
                                        <td style="border: 1px solid #ddd; padding: 6px;">${tx.description || ''}</td>
                                        <td style="border: 1px solid #ddd; padding: 6px; color: ${amountColor}; font-weight: bold; text-align: left;">
                                            ${tx.amount > 0 ? tx.amount.toFixed(2) : '-'}
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function createDeferredFullReport(data) {
            const { totals, deferred } = data;
            
            return `
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© -->
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #0d9488; font-size: 16px; border-bottom: 1px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                        ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;">
                        <div style="background: #f0fdf4; border: 1px solid #dcfce7; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #166534; margin-bottom: 5px;">Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</div>
                            <div style="font-size: 20px; font-weight: bold; color: #166534;">${totals.deferredSales.toFixed(2)}</div>
                        </div>
                        <div style="background: #fef2f2; border: 1px solid #fee2e2; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #991b1b; margin-bottom: 5px;">Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©</div>
                            <div style="font-size: 20px; font-weight: bold; color: #991b1b;">${totals.deferredPurchases.toFixed(2)}</div>
                        </div>
                        <div style="background: #ecfdf5; border: 1px solid #d1fae5; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #065f46; margin-bottom: 5px;">Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                            <div style="font-size: 20px; font-weight: bold; color: #065f46;">${totals.returnSales.toFixed(2)}</div>
                        </div>
                        <div style="background: #fef2f2; border: 1px solid #fee2e2; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #b91c1c; margin-bottom: 5px;">Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª</div>
                            <div style="font-size: 20px; font-weight: bold; color: #b91c1c;">${totals.returnPurchases.toFixed(2)}</div>
                        </div>
                    </div>
                </div>

                <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© -->
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #0d9488; font-size: 16px; border-bottom: 1px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                        ğŸ“‹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
                    </h3>
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <thead>
                            <tr style="background: #f1f5f9;">
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">Ø§Ù„Ù†ÙˆØ¹</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">Ø§Ù„Ø§Ø³Ù…</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">Ø§Ù„ÙˆØµÙ</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${deferred.map(def => {
                                const typeLabel = DEFERRED_TYPES[def.type]?.label || def.label;
                                const amountColor = def.type === 'def_sale' ? '#166534' : 
                                                   def.type === 'def_purchase' ? '#991b1b' :
                                                   def.type === 'def_return_sale' ? '#065f46' :
                                                   def.type === 'def_return_purchase' ? '#b91c1c' : '#666';
                                return `
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 6px;">${def.date || ''}</td>
                                        <td style="border: 1px solid #ddd; padding: 6px;">${typeLabel}</td>
                                        <td style="border: 1px solid #ddd; padding: 6px;">${def.name || ''}</td>
                                        <td style="border: 1px solid #ddd; padding: 6px;">${def.description || '-'}</td>
                                        <td style="border: 1px solid #ddd; padding: 6px; color: ${amountColor}; font-weight: bold; text-align: left;">
                                            ${def.amount.toFixed(2)}
                                            ${def.percentage && def.percentage !== 100 ? `<br><small>(${def.percentage}%)</small>` : ''}
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function createCombinedReport(data) {
            return createDailyCashReport(data) + createDeferredFullReport(data);
        }
        
        function createFundsReport(data) {
            const { summaries } = data;
            
            return `
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #0d9488; font-size: 16px; border-bottom: 1px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                        ğŸ’¼ ØªÙ‚Ø±ÙŠØ± Ø­Ø±ÙƒØ© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                        ${Object.entries(summaries.byFund).map(([fund, amounts]) => {
                            const netAmount = amounts.in - amounts.out;
                            const bgColor = netAmount >= 0 ? '#f0fdf4' : '#fef2f2';
                            const borderColor = netAmount >= 0 ? '#dcfce7' : '#fee2e2';
                            const textColor = netAmount >= 0 ? '#166534' : '#991b1b';
                            
                            return `
                                <div style="background: ${bgColor}; border: 1px solid ${borderColor}; padding: 15px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 12px; color: #475569; margin-bottom: 5px;">${fund}</div>
                                    <div style="font-size: 16px; font-weight: bold; color: #166534; margin-bottom: 3px;">${amounts.in.toFixed(2)} â†‘</div>
                                    <div style="font-size: 16px; font-weight: bold; color: #991b1b; margin-bottom: 3px;">${amounts.out.toFixed(2)} â†“</div>
                                    <div style="font-size: 18px; font-weight: bold; color: ${textColor}; margin-top: 5px;">${netAmount.toFixed(2)}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }
        
        function createShortagesReport(data) {
            const shortages = data.transactions.filter(tx => tx.type === 'shortage');
            
            return `
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #0d9488; font-size: 16px; border-bottom: 1px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                        âš ï¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†ÙˆØ§Ù‚Øµ (${shortages.length})
                    </h3>
                    ${shortages.length > 0 ? `
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #fef2f2;">
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">Ø§Ù„ÙˆÙ‚Øª</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø§Ù„Ù†Ø§Ù‚Øµ</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${shortages.map(tx => `
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 8px;">${tx.date}</td>
                                        <td style="border: 1px solid #ddd; padding: 8px;">${tx.time || ''}</td>
                                        <td style="border: 1px solid #ddd; padding: 8px; color: #dc2626; font-weight: bold;">${tx.description}</td>
                                        <td style="border: 1px solid #ddd; padding: 8px;">${tx.fund || ''}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : `
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 20px; border-radius: 8px; text-align: center;">
                            <i class="fas fa-check-circle" style="font-size: 36px; color: #10b981; margin-bottom: 10px;"></i>
                            <div style="font-size: 14px; color: #475569;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙˆØ§Ù‚Øµ Ù…Ø³Ø¬Ù„Ø©</div>
                        </div>
                    `}
                </div>
            `;
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØµØ¯ÙŠØ±
        // ============================================
        
        async function printAdvancedReport(html, data) {
            const printWindow = window.open('', '_blank');
            
            const printContent = `
                <!DOCTYPE html>
                <html dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>ØªÙ‚Ø±ÙŠØ± ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø©</title>
                    <style>
                        body { 
                            font-family: 'Noto Sans Arabic', sans-serif; 
                            padding: 15px; 
                            background: white; 
                            font-size: 12px; 
                            line-height: 1.4;
                            max-width: 800px;
                            margin: 0 auto;
                        }
                        h1, h2, h3 { margin: 0 0 10px 0; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
                        thead { background: #f8fafc; }
                        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
                        .stat-box { padding: 15px; border-radius: 8px; text-align: center; }
                        @media print {
                            body { padding: 10px; }
                            .no-print { display: none; }
                            @page { margin: 0.5cm; }
                        }
                        .page-break { page-break-before: always; }
                        .text-center { text-align: center; }
                    </style>
                </head>
                <body>
                    ${html}
                    <script>
                        window.onload = function() {
                            window.print();
                            setTimeout(function() {
                                window.close();
                            }, 1000);
                        };
                    <\/script>
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
        }
        
        async function exportToPDF(html, data, includeImages) {
            showLoader();
            
            const options = {
                margin: [10, 10, 10, 10],
                filename: `ØªÙ‚Ø±ÙŠØ±_${selectedReportId}_${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait',
                    compress: true
                }
            };
            
            try {
                await html2pdf().from(html).set(options).save();
                showMessage('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ PDF Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF', 'error');
            } finally {
                hideLoader();
            }
        }
        
        function exportToExcel(data) {
            // Ø¥Ù†Ø´Ø§Ø¡ CSV
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
            
            // Ø±Ø£Ø³ Ø§Ù„Ù…Ù„Ù
            const headers = ["Ø§Ù„ØªØ§Ø±ÙŠØ®", "Ø§Ù„Ù†ÙˆØ¹", "Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚", "Ø§Ù„Ø¨ÙŠØ§Ù†", "Ø§Ù„Ù…Ø¨Ù„Øº", "Ø§Ù„ÙˆÙ‚Øª"];
            csvContent += headers.join(",") + "\n";
            
            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            data.transactions.forEach(tx => {
                const typeInfo = TX_TYPES[tx.type];
                const row = [
                    tx.date,
                    typeInfo?.label || tx.type,
                    tx.fund,
                    `"${tx.description.replace(/"/g, '""')}"`,
                    tx.amount.toFixed(2),
                    tx.time
                ];
                csvContent += row.join(",") + "\n";
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¢Ø¬Ù„Ø©
            csvContent += "\n\nØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©\n";
            const deferredHeaders = ["Ø§Ù„ØªØ§Ø±ÙŠØ®", "Ø§Ù„Ù†ÙˆØ¹", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„ÙˆØµÙ", "Ø§Ù„Ù…Ø¨Ù„Øº", "Ø§Ù„Ù†Ø³Ø¨Ø©%"];
            csvContent += deferredHeaders.join(",") + "\n";
            
            data.deferred.forEach(def => {
                const typeLabel = DEFERRED_TYPES[def.type]?.label || def.label;
                const row = [
                    def.date,
                    typeLabel,
                    def.name,
                    `"${(def.description || '').replace(/"/g, '""')}"`,
                    def.amount.toFixed(2),
                    def.percentage || 100
                ];
                csvContent += row.join(",") + "\n";
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `ØªÙ‚Ø±ÙŠØ±_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showMessage('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Excel', 'success');
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        // ============================================
        
        function saveData() {
            try {
                localStorage.setItem('sadara_tx', JSON.stringify(systemData.transactions));
                localStorage.setItem('sadara_def', JSON.stringify(systemData.deferred));
                localStorage.setItem('sadara_arch', JSON.stringify(systemData.archives));
                localStorage.setItem('sadara_settings', JSON.stringify(systemData.settings));
                localStorage.setItem('sadara_images', JSON.stringify(systemData.images));
            } catch (e) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', e);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
            }
        }
        
        function executeTransfer() {
            const from = document.getElementById('tFrom').value;
            const to = document.getElementById('tTo').value;
            const amount = parseFloat(document.getElementById('tAmount').value);
            
            if (from === to) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù†ÙØ³ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚');
                return;
            }
            
            if (!amount || amount <= 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­');
                return;
            }
            
            const time = new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
            const currentDate = document.getElementById('currentDate').value || new Date().toLocaleDateString('ar-EG');
            
            const tx1 = {
                id: Date.now(),
                type: 'expense',
                amount: amount,
                description: `ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ${to}`,
                fund: from,
                date: currentDate,
                time: time
            };
            
            const tx2 = {
                id: Date.now() + 1,
                type: 'income',
                amount: amount,
                description: `ØªØ­ÙˆÙŠÙ„ Ù…Ù† ${from}`,
                fund: to,
                date: currentDate,
                time: time
            };
            
            systemData.transactions.push(tx1, tx2);
            saveData();
            loadDailyTransactions();
            hideModal('transferModal');
            
            document.getElementById('tAmount').value = '';
            showMessage('ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
        function showArchive() {
            if (systemData.archives.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø¤Ø±Ø´ÙØ©');
                return;
            }
            
            let archiveContent = '<h1 style="text-align:center; color:#0d9488; font-size:18px; margin-bottom:20px;">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¤Ø±Ø´ÙØ©</h1>';
            
            systemData.archives.slice(0, 10).forEach((archive, index) => {
                archiveContent += `
                    <div style="border:1px solid #e2e8f0; padding:15px; margin-bottom:15px; border-radius:8px; background:#f8fafc;">
                        <div style="font-weight:600; color:#0d9488; font-size:14px;">${archive.date}</div>
                        <div style="font-size:12px; color:#666; margin:5px 0;">
                            Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${archive.preparer || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} | Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª: ${archive.transactions?.length || 0}
                        </div>
                        <div style="font-size:12px; color:#666; margin:5px 0;">${archive.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª'}</div>
                        <button onclick="printArchive(${index})" style="background:#0d9488; color:white; border:none; padding:8px 15px; border-radius:5px; margin-top:10px; cursor:pointer; font-size:12px; font-weight:600;">
                            Ø¹Ø±Ø¶ ÙˆØ·Ø¨Ø§Ø¹Ø©
                        </button>
                    </div>
                `;
            });
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>Ø§Ù„Ø£Ø±Ø´ÙŠÙ</title>
                    <style>
                        body { font-family: 'Noto Sans Arabic', sans-serif; padding: 20px; background:#f5f7fa; font-size: 12px; }
                        h1 { text-align: center; color: #0d9488; }
                        .container { max-width: 800px; margin: 0 auto; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        ${archiveContent}
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
        }
        
        function saveAndClose() {
            if (systemData.transactions.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
                return;
            }
            
            if (!confirm('Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ØŸ Ø³ØªØ­ÙØ¸ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ.')) return;
            
            const preparer = document.getElementById('preparerName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const notes = document.getElementById('generalNotes').value || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª';
            const date = document.getElementById('currentDate').value || new Date().toLocaleDateString('ar-EG');
            
            const archive = {
                date: date,
                preparer: preparer,
                notes: notes,
                transactions: [...systemData.transactions],
                deferred: [...systemData.deferred],
                images: [...systemData.images],
                timestamp: new Date().toISOString()
            };
            
            systemData.archives.push(archive);
            
            // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            systemData.transactions = [];
            systemData.deferred = [];
            systemData.images = [];
            document.getElementById('generalNotes').value = '';
            document.getElementById('preparerName').value = '';
            
            saveData();
            loadDailyTransactions();
            loadDeferredTransactions();
            loadSavedImages();
            
            showMessage('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ', 'success');
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®
        // ============================================
        
        function loadSavedReportDates() {
            const container = document.getElementById('savedReportDates');
            container.innerHTML = '';
            
            // Ø¬Ù…Ø¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„ÙØ±ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const uniqueDates = new Set();
            
            // Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù…Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            systemData.transactions.forEach(tx => {
                if (tx.date) uniqueDates.add(tx.date);
            });
            
            // Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙ
            systemData.archives.forEach(arch => {
                if (arch.date) uniqueDates.add(arch.date);
            });
            
            // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© ÙˆØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠØ§Ù‹
            const sortedDates = Array.from(uniqueDates).sort((a, b) => new Date(b) - new Date(a));
            
            if (sortedDates.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©</p>';
                return;
            }
            
            sortedDates.slice(0, 10).forEach(date => {
                const dateBtn = document.createElement('button');
                dateBtn.className = 'w-full p-3 text-right bg-gray-50 hover:bg-gray-100 rounded transition text-small';
                dateBtn.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span>${formatDateArabic(date)}</span>
                        <i class="fas fa-chevron-left text-gray-400"></i>
                    </div>
                `;
                dateBtn.onclick = () => {
                    document.getElementById('reportDateSelect').value = date;
                };
                container.appendChild(dateBtn);
            });
        }
        
        function generateReportForSelectedDate() {
            const selectedDate = document.getElementById('reportDateSelect').value;
            if (!selectedDate) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ®');
                return;
            }
            
            currentReport.date = selectedDate;
            currentReport.type = 'daily_summary';
            
            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            const container = document.getElementById('reportsContainer');
            const content = document.getElementById('reportContent');
            const title = document.getElementById('reportTitle');
            const dateInfo = document.getElementById('reportDateInfo');
            const deferredTotalsSection = document.getElementById('deferredTotals');
            
            container.classList.remove('hidden');
            container.scrollIntoView({ behavior: 'smooth' });
            
            title.textContent = 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„';
            dateInfo.textContent = `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${formatDateArabic(selectedDate)}`;
            
            // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯
            const dateTransactions = systemData.transactions.filter(tx => tx.date === selectedDate);
            const dateDeferred = systemData.deferred.filter(def => def.date === selectedDate);
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
            const deferredTotals = calculateDeferredTotals(selectedDate);
            
            // Ø¹Ø±Ø¶ Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
            deferredTotalsSection.classList.remove('hidden');
            document.getElementById('totalDefSales').textContent = deferredTotals.sales.toFixed(2);
            document.getElementById('totalDefPurchases').textContent = deferredTotals.purchases.toFixed(2);
            document.getElementById('totalDefReturnSales').textContent = deferredTotals.return_sales.toFixed(2);
            document.getElementById('totalDefReturnPurchases').textContent = deferredTotals.return_purchases.toFixed(2);
            
            const dailyTotal = dateTransactions.reduce((sum, tx) => {
                const typeInfo = TX_TYPES[tx.type];
                if (typeInfo.type === 'in') return sum + tx.amount;
                if (typeInfo.type === 'out') return sum - tx.amount;
                return sum;
            }, 0);
            
            // ØªØµÙ†ÙŠÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            const transactionsByType = {};
            dateTransactions.forEach(tx => {
                if (!transactionsByType[tx.type]) {
                    transactionsByType[tx.type] = {
                        label: TX_TYPES[tx.type]?.label || tx.type,
                        icon: TX_TYPES[tx.type]?.icon || 'ğŸ“‹',
                        transactions: [],
                        total: 0
                    };
                }
                transactionsByType[tx.type].transactions.push(tx);
                const typeInfo = TX_TYPES[tx.type];
                if (typeInfo?.type === 'in') {
                    transactionsByType[tx.type].total += tx.amount;
                } else if (typeInfo?.type === 'out') {
                    transactionsByType[tx.type].total -= tx.amount;
                }
            });
            
            // ØªØµÙ†ÙŠÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
            const deferredByType = {};
            dateDeferred.forEach(def => {
                if (!deferredByType[def.type]) {
                    deferredByType[def.type] = {
                        label: DEFERRED_TYPES[def.type]?.label || def.label,
                        icon: DEFERRED_TYPES[def.type]?.icon || 'ğŸ“‹',
                        transactions: [],
                        total: 0
                    };
                }
                deferredByType[def.type].transactions.push(def);
                deferredByType[def.type].total += def.amount;
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ HTML Ù„Ù„ØªÙ‚Ø±ÙŠØ±
            let html = `
                <div class="space-y-6">
                    <div class="report-section">
                        <div class="report-section-title">
                            <i class="fas fa-chart-bar mr-2"></i>
                            Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ§Ø±ÙŠØ®
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div class="bg-white p-4 rounded text-center shadow border">
                                <div class="text-large font-medium text-primary">${dateTransactions.length}</div>
                                <div class="text-small text-gray-600">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</div>
                            </div>
                            <div class="bg-white p-4 rounded text-center shadow border">
                                <div class="text-large font-medium text-orange-600">${dateDeferred.length}</div>
                                <div class="text-small text-gray-600">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</div>
                            </div>
                            <div class="bg-white p-4 rounded text-center shadow border">
                                <div class="text-large font-medium text-red-600">${dateTransactions.filter(tx => tx.type === 'shortage').length}</div>
                                <div class="text-small text-gray-600">Ø§Ù„Ù†ÙˆØ§Ù‚Øµ</div>
                            </div>
                            <div class="bg-white p-4 rounded text-center shadow border">
                                <div class="text-large font-medium ${dailyTotal >= 0 ? 'text-green-600' : 'text-red-600'}">${dailyTotal.toFixed(2)}</div>
                                <div class="text-small text-gray-600">ØµØ§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…</div>
                            </div>
                        </div>
                    </div>
            `;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            if (Object.keys(transactionsByType).length > 0) {
                html += `
                    <div class="report-section">
                        <div class="report-section-title">
                            <i class="fas fa-cash-register mr-2"></i>
                            Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
                        </div>
                        <div class="space-y-4">
                `;
                
                for (const [type, data] of Object.entries(transactionsByType)) {
                    html += `
                        <div class="border rounded-lg overflow-hidden">
                            <div class="bg-gray-50 p-3 font-medium border-b flex justify-between items-center">
                                <div>
                                    <span class="ml-2">${data.icon}</span>
                                    ${data.label}
                                </div>
                                <div class="font-semibold ${data.total >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${Math.abs(data.total).toFixed(2)}
                                </div>
                            </div>
                            <div class="p-3 space-y-2 max-h-60 overflow-y-auto">
                    `;
                    
                    data.transactions.forEach(tx => {
                        html += `
                            <div class="flex justify-between items-center p-2 bg-white border rounded">
                                <div>
                                    <div class="font-medium">${tx.description}</div>
                                    <div class="text-small text-gray-600">${tx.fund} | ${tx.time}</div>
                                </div>
                                <div class="font-semibold ${TX_TYPES[tx.type]?.color || 'text-gray-700'}">
                                    ${tx.amount.toFixed(2)}
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
            if (Object.keys(deferredByType).length > 0) {
                html += `
                    <div class="report-section">
                        <div class="report-section-title">
                            <i class="fas fa-calendar-alt mr-2"></i>
                            Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
                        </div>
                        <div class="space-y-4">
                `;
                
                for (const [type, data] of Object.entries(deferredByType)) {
                    const typeInfo = DEFERRED_TYPES[type] || {};
                    const bgClass = typeInfo.bg || 'bg-gray-50';
                    const textClass = typeInfo.color || 'text-gray-700';
                    
                    html += `
                        <div class="border rounded-lg overflow-hidden">
                            <div class="${bgClass} p-3 font-medium border-b flex justify-between items-center">
                                <div>
                                    <span class="ml-2">${data.icon}</span>
                                    ${data.label}
                                </div>
                                <div class="font-semibold ${textClass}">${data.total.toFixed(2)}</div>
                            </div>
                            <div class="p-3 space-y-2">
                    `;
                    
                    data.transactions.forEach(def => {
                        html += `
                            <div class="flex justify-between items-center p-2 bg-white border rounded">
                                <div>
                                    <div class="font-medium">${def.name}</div>
                                    <div class="text-small text-gray-600">${def.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</div>
                                    ${def.reference ? `<div class="text-small text-blue-600">Ù…Ø±Ø¬Ø¹: ${def.reference}</div>` : ''}
                                </div>
                                <div class="font-semibold text-gray-800">
                                    ${def.amount.toFixed(2)}
                                    ${def.percentage && def.percentage !== 100 ? `<div class="text-small text-blue-600">${def.percentage}%</div>` : ''}
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            html += `
                    <div class="report-section">
                        <div class="report-section-title">
                            <i class="fas fa-images mr-2"></i>
                            Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙˆØ±
                        </div>
                        <div class="bg-blue-50 p-4 rounded border">
                            <p class="text-medium">
                                <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                                Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©: <strong>${systemData.images.length}</strong>
                            </p>
                            <p class="text-small text-gray-600 mt-2">
                                Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© ÙÙŠ Ù†Ø³Ø®Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
                            </p>
                        </div>
                    </div>
                </div>
            `;
            
            content.innerHTML = html;
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
            currentReport.data = {
                date: selectedDate,
                transactions: dateTransactions,
                deferred: dateDeferred,
                totals: deferredTotals,
                dailyTotal: dailyTotal,
                html: html
            };
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            loadReportImages();
            
            hideModal('reportDateModal');
        }
        
        function printReportForSelectedDate() {
            const selectedDate = document.getElementById('reportDateSelect').value;
            if (!selectedDate) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ®');
                return;
            }
            
            // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
            const dateTransactions = systemData.transactions.filter(tx => tx.date === selectedDate);
            const dateDeferred = systemData.deferred.filter(def => def.date === selectedDate);
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
            const deferredTotals = calculateDeferredTotals(selectedDate);
            
            const dailyTotal = dateTransactions.reduce((sum, tx) => {
                const typeInfo = TX_TYPES[tx.type];
                if (typeInfo.type === 'in') return sum + tx.amount;
                if (typeInfo.type === 'out') return sum - tx.amount;
                return sum;
            }, 0);
            
            // ØªØ­Ø¶ÙŠØ± HTML Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
            let printHtml = `
                <div style="text-align:center; margin-bottom:20px;">
                    <h1 style="color:#0d9488; font-size:20px; margin:0;">ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h1>
                    <h2 style="color:#333; font-size:16px; margin:5px 0;">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠØ© Ù…ÙØµÙ„</h2>
                    <div style="color:#666; font-size:12px;">
                        <div>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${formatDateArabic(selectedDate)}</div>
                        <div>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-EG')}</div>
                    </div>
                </div>
                
                <div style="margin-bottom:20px;">
                    <h3 style="color:#0d9488; font-size:14px; border-bottom:1px solid #ddd; padding-bottom:5px; margin-bottom:10px;">
                        Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                    </h3>
                    <table style="width:100%; border-collapse:collapse; font-size:11px; margin-bottom:15px;">
                        <tr>
                            <td style="border:1px solid #ddd; padding:8px; background:#f8fafc;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</td>
                            <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold;">${dateTransactions.length}</td>
                            <td style="border:1px solid #ddd; padding:8px; background:#f8fafc;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</td>
                            <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold;">${dateDeferred.length}</td>
                        </tr>
                        <tr>
                            <td style="border:1px solid #ddd; padding:8px; background:#f8fafc;">Ø¹Ø¯Ø¯ Ø§Ù„Ù†ÙˆØ§Ù‚Øµ</td>
                            <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold; color:#dc2626;">${dateTransactions.filter(tx => tx.type === 'shortage').length}</td>
                            <td style="border:1px solid #ddd; padding:8px; background:#f8fafc;">ØµØ§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…</td>
                            <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold; ${dailyTotal >= 0 ? 'color:#166534;' : 'color:#dc2626;'}">${dailyTotal.toFixed(2)}</td>
                        </tr>
                    </table>
                    
                    <h3 style="color:#0d9488; font-size:14px; border-bottom:1px solid #ddd; padding-bottom:5px; margin-bottom:10px;">
                        Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
                    </h3>
                    <table style="width:100%; border-collapse:collapse; font-size:11px; margin-bottom:20px;">
                        <tr>
                            <td style="border:1px solid #ddd; padding:8px; background:#f0fdf4;">Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</td>
                            <td style="border:1px solid #ddd; padding:8px; text-align:left; font-weight:bold; color:#166534;">${deferredTotals.sales.toFixed(2)}</td>
                            <td style="border:1px solid #ddd; padding:8px; background:#fef2f2;">Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©</td>
                            <td style="border:1px solid #ddd; padding:8px; text-align:left; font-weight:bold; color:#991b1b;">${deferredTotals.purchases.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td style="border:1px solid #ddd; padding:8px; background:#ecfdf5;">Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</td>
                            <td style="border:1px solid #ddd; padding:8px; text-align:left; font-weight:bold; color:#065f46;">${deferredTotals.return_sales.toFixed(2)}</td>
                            <td style="border:1px solid #ddd; padding:8px; background:#fef2f2;">Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©</td>
                            <td style="border:1px solid #ddd; padding:8px; text-align:left; font-weight:bold; color:#b91c1c;">${deferredTotals.return_purchases.toFixed(2)}</td>
                        </tr>
                    </table>
                </div>
            `;
            
            // Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
            if (dateTransactions.length > 0) {
                printHtml += `
                    <div style="page-break-inside:avoid; margin-bottom:20px;">
                        <h3 style="color:#0d9488; font-size:14px; border-bottom:1px solid #ddd; padding-bottom:5px; margin-bottom:10px;">
                            Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© (${dateTransactions.length})
                        </h3>
                        <table style="width:100%; border-collapse:collapse; font-size:10px;">
                            <thead>
                                <tr style="background:#f1f5f9;">
                                    <th style="border:1px solid #ddd; padding:5px; text-align:right;">Ø§Ù„ÙˆÙ‚Øª</th>
                                    <th style="border:1px solid #ddd; padding:5px; text-align:right;">Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th style="border:1px solid #ddd; padding:5px; text-align:right;">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</th>
                                    <th style="border:1px solid #ddd; padding:5px; text-align:right;">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                    <th style="border:1px solid #ddd; padding:5px; text-align:right;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                dateTransactions.forEach(tx => {
                    const typeInfo = TX_TYPES[tx.type];
                    const amountColor = typeInfo.type === 'in' ? '#166534' : typeInfo.type === 'out' ? '#dc2626' : '#666';
                    
                    printHtml += `
                        <tr>
                            <td style="border:1px solid #ddd; padding:5px;">${tx.time || ''}</td>
                            <td style="border:1px solid #ddd; padding:5px;">${typeInfo?.label || tx.type}</td>
                            <td style="border:1px solid #ddd; padding:5px;">${tx.fund || ''}</td>
                            <td style="border:1px solid #ddd; padding:5px;">${tx.description || ''}</td>
                            <td style="border:1px solid #ddd; padding:5px; color:${amountColor}; font-weight:bold; text-align:left;">${tx.amount.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                printHtml += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            // Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
            if (dateDeferred.length > 0) {
                printHtml += `
                    <div style="page-break-inside:avoid; margin-bottom:20px;">
                        <h3 style="color:#0d9488; font-size:14px; border-bottom:1px solid #ddd; padding-bottom:5px; margin-bottom:10px;">
                            Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø© (${dateDeferred.length})
                        </h3>
                        <table style="width:100%; border-collapse:collapse; font-size:10px;">
                            <thead>
                                <tr style="background:#f1f5f9;">
                                    <th style="border:1px solid #ddd; padding:5px; text-align:right;">Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th style="border:1px solid #ddd; padding:5px; text-align:right;">Ø§Ù„Ø§Ø³Ù…</th>
                                    <th style="border:1px solid #ddd; padding:5px; text-align:right;">Ø§Ù„ÙˆØµÙ</th>
                                    <th style="border:1px solid #ddd; padding:5px; text-align:right;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                dateDeferred.forEach(def => {
                    const typeLabel = DEFERRED_TYPES[def.type]?.label || def.label;
                    const amountColor = def.type === 'def_sale' ? '#166534' : 
                                       def.type === 'def_purchase' ? '#991b1b' :
                                       def.type === 'def_return_sale' ? '#065f46' :
                                       def.type === 'def_return_purchase' ? '#b91c1c' : '#666';
                    
                    printHtml += `
                        <tr>
                            <td style="border:1px solid #ddd; padding:5px;">${typeLabel}</td>
                            <td style="border:1px solid #ddd; padding:5px;">${def.name || ''}</td>
                            <td style="border:1px solid #ddd; padding:5px;">${def.description || ''}</td>
                            <td style="border:1px solid #ddd; padding:5px; color:${amountColor}; font-weight:bold; text-align:left;">${def.amount.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                printHtml += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            // Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
            if (systemData.images.length > 0) {
                printHtml += `
                    <div style="page-break-inside:avoid; margin-top:20px;">
                        <h3 style="color:#0d9488; font-size:14px; border-bottom:1px solid #ddd; padding-bottom:5px; margin-bottom:10px;">
                            Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© (${systemData.images.length})
                        </h3>
                        <div style="text-align:center; font-size:11px; color:#666; padding:10px; background:#f8fafc; border:1px solid #ddd; border-radius:5px;">
                            <i class="fas fa-images" style="font-size:20px; display:block; margin-bottom:5px;"></i>
                            ØªÙ… Ø±ÙØ¹ ${systemData.images.length} ØµÙˆØ± ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
                        </div>
                    </div>
                `;
            }
            
            // Ø§ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>ØªÙ‚Ø±ÙŠØ± ${selectedDate}</title>
                    <style>
                        body { font-family: 'Noto Sans Arabic', sans-serif; padding: 15px; background: white; font-size: 11px; line-height: 1.4; }
                        h1, h2, h3 { margin: 0 0 10px 0; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
                        th, td { border: 1px solid #ddd; padding: 5px; text-align: right; }
                        thead { background: #f8fafc; }
                        @media print {
                            body { padding: 10px; }
                            .no-print { display: none; }
                            @page { margin: 0.5cm; }
                        }
                        .page-break { page-break-before: always; }
                        .text-center { text-align: center; }
                    </style>
                </head>
                <body>
                    ${printHtml}
                    <div style="margin-top:30px; padding-top:15px; border-top:1px solid #ddd; text-align:center; font-size:10px; color:#666;">
                        <p>ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø© - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© V8.0</p>
                        <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-EG')} ${new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })}</p>
                        <p>Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${document.getElementById('preparerName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù PDF (Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©)
        // ============================================
        
        function generatePDF() {
            if (!currentReport.data) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚Ø±ÙŠØ± Ù„Ø¹Ø±Ø¶Ù‡');
                return;
            }
            
            showLoader();
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ HTML Ù„Ù„PDF
            const selectedDate = currentReport.date;
            const dateTransactions = currentReport.data.transactions;
            const dateDeferred = currentReport.data.deferred;
            const deferredTotals = currentReport.data.totals;
            const dailyTotal = currentReport.data.dailyTotal;
            
            let pdfHtml = `
                <div style="font-family: 'Noto Sans Arabic', sans-serif; padding: 20px; max-width: 800px; margin: 0 auto;">
                    <div style="text-align:center; margin-bottom:30px;">
                        <h1 style="color:#0d9488; font-size:24px; margin:0; font-weight:bold;">ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h1>
                        <h2 style="color:#333; font-size:18px; margin:10px 0;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„</h2>
                        <div style="color:#666; font-size:14px; margin-top:10px;">
                            <div>Ø§Ù„ØªØ§Ø±ÙŠØ®: <strong>${formatDateArabic(selectedDate)}</strong></div>
                            <div>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom:30px;">
                        <h3 style="color:#0d9488; font-size:16px; border-bottom:2px solid #0d9488; padding-bottom:8px; margin-bottom:15px;">
                            Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                        </h3>
                        <table style="width:100%; border-collapse:collapse; font-size:13px; margin-bottom:20px;">
                            <tr>
                                <td style="border:1px solid #ddd; padding:10px; background:#f8fafc; font-weight:bold;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</td>
                                <td style="border:1px solid #ddd; padding:10px; text-align:center; font-weight:bold; font-size:14px;">${dateTransactions.length}</td>
                                <td style="border:1px solid #ddd; padding:10px; background:#f8fafc; font-weight:bold;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</td>
                                <td style="border:1px solid #ddd; padding:10px; text-align:center; font-weight:bold; font-size:14px;">${dateDeferred.length}</td>
                            </tr>
                            <tr>
                                <td style="border:1px solid #ddd; padding:10px; background:#f8fafc; font-weight:bold;">ØµØ§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…</td>
                                <td style="border:1px solid #ddd; padding:10px; text-align:center; font-weight:bold; font-size:14px; ${dailyTotal >= 0 ? 'color:#166534;' : 'color:#dc2626;'}">${dailyTotal.toFixed(2)}</td>
                                <td style="border:1px solid #ddd; padding:10px; background:#f8fafc; font-weight:bold;">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ±</td>
                                <td style="border:1px solid #ddd; padding:10px; text-align:center; font-weight:bold; font-size:14px;">${systemData.images.length}</td>
                            </tr>
                        </table>
                        
                        <h3 style="color:#0d9488; font-size:16px; border-bottom:2px solid #0d9488; padding-bottom:8px; margin-bottom:15px;">
                            Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
                        </h3>
                        <table style="width:100%; border-collapse:collapse; font-size:13px; margin-bottom:25px;">
                            <tr>
                                <td style="border:1px solid #ddd; padding:12px; background:#f0fdf4; font-weight:bold; width:25%;">Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</td>
                                <td style="border:1px solid #ddd; padding:12px; text-align:left; font-weight:bold; font-size:15px; color:#166534;">${deferredTotals.sales.toFixed(2)}</td>
                                <td style="border:1px solid #ddd; padding:12px; background:#fef2f2; font-weight:bold; width:25%;">Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©</td>
                                <td style="border:1px solid #ddd; padding:12px; text-align:left; font-weight:bold; font-size:15px; color:#991b1b;">${deferredTotals.purchases.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td style="border:1px solid #ddd; padding:12px; background:#ecfdf5; font-weight:bold;">Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</td>
                                <td style="border:1px solid #ddd; padding:12px; text-align:left; font-weight:bold; font-size:15px; color:#065f46;">${deferredTotals.return_sales.toFixed(2)}</td>
                                <td style="border:1px solid #ddd; padding:12px; background:#fee2e2; font-weight:bold;">Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©</td>
                                <td style="border:1px solid #ddd; padding:12px; text-align:left; font-weight:bold; font-size:15px; color:#b91c1c;">${deferredTotals.return_purchases.toFixed(2)}</td>
                            </tr>
                        </table>
                    </div>
            `;
            
            // Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
            if (dateTransactions.length > 0) {
                pdfHtml += `
                    <div style="margin-bottom:30px;">
                        <h3 style="color: #0d9488; font-size: 16px; border-bottom: 2px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                            Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
                        </h3>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background:#f1f5f9;">
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„ÙˆÙ‚Øª</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                dateTransactions.forEach(tx => {
                    const typeInfo = TX_TYPES[tx.type];
                    const amountColor = typeInfo.type === 'in' ? '#166534' : typeInfo.type === 'out' ? '#dc2626' : '#666';
                    
                    pdfHtml += `
                        <tr>
                            <td style="border:1px solid #ddd; padding:8px;">${tx.time || ''}</td>
                            <td style="border:1px solid #ddd; padding:8px;">${typeInfo?.label || tx.type}</td>
                            <td style="border:1px solid #ddd; padding:8px;">${tx.fund || ''}</td>
                            <td style="border:1px solid #ddd; padding:8px;">${tx.description || ''}</td>
                            <td style="border:1px solid #ddd; padding:8px; color:${amountColor}; font-weight:bold; text-align:left;">${tx.amount.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                pdfHtml += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            // Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
            if (dateDeferred.length > 0) {
                pdfHtml += `
                    <div style="margin-bottom:30px;">
                        <h3 style="color: #0d9488; font-size: 16px; border-bottom: 2px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                            Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
                        </h3>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background:#f1f5f9;">
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ø§Ø³Ù…</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„ÙˆØµÙ</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                dateDeferred.forEach(def => {
                    const typeLabel = DEFERRED_TYPES[def.type]?.label || def.label;
                    const amountColor = def.type === 'def_sale' ? '#166534' : 
                                       def.type === 'def_purchase' ? '#991b1b' :
                                       def.type === 'def_return_sale' ? '#065f46' :
                                       def.type === 'def_return_purchase' ? '#b91c1c' : '#666';
                    
                    pdfHtml += `
                        <tr>
                            <td style="border:1px solid #ddd; padding:8px;">${typeLabel}</td>
                            <td style="border:1px solid #ddd; padding:8px;">${def.name || ''}</td>
                            <td style="border:1px solid #ddd; padding:8px;">${def.description || ''}</td>
                            <td style="border:1px solid #ddd; padding:8px; color:${amountColor}; font-weight:bold; text-align:left;">${def.amount.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                pdfHtml += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            // Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
            if (systemData.images.length > 0) {
                pdfHtml += `
                    <div style="margin-bottom:30px;">
                        <h3 style="color: #0d9488; font-size: 16px; border-bottom: 2px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                            Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
                        </h3>
                        <div style="text-align:center; padding:20px; background:#f8fafc; border:2px dashed #ddd; border-radius:8px;">
                            <i class="fas fa-images" style="font-size:36px; color:#0d9488; margin-bottom:10px; display:block;"></i>
                            <div style="font-size:14px; color:#666;">
                                ØªÙ… Ø±ÙØ¹ <strong>${systemData.images.length}</strong> ØµÙˆØ± ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
                            </div>
                            <div style="font-size:12px; color:#999; margin-top:10px;">
                                (Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø·Ø¨ÙˆØ¹Ø©)
                            </div>
                        </div>
                    </div>
                `;
            }
            
            pdfHtml += `
                    <div style="margin-top:40px; padding-top:20px; border-top:2px solid #ddd; text-align:center; font-size:12px; color:#666;">
                        <p style="margin:5px 0;">ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø© - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© V8.0</p>
                        <p style="margin:5px 0;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date().toLocaleDateString('ar-EG')} ${new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })}</p>
                        <p style="margin:5px 0; font-weight:bold;">Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${document.getElementById('preparerName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    </div>
                </div>
            `;
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®ÙŠØ§Ø±Ø§Øª PDF
            const options = {
                margin: [10, 10, 10, 10],
                filename: `ØªÙ‚Ø±ÙŠØ±_ØµÙŠØ¯Ù„ÙŠØ©_Ø§Ù„ØµØ¯Ø§Ø±Ø©_${selectedDate}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait',
                    compress: true
                }
            };
            
            // Ø¥Ù†Ø´Ø§Ø¡ PDF
            setTimeout(() => {
                html2pdf().from(pdfHtml).set(options).save().then(() => {
                    hideLoader();
                    showMessage('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ PDF Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }).catch((error) => {
                    hideLoader();
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF:', error);
                    showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF', 'error');
                });
            }, 1000);
        }
        
        function generatePDFWithoutImages() {
            if (!currentReport.data) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚Ø±ÙŠØ± Ù„Ø¹Ø±Ø¶Ù‡');
                return;
            }
            
            showLoader();
            
            // Ù†ÙØ³ Ù…Ø­ØªÙˆÙ‰ generatePDF ÙˆÙ„ÙƒÙ† Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù… Ø§Ù„ØµÙˆØ±
            const selectedDate = currentReport.date;
            const dateTransactions = currentReport.data.transactions;
            const dateDeferred = currentReport.data.deferred;
            const deferredTotals = currentReport.data.totals;
            const dailyTotal = currentReport.data.dailyTotal;
            
            let pdfHtml = `
                <div style="font-family: 'Noto Sans Arabic', sans-serif; padding: 20px; max-width: 800px; margin: 0 auto;">
                    <div style="text-align:center; margin-bottom:30px;">
                        <h1 style="color:#0d9488; font-size:24px; margin:0; font-weight:bold;">ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h1>
                        <h2 style="color:#333; font-size:18px; margin:10px 0;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„</h2>
                        <div style="color:#666; font-size:14px; margin-top:10px;">
                            <div>Ø§Ù„ØªØ§Ø±ÙŠØ®: <strong>${formatDateArabic(selectedDate)}</strong></div>
                            <div>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom:30px;">
                        <h3 style="color:#0d9488; font-size:16px; border-bottom:2px solid #0d9488; padding-bottom:8px; margin-bottom:15px;">
                            Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                        </h3>
                        <table style="width:100%; border-collapse:collapse; font-size:13px; margin-bottom:20px;">
                            <tr>
                                <td style="border:1px solid #ddd; padding:10px; background:#f8fafc; font-weight:bold;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</td>
                                <td style="border:1px solid #ddd; padding:10px; text-align:center; font-weight:bold; font-size:14px;">${dateTransactions.length}</td>
                                <td style="border:1px solid #ddd; padding:10px; background:#f8fafc; font-weight:bold;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©</td>
                                <td style="border:1px solid #ddd; padding:10px; text-align:center; font-weight:bold; font-size:14px;">${dateDeferred.length}</td>
                            </tr>
                            <tr>
                                <td style="border:1px solid #ddd; padding:10px; background:#f8fafc; font-weight:bold;">ØµØ§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…</td>
                                <td style="border:1px solid #ddd; padding:10px; text-align:center; font-weight:bold; font-size:14px; ${dailyTotal >= 0 ? 'color:#166534;' : 'color:#dc2626;'}">${dailyTotal.toFixed(2)}</td>
                                <td style="border:1px solid #ddd; padding:10px; background:#f8fafc; font-weight:bold;">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ±</td>
                                <td style="border:1px solid #ddd; padding:10px; text-align:center; font-weight:bold; font-size:14px;">${systemData.images.length}</td>
                            </tr>
                        </table>
                        
                        <h3 style="color:#0d9488; font-size:16px; border-bottom:2px solid #0d9488; padding-bottom:8px; margin-bottom:15px;">
                            Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
                        </h3>
                        <table style="width:100%; border-collapse:collapse; font-size:13px; margin-bottom:25px;">
                            <tr>
                                <td style="border:1px solid #ddd; padding:12px; background:#f0fdf4; font-weight:bold; width:25%;">Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</td>
                                <td style="border:1px solid #ddd; padding:12px; text-align:left; font-weight:bold; font-size:15px; color:#166534;">${deferredTotals.sales.toFixed(2)}</td>
                                <td style="border:1px solid #ddd; padding:12px; background:#fef2f2; font-weight:bold; width:25%;">Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©</td>
                                <td style="border:1px solid #ddd; padding:12px; text-align:left; font-weight:bold; font-size:15px; color:#991b1b;">${deferredTotals.purchases.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td style="border:1px solid #ddd; padding:12px; background:#ecfdf5; font-weight:bold;">Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¢Ø¬Ù„Ø©</td>
                                <td style="border:1px solid #ddd; padding:12px; text-align:left; font-weight:bold; font-size:15px; color:#065f46;">${deferredTotals.return_sales.toFixed(2)}</td>
                                <td style="border:1px solid #ddd; padding:12px; background:#fee2e2; font-weight:bold;">Ù…Ø±Ø¯ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø¢Ø¬Ù„Ø©</td>
                                <td style="border:1px solid #ddd; padding:12px; text-align:left; font-weight:bold; font-size:15px; color:#b91c1c;">${deferredTotals.return_purchases.toFixed(2)}</td>
                            </tr>
                        </table>
                    </div>
            `;
            
            // Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
            if (dateTransactions.length > 0) {
                pdfHtml += `
                    <div style="margin-bottom:30px;">
                        <h3 style="color: #0d9488; font-size: 16px; border-bottom: 2px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                            Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
                        </h3>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background:#f1f5f9;">
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„ÙˆÙ‚Øª</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                dateTransactions.forEach(tx => {
                    const typeInfo = TX_TYPES[tx.type];
                    const amountColor = typeInfo.type === 'in' ? '#166534' : typeInfo.type === 'out' ? '#dc2626' : '#666';
                    
                    pdfHtml += `
                        <tr>
                            <td style="border:1px solid #ddd; padding:8px;">${tx.time || ''}</td>
                            <td style="border:1px solid #ddd; padding:8px;">${typeInfo?.label || tx.type}</td>
                            <td style="border:1px solid #ddd; padding:8px;">${tx.fund || ''}</td>
                            <td style="border:1px solid #ddd; padding:8px;">${tx.description || ''}</td>
                            <td style="border:1px solid #ddd; padding:8px; color:${amountColor}; font-weight:bold; text-align:left;">${tx.amount.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                pdfHtml += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            // Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
            if (dateDeferred.length > 0) {
                pdfHtml += `
                    <div style="margin-bottom:30px;">
                        <h3 style="color: #0d9488; font-size: 16px; border-bottom: 2px solid #0d9488; padding-bottom: 8px; margin-bottom: 15px;">
                            Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¢Ø¬Ù„Ø©
                        </h3>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background:#f1f5f9;">
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ø§Ø³Ù…</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„ÙˆØµÙ</th>
                                    <th style="border:1px solid #ddd; padding:8px; text-align:right; font-weight:bold;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                dateDeferred.forEach(def => {
                    const typeLabel = DEFERRED_TYPES[def.type]?.label || def.label;
                    const amountColor = def.type === 'def_sale' ? '#166534' : 
                                       def.type === 'def_purchase' ? '#991b1b' :
                                       def.type === 'def_return_sale' ? '#065f46' :
                                       def.type === 'def_return_purchase' ? '#b91c1c' : '#666';
                    
                    pdfHtml += `
                        <tr>
                            <td style="border:1px solid #ddd; padding:8px;">${typeLabel}</td>
                            <td style="border:1px solid #ddd; padding:8px;">${def.name || ''}</td>
                            <td style="border:1px solid #ddd; padding:8px;">${def.description || ''}</td>
                            <td style="border:1px solid #ddd; padding:8px; color:${amountColor}; font-weight:bold; text-align:left;">${def.amount.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                pdfHtml += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            pdfHtml += `
                    <div style="margin-top:40px; padding-top:20px; border-top:2px solid #ddd; text-align:center; font-size:12px; color:#666;">
                        <p style="margin:5px 0;">ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø© - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© V8.0</p>
                        <p style="margin:5px 0;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date().toLocaleDateString('ar-EG')} ${new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })}</p>
                        <p style="margin:5px 0; font-weight:bold;">Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${document.getElementById('preparerName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        <p style="margin:5px 0; font-size:11px; color:#999;">Ù…Ù„Ø§Ø­Ø¸Ø©: ØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ØµÙˆØ± Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</p>
                    </div>
                </div>
            `;
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®ÙŠØ§Ø±Ø§Øª PDF
            const options = {
                margin: [10, 10, 10, 10],
                filename: `ØªÙ‚Ø±ÙŠØ±_ØµÙŠØ¯Ù„ÙŠØ©_Ø§Ù„ØµØ¯Ø§Ø±Ø©_${selectedDate}_Ø¨Ø¯ÙˆÙ†_ØµÙˆØ±.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait',
                    compress: true
                }
            };
            
            // Ø¥Ù†Ø´Ø§Ø¡ PDF
            setTimeout(() => {
                html2pdf().from(pdfHtml).set(options).save().then(() => {
                    hideLoader();
                    showMessage('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ PDF Ø¨Ø¯ÙˆÙ† ØµÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }).catch((error) => {
                    hideLoader();
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF:', error);
                    showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF', 'error');
                });
            }, 1000);
        }
        
        function printCurrentReport() {
            if (!currentReport.data) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚Ø±ÙŠØ± Ù„Ø¹Ø±Ø¶Ù‡');
                return;
            }
            
            loadPrintImages();
            
            const content = document.getElementById('reportContent').innerHTML;
            const title = document.getElementById('reportTitle').textContent;
            const dateInfo = document.getElementById('reportDateInfo').textContent;
            const imagesHtml = document.getElementById('printImages').innerHTML;
            const deferredTotals = document.getElementById('deferredTotals').innerHTML;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>${title} - ${currentReport.date}</title>
                    <style>
                        body { font-family: 'Noto Sans Arabic', sans-serif; padding: 15px; background: white; font-size: 12px; }
                        h1 { text-align: center; color: #0d9488; font-size: 18px; margin-bottom: 10px; }
                        .date-info { text-align: center; color: #666; font-size: 11px; margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
                        .print-images { page-break-inside: avoid; margin-top: 20px; }
                        .print-image { max-width: 100%; height: auto; margin-bottom: 10px; border: 1px solid #ddd; }
                        .section-title { font-size: 14px; font-weight: 600; color: #0d9488; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #e2e8f0; }
                        @media print {
                            body { padding: 10px; }
                            .no-print { display: none; }
                            @page { margin: 0.5cm; }
                        }
                        .report-section { margin-bottom: 20px; page-break-inside: avoid; }
                        .totals-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
                        .total-box { padding: 10px; border-radius: 5px; text-align: center; }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    <div class="date-info">${dateInfo} | ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-EG')}</div>
                    ${deferredTotals}
                    ${content}
                    ${imagesHtml}
                    <div style="margin-top:30px; padding-top:15px; border-top:1px solid #ddd; text-align:center; font-size:10px; color:#666;">
                        <p>ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ØµØ¯Ø§Ø±Ø© - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© V8.0</p>
                        <p>ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙˆØ§Ø³Ø·Ø©: ${document.getElementById('preparerName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }
        
        // ============================================
        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ============================================
        
        function formatDateArabic(dateStr) {
            if (!dateStr) return '';
            
            const date = new Date(dateStr);
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            
            return date.toLocaleDateString('ar-EG', options);
        }
        
        function showMessage(message, type) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            const messageEl = document.createElement('div');
            messageEl.className = `fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-3 rounded-lg shadow-lg ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            messageEl.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(messageEl);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†Ù
            setTimeout(() => {
                messageEl.style.opacity = '0';
                messageEl.style.transition = 'opacity 0.5s ease';
                setTimeout(() => {
                    document.body.removeChild(messageEl);
                }, 500);
            }, 3000);
        }
        
        // ============================================
        // Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©
        // ============================================
        
        let calcValue = '0';
        let calcPreviousValue = null;
        let calcOperation = null;
        
        function calcInput(value) {
            if (calcValue === '0' && value !== '.') {
                calcValue = value;
            } else {
                calcValue += value;
            }
            updateCalcDisplay();
        }
        
        function calcClear() {
            calcValue = '0';
            calcPreviousValue = null;
            calcOperation = null;
            updateCalcDisplay();
        }
        
        function calcCalculate() {
            if (!calcPreviousValue || !calcOperation) return;
            
            const prev = parseFloat(calcPreviousValue);
            const current = parseFloat(calcValue);
            let result;
            
            switch(calcOperation) {
                case '+':
                    result = prev + current;
                    break;
                case '-':
                    result = prev - current;
                    break;
                case '*':
                    result = prev * current;
                    break;
                case '/':
                    result = prev / current;
                    break;
                default:
                    return;
            }
            
            calcValue = result.toString();
            calcPreviousValue = null;
            calcOperation = null;
            updateCalcDisplay();
        }
        
        function updateCalcDisplay() {
            document.getElementById('calcDisplay').textContent = calcValue;
        }
        
        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        // ============================================
        
        function initPage() {
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('currentDate').value = today;
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            loadDailyTransactions();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±
            initializeImageUpload();
            
            // ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…
            updateBalance(0);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ ÙƒØ§ØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            document.getElementById('reportAuthorField').style.display = 'none';
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.3s ease';
                document.body.style.opacity = '1';
            }, 100);
            
            console.log('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… V8.0 - Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªØ·ÙˆØ±');
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>